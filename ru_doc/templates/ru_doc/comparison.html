<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" type="text/css" href="../../static/library/bootstrap.min-4.5.2.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="../../static/library/bootstrap.min-5.1.2npm.css">
    <script src="../../static/library/bootstrap-5.1.2.bundle.min.js"></script>

    <!--BS Icons -->
    <link rel="stylesheet" href="../../static/library/bootstrap-icons-1.3.0.css">
    <!-- Fontawesome Icons -->

    <link rel="stylesheet" href="../../static/library/fontawesome-5.10.0.all.css"  />
    <link rel="stylesheet" href="../../static/library/font-awesome.min-4.7.0.css">


    <link rel="stylesheet" href="../../static/styles/en_style/index.css">
    <link rel="stylesheet" href="../../static/styles/information_chart.css">
    <meta charset="UTF-8">

    <title>Comparison</title>

</head>

<body>

    <!-- Menu -->
    <div class="topnav fixed-top" id="myTopnav">
        <a href="javascript:void(0);" id="menu_icon">
            <i class="fa fa-bars"></i>
        </a>
        <a href="{% url 'en_index' %}" id="brand_name"><i id="brand_logo" class="bi bi-x-diamond-fill px-1"
                style="position: relative; top:-1px;"></i>
            Cyber Map </a>
        <a href="{% url 'en_information' %}">
            <img width="20px;" src="../../static/icons/docs.png" alt="">
            Approvals
        </a>
        <a href="{% url 'en_graph' %}">
            <img width="20px;" src="../../static/icons/graph4.png" alt="">
            Approvals Graph
        </a>
        <a href="{% url 'en_search' %}">
            <img width="20px;" src="../../static/icons/search2.png" alt="">
            Approvals Search
        </a>
        <a href="{% url 'en_subject' %}">
            <img width="20px;" src="../../static/icons/subject2.png" alt="">
            Subjective Analysis
        </a>
        <a href="{% url 'en_subject_statistics' %}">
            <img width="20px;" src="../../static/icons/amar_subject.png" alt="">
            Statistical Analysis
        </a>
        <a href="{% url 'en_adaptation' %}">
            <img width="20px;" src="../../static/icons/adaptation2.png" alt="">
            Subjective Adaptation
        </a>
        <a href="{% url 'en_votes_analysis' %}">
            <img width="20px;" src="../../static/icons/ara13.png" alt="">
            Votes Analysis
        </a>
        <a href="{% url 'en_subject_graph' %}">
            <img width="20px;" src="../../static/icons/graph2.png" alt="">
            Subjective Graph
        </a>

        <select dir="ltr" id="language" name="language" class="d-inline-block p-1 text-left mr-2 rounded float-right">
            <option value="Iran">Iran</option>
            <option selected value="England">England</option>
            <option disabled value="Russia" class="text-secondary">Russia</option>
        </select>
        <!-- <a href="#logout" id="logout">
                Exit
                <i id="logout_icon" class="fa fa-sign-out" aria-hidden="true"></i>
            </a> -->

    </div>
    <script src="../../static/js/topnav_handler.js"></script>

    <!-- Language selection -->
    <script>
        $(document).ready(function () {
            $('select#language').on('change', function (e) {

                selected_language = this.value;
                current_url = window.location.href;
                if (selected_language == 'Iran') {
                    window.location = "{% url 'index' %}";
                } else if (selected_language == 'England') {
                    window.location = "{% url 'en_index' %}";
                }

            })
        });
    </script>

    <!-- End of Menu -->


    <!-- Main Container -->
    <div class="row flex-row px-0 py-5 px-md-5 py-md-5 m-0">

        <h5 class="comparison_header">
            <label class="text-left float-left"><i class="header_icon bi bi-intersect"></i>
                Documents Comparison:</label>
        </h5>

        <ul class="float-left list-group">
            <li id="doc1Name" class="text-left list-group-item w-100 p-2">
            </li>
            <li id="doc2Name" class="list-group-item text-left float-left w-100 p-2">
            </li>
        </ul>

        <!--Original Tabs: Only show on large screens -->
        <ul id="original_tabs" class="nav nav-pills mt-5 mx-auto  pr-3 pr-sm-0  float-left  d-block" id="pills-tab"
            role="tablist">

            <li class="nav-item float-left" role="presentation">
                <button id="doc_info_tab" class="nav-link active" data-bs-toggle="pill"
                    data-bs-target="#common_terms_pane" type="button" role="tab" aria-controls="common_terms_pane"
                    aria-selected="true">Common Words</button>
            </li>
            <li class="nav-item float-left" role="presentation">
                <button id="common_keywords_tab" class="nav-link" data-bs-toggle="pill"
                    data-bs-target="#common_keywords_pane" type="button" role="tab" aria-controls="common_keywords_pane"
                    aria-selected="false">Common Keywords</button>
            </li>

            <li class="nav-item float-left" role="presentation">
                <button id="reference_tab" class="nav-link" data-bs-toggle="pill" data-bs-target="#reference_pane"
                    type="button" role="tab" aria-controls="reference_pane" aria-selected="false">References</button>
            </li>
        </ul>

        <div id="original_pane" class="tab-content float-left bg-white px-1" style="position: relative;"
            id="pills-tabContent">

            <!-- Common terms Pane -->
            <div id="common_terms_pane" class="tab-pane w-100 fade show active float-left" role="tabpanel"
                aria-labelledby="common_terms_tab">
                <h6 class="header mt-4  text-white d-block w-100 pt-2 px-2 float-left">
                    <label class="text-left float-left">
                        <i class="header_icon bi bi-pin-angle-fill p-1"></i>
                        Common words in two documents
                        <span id="common_terms_count" title="Common Words Count"
                            class="badge bg-transparent border p-2 ml-2"></span>

                    </label>
                </h6>
                <div id="common_terms_content" dir="ltr" class="text-left bg-light border p-4 mt-5">
                </div>

            </div>

            <!-- Common keywords Pane -->
            <div class="tab-pane w-100 fade float-left  px-0 border-0" id="common_keywords_pane" role="tabpanel"
                aria-labelledby="common_keywords_tab">

                <h6 class="header mt-4  text-white d-block w-100 pt-2 px-2 float-left">
                    <label class="text-left float-left">
                        <i class="header_icon bi bi-pin-angle-fill p-1"></i>
                        Common keywords in two documents
                        <span style="font-family: 'Courier New', Courier, monospace;" id="common_keywords_count"
                            title="Common Keywords Count" class="badge bg-transparent border p-2 ml-2"></span>
                    </label>
                </h6>
                <div id="common_keywords_content" dir="ltr" class="text-left bg-light border p-4 mt-5">
                </div>

            </div>

            <!-- Reference Pane -->
            <div class="tab-pane w-100 fade float-left" id="reference_pane" role="tabpanel"
                aria-labelledby="reference_tab">

                <!-- First two paragraph -->

                <h6 id="First_Paragraph_header"
                    class="header mt-4 border text-white d-block w-100 pt-2 px-2 float-left">
                    <label id="references_header_doc1" class="text-left float-left"><i
                            class="header_icon bi bi-pin-angle-fill p-1"></i>
                    </label>
                </h6>

                <div id="doc1_references" dir="ltr" class="text-left bg-light border p-4 mt-5">
                </div>

                <!-- Last two paragraph -->
                <h6 id="Last_Paragraph_header" class="header mt-0 border text-white d-block w-100 pt-2 px-2 float-left">
                    <label id="references_header_doc2" class="text-left float-left"><i
                            class="header_icon bi bi-pin-angle-fill p-1"></i>
                    </label>
                </h6>

                <div id="doc2_references" dir="ltr" class="text-left bg-light border p-4">
                </div>

            </div>

        </div>

    </div>



    <button id="scroll_btn" class="p-0" title="Go To Top" onclick="topFunction()">
        <i class="far fa-caret-square-up"></i>
        <!-- <i class="bi bi-chevron-up"></i> -->
        <!-- <i class="bi bi-chevron-double-up"></i> -->
        <!-- <i class="bi bi-arrow-up-circle"></i> -->
    </button>
    <script src="../../static/js/scroll_button_handler.js">
    </script>


    <script>

        init()

        async function init() {
            /*    Document name in header   */
            const url = new URL(window.location.href);
            const documents_id = url.searchParams.get("id").split("__");

            const document1_id = parseInt(documents_id[0]);
            let request_link = 'http://' + location.host + "/en" + "/GetDocumentById/" + document1_id + "/";
            const document1 = await fetch(request_link).then(response => response.json());
            const document1_name = document1["document_information"][0]["name"]

            const document2_id = parseInt(documents_id[1]);
            request_link = 'http://' + location.host + "/en" + "/GetDocumentById/" + document2_id + "/";
            const document2 = await fetch(request_link).then(response => response.json());
            const document2_name = document2["document_information"][0]["name"]

            var link1 = 'http://' + location.host + "/en" + "/information?id=" + document1_id
            var link2 = 'http://' + location.host + "/en" + "/information?id=" + document2_id

            document.getElementById("doc1Name").innerHTML = "<a href='" + link1 + "' >" + document1_name + "</a>";
            document.getElementById("doc2Name").innerHTML = "<a href='" + link2 + "'>" + document2_name + "</a>";

            /* References tables Header Update */
            document.getElementById("references_header_doc1").innerHTML = '<i class="header_icon bi bi-pin-angle-fill p-1"></i>' + "Referenced By: " + document1_name;
            document.getElementById("references_header_doc2").innerHTML = '<i class="header_icon bi bi-pin-angle-fill p-1"></i>' + "Referenced By: " + document2_name;


            /* Common Words and KeyWords Between 2 Doc */

            request_link = 'http://' + location.host + "/en" + "/GetCommonWords2Doc/" + document1_id + "/" + document2_id + "/";
            let response = await fetch(request_link).then(response => response.json());
            const CommonWords = response["common_words"]
            const CommonWords_Text = CommonWords.join(" - ")
            const CommonKeyWords = response["common_keywords"]
            const CommonKeyWords_Text = CommonKeyWords.join(" - ")

            if (CommonWords.length > 0) {
                document.getElementById("common_terms_content").innerText = CommonWords_Text;
                document.getElementById("common_terms_count").innerText = CommonWords.length;
            } else {
                document.getElementById("common_terms_content").innerText = "Common keywords not found..";
                document.getElementById("common_terms_count").innerText = 0;
            }


            if (CommonKeyWords.length > 0) {
                document.getElementById("common_keywords_content").innerText = CommonKeyWords_Text;
                document.getElementById("common_keywords_count").innerText = CommonKeyWords.length;
            } else {
                document.getElementById("common_keywords_content").innerText = "Common keywords not found..";
                document.getElementById("common_keywords_count").innerText = 0;
            }

            /* References Between 2 Doc */
            request_link = 'http://' + location.host + "/en" + "/GetReferences2Doc/" + document1_id + "/" + document2_id + "/";
            response = await fetch(request_link).then(response => response.json());
            const references_from_doc1 = response["references_from_doc1"]
            const references_from_doc2 = response["references_from_doc2"]

            if (references_from_doc1.length > 0) {
                document.getElementById("doc1_references").innerHTML = GenerateReferencesHighlightedTag(document2_name, references_from_doc1);
            } else {
                document.getElementById("doc1_references").innerHTML = "Not Found.";
            }

            if (references_from_doc2.length > 0) {
                console.log(GenerateReferencesHighlightedTag(document1_name, references_from_doc2))
                document.getElementById("doc2_references").innerHTML = GenerateReferencesHighlightedTag(document1_name, references_from_doc2);
            } else {
                document.getElementById("doc2_references").innerHTML = "Not Found.";
            }

        }

        function GenerateReferencesHighlightedTag(document_name, paragraphs_text) {
            let result_tag = ""
            for (let text of paragraphs_text) {
                const tag = "<span class='text-primary bold'>" + document_name + "</span>"
                text = text.replaceAll(document_name, tag)
                result_tag += "<li style='text-align: justify;'>" + text + "</li>"
            }
            result_tag = "<ul>" + result_tag + "</ul>"
            return result_tag
        }

    </script>

</body>

</html>