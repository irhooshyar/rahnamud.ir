<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" type="text/css" href="../../static/library/bootstrap.min-4.5.2.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="../../static/library/bootstrap.min-5.1.2npm.css">
    <script src="../../static/library/bootstrap-5.1.2.bundle.min.js"></script>

    <!--BS Icons -->
    <link rel="stylesheet" href="../../static/library/bootstrap-icons-1.3.0.css">
    <!-- Fontawesome Icons -->

    <link rel="stylesheet" href="../../static/library/fontawesome-5.10.0.all.css"  />
    <link rel="stylesheet" href="../../static/library/font-awesome.min-4.7.0.css">

    <!-- anychart modules -->
    <script src="../../static/library/anychart-8.10.0-core.min.js"></script>
    <script src="../../static/library/anychart-8.10.0-cartesian.min.js"></script>


    <!-- Footable  -->
    <script src="../../static/js/footable/demo-rows.js"></script>
    <script src="../../static/js/footable/ie10-viewport-bug-workaround.js"></script>
    <script src="../../static/js/footable/footable.js"></script>
    <link href="../../static/styles/footable/footable.bootstrap.min.css" rel="stylesheet">
    <link href="../../static/styles/footable/docs.css" rel="stylesheet">
    <link href="../../static/styles/footable/FooTable.Glyphicons.css" rel="stylesheet">
    <link href="../../static/styles/footable/FooTable.FontAwesome.css" rel="stylesheet">
    <link rel="stylesheet" href="../../static/styles/search_chart.css">

    <link rel="stylesheet" href="../../static/styles/en_style/index2.css">
    <link rel="stylesheet" href="../../static/styles/vote_analysis.css">

    <!-- Intro Js -->
    <script src="../../static/library/intro.min-4.3.0.js"></script>
    <link rel="stylesheet" type="text/css" href="../../static/library/introjs.min-4.3.0.css">
    <link rel="stylesheet" type="text/css" href="../../static/library/introjs-rtl.min-4.3.0.css">
    <link rel="stylesheet" href="../../static/styles/user_guide_tour.css">

    <!-- Notyf  -->
    <link rel="stylesheet" type="text/css" href="../../static/library/notyf.min-npm.css">
    <script src="../../static/library/notyf.min.js"></script>

    <!-- Blocking UI -->
    <script src="../../static/js/blockUI.js"></script>
    <script src="../../static/js/blockUI_handler.js"></script>
    <link rel="stylesheet" href="../../static/styles/loader.css">

    <script type="text/javascript" src="http://l2.io/ip.js?var=myip">
    </script>

    <meta charset="UTF-8">
    <link rel="stylesheet" href="../../static/styles/en_style/index.css">
    <link rel="stylesheet" href="../../static/styles/search_chart.css">

    <link rel="stylesheet" type="text/css" href="../../static/library/jquerysctipttop.css">
    <meta charset="UTF-8">
    <title>Actors Profile</title>
    {% include "doc/title_icon.html" %}

</head>

<body>
    <!-- Menu -->
    <nav dir="ltr" class="navbar nav_menu navbar-expand-lg fixed-top p-0 mt-0">
        {% include "en_doc/header.html" %}
    </nav>

    <script>
        $(document).ready(function () {

            // Active panel
            $('#ActorsDropdown').addClass('active');
            $('#show_actors_panel').addClass('active');

            $('select#language').on('change', function (e) {

                let selected_language = this.value;
                let current_url = window.location.href;
                if (selected_language === 'Iran') {
                    let page_name = current_url.split('/')[3]
                    console.log(page_name)
                    let requested_url = current_url.replace('/en', '')
                    window.location = requested_url;
                } else if (selected_language === 'Russia') {
                    let page_name = current_url.split('/')[3]
                    let requested_url = current_url.replace(page_name, 'ru')
                    window.location = requested_url;
                }

            });
        });
    </script>

    <script src="../../static/js/topnav_handler.js"></script>

    <div class="row flex-row px-0 py-5 px-md-5 py-md-5 m-0 mt-5">

        <!-- Form Fields -->
        <form action="" class="custom-control mx-auto needs-validation" id="info_form" enctype="multipart/form-data"
            method="post" novalidate>

            <!-- Primary Fields in First Row -->
            <div class="row flex-row mt-2 mx-auto">

                <!-- Country Input -->
                <div class="col-md-4 pt-3 col-12 col-lg-2 mt-1 bg-light">

                    <label class=" text-left bg-light float-left" style="direction: ltr;;">Country:</label>
                    <select dir="ltr" id="country" name="country" class="form-select text-left float-left"
                        style="direction: ltr;">
                        {% for k,v in countries.items %}
                        <option value="{{ k }}">{{ v }}</option>
                        {% endfor %}
                    </select>

                </div>


                <!-- Actor -->
                <div class="col-md-8 pt-3 col-12 col-lg-4 mt-1 mr-4 ActorSelect"  id="multipleSelectDiv">
                    <label for="ActorSelect" class="text-left bg-light float-left" style="direction: ltr;">Actor:</label>
                    <select id="ActorSelect" class="form-select text-left float-left" style="direction: ltr;">
                    </select>
                </div>


                <!--  Buttons -->
                <div class="col-lg-2 col-md-6 pt-5 mt-1 col-12">
                    <button type="button" id="document_search" onclick="ShowResult()"
                        class="btn d-flex float-left mr-2">
                        <div class="spinner-border text-light" role="status">
                            <span class="sr-only">searching...</span>
                        </div>
                        Show
                    </button>
                </div>

            </div>

            <!-- Advanced Fields in Second Row -->
            <div id="advanced_fields" class="collapse show row flex-row mx-auto mt-4">



            </div>
        </form>

        <div dir="ltr" class="row w-100 p-0">
            <!--Original Tabs -->
            <ul id="original_tabs" class="nav nav-pills mt-5 mx-auto  pr-3 pr-sm-0  float-left  d-block" id="pills-tab"
                role="tablist">

                <li class="nav-item float-left" role="presentation">
                    <button id="search_result_tab" class="nav-link active" data-bs-toggle="pill"
                        data-bs-target="#search_result_pane" type="button" role="tab" aria-controls="search_result_pane"
                        aria-selected="true">Relative Documents</button>
                </li>

                <li class="nav-item float-left" role="presentation">
                    <button id="chart_info_tab" class="nav-link" data-bs-toggle="pill"
                        data-bs-target="#chart_info_pane" type="button" role="tab" aria-controls="chart_info_pane"
                        aria-selected="false">Statistical Information</button>
                </li>

                <!-- Download Buttons -->
                <button type="button" data-bs-toggle="tooltip" data-bs-placement="top" title="Download Documents"
                    class="btn float-right p-0 px-1 mt-2" id="DownloadBtn" onclick="DownloadSerachResultFunction()"
                    type="button">
                    <i class="far fa-file-archive m-0" style="font-size: 25px;margin: 0px;"></i>

                </button>

                <button class="btn float-right p-0 px-1 mt-2" id="ExportExcel" data-bs-toggle="tooltip"
                    data-bs-placement="top" title="Excel Output" onclick="ExportExcelSerachResultFunction()"
                    type="button">
                    <i class="far fa-file-excel text-success m-0" style="font-size: 25px;margin: 0px;"></i>
                </button>

                <!-- Result Count -->
                <p id="DocumentCount" dir="ltr" class="text-left float-left text-secondary  pl-2"></p>

            </ul>

            <!-- Original Panes -->
            <div id="original_pane" class="tab-content float-left px-1 bg-white" id="pills-tabContent">

                <!-- Search Result Pane -->
                <div id="search_result_pane" class="tab-pane w-100 fade active show float-left" role="tabpanel"
                    aria-labelledby="search_result_tab">

                    <!-- Search Result table -->
                    <div class="table-responsive search_result_table mt-4">
                        <table class="table table-striped SearchTable" style="min-height: 200px;" id="SearchTable">
                        </table>
                    </div>

                </div>


                <!-- Actors Chart Pane -->
                <div id="chart_info_pane" class="tab-pane w-100 fade float-left" role="tabpanel" aria-labelledby="chart_info_tab">
                    <div class="row mt-4 w-100 flex-row mx-0 px-4 pb-5">
                        <h5 class="extractected_references w-100 mt-4 text-center float-left pt-3 pb-3">
                            Legistlation Date
                        </h5>
                        <div dir="ltr" id="actors_year_chart_container" style="height: 450px" class="bg-white w-100 p-4">
                        </div>
                    </div>

                    <div class="row mt-4 w-100 flex-row mx-0 px-4 pb-5">
                        <h5 class="extractected_references w-100 mt-4 text-center float-left pt-3 pb-3">
                            Hierarchy of Law
                        </h5>
                        <div dir="ltr" id="actors_level_chart_container" style="height: 450px" class="bg-white w-100 p-4">
                        </div>
                    </div>

                    <div class="row mt-4 w-100 flex-row mx-0 px-4 pb-5">

                        <h5 class="extractected_references w-100 mt-4 text-center float-left pt-3 pb-3">
                            Legislative Body
                        </h5>
                        <div dir="ltr" id="actors_approval_chart_container" style="height: 450px" class="bg-white w-100 p-4">
                        </div>
                    </div>


                </div>

            </div>
        </div>

    </div>

            <!-- ChartModal Container -->
    <button type="button" id="actors_modal_btn" class="btn d-none modal_btn" data-bs-toggle="modal"
        data-bs-target="#actors_modal"></button>
    <div class="modal fade" id="actors_modal">
        <div class="modal-dialog modal-dialog-scrollable modal-xl">
            <div class="modal-content">

                <!-- Modal Header -->
                <div style="direction: ltr !important;" class="modal-header">
                    <h5 id="actor_modal_header" class="modal-title">Title</h5>
                    <button type="button" class="btn-close m-0" data-bs-dismiss="modal"></button>
                </div>
                <!-- Modal body -->
                <div id="actor_paragraphs" class="modal-body text-justify">
                    <div id="actor_modal_body">
                    </div>
                </div>

                <!-- Modal footer -->
                <div id="modal_footer" class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close
                    </button>
                </div>

            </div>
        </div>
    </div>

    <!-- Scrollbar -->
    <button id="scroll_btn" class="p-0" title="Go To Top" onclick="topFunction()">
        <i class="far fa-caret-square-up"></i>
        <!-- <i class="bi bi-chevron-up"></i> -->
        <!-- <i class="bi bi-chevron-double-up"></i> -->
        <!-- <i class="bi bi-arrow-up-circle"></i> -->
    </button>
    <script src="../../static/js/scroll_button_handler.js">
    </script>

    <script src="../../static/js/zipDownload/jszip.min.js"></script>
    <script src="../../static/js/zipDownload/FileSaver.min.js"></script>

     <script type="text/javascript" language="javascript">
         init()
         async function init()
         {
             document.getElementById("ActorSelect").innerHTML = "<option value='0'>All</option>"

             let request_link = 'http://' + location.host + "/en/GetActorsList/"
             let response = await fetch(request_link).then(response => response.json());
             const Actors_List = response["Actors_List"]

             for (const actor of Actors_List)
             {
                 const id = actor[0]
                 const name = actor[1]

                 const tag = "<option value='"+id+"'>"+name+"</option>"

                 document.getElementById("ActorSelect").innerHTML += tag
             }

         }

         async function ShowResult()
         {
             const country = document.getElementById("country").value

             const actors_id_list = document.getElementById("ActorSelect").value

             let request_link = 'http://' + location.host + "/en/GetDocumentActorsList/" + country + "/" + actors_id_list + "/"
             let response = await fetch(request_link).then(response => response.json());
             const document_result = response["Document_Information"]

             const approval_date_chart_data = response["approval_date_chart_data"]
             const approval_reference_chart_data = response["approval_reference_chart_data"]
             const level_chart_data = response["level_chart_data"]


             showChart(approval_date_chart_data, "actors_year_chart_container", true)
             showChart(approval_reference_chart_data, "actors_approval_chart_container", false)
             showChart(level_chart_data, "actors_level_chart_container", false)

             document.getElementById("SearchTable").innerHTML = "";

             $('.SearchTable').footable({
                "paging": {
                    "enabled": true
                },
                "filtering": {
                    "enabled": false
                },
                "sorting": {
                    "enabled": true
                },
                "empty": "Not Found.",
                "columns": [{
                    "name": "id",
                    "title": "#",
                    "breakpoints": "xs sm",
                    "type": "number",
                    "style": {
                        "width": "5%"
                    }
                }, {
                    "name": "name",
                    "title": "Document Name",
                    "style": {
                        "width": "35%"
                    }
                }, {
                    "name": "approval_reference",
                    "title": "Approval Reference",
                    "style": {
                        "width": "15%"
                    }
                }, {
                    "name": "approval_date",
                    "title": "Approval Date",
                    "style": {
                        "width": "15%"
                    }
                }, {
                    "name": "count",
                    "title": "Frequency",
                    "style": {
                        "width": "10%"
                    }
                }, {
                    "name": "detail",
                    "title": "Details",
                    "style": {
                        "width": "5%"
                    }
                }
                ],
                "rows": document_result
            });

         }

         async function DetailFunction(document_id)
         {
             const actors_id_list = document.getElementById("ActorSelect").value
             let request_link = 'http://' + location.host + "/en/GetDocumentActorsParagraphs/" + document_id + "/" + actors_id_list + "/"
             let response = await fetch(request_link).then(response => response.json());
             const Paragraph_Text = response["Paragraph_Text"]

             request_link = 'http://' + location.host + "/en/GetActorsListById/" + actors_id_list + "/"
             response = await fetch(request_link).then(response => response.json());
             const Actors_Name = response["Actors_Name"]

             console.log(Actors_Name)

             document.getElementById("actor_modal_body").innerHTML = ""
             for (let i =0; i<Paragraph_Text.length; i++)
             {
                 let text = Paragraph_Text[i]

                 for (const actor of Actors_Name)
                 {
                     const tag = "<span class='text-primary'>" + actor + "</span>"
                     text = text.replaceAll(actor, tag)
                 }

                 console.log(text)

                 document.getElementById("actor_modal_body").innerHTML += text + "<br><br>"
             }

             document.getElementById("actor_modal_header").innerText = ""

             $("#actors_modal_btn").click();



         }


         function showChart(data, position, keySort) {
            if (keySort === true) {
                data.sort(function (element_a, element_b) {
                    return element_a[0] - element_b[0];
                });
            }
            else {
                data.sort(function (element_a, element_b) {
                    return element_a[1] - element_b[1];
                });
            }

            // Sorts the data by descending.
            data = anychart.data.set(data)

            document.getElementById(position).innerHTML = ""

            chart = anychart.column();
            chart.container(position);
            // create a column series and set the data
            var series = chart.column(data);
            chart
                .animation(true)
                .padding([10, 40, 5, 20])


            chart.background().fill('#ffffff');
            series.normal().fill("#488fb8", 1);
            series.normal().stroke("#488fb8", 0);

            // var state = series.normal();
            // state.fill('#1481c0')

            // x axix labels font setting
            var xAxisLabels = chart.xAxis().labels();
            xAxisLabels.fontFamily("vazir");

            var yAxisLabels = chart.yAxis().labels();
            yAxisLabels.fontFamily("vazir");

            // Not allow labels overlapping
            var xAxis = chart.xAxis();
            xAxis.overlapMode("noOverlap");

            var yAxis = chart.yAxis();
            yAxis.title("Document Count");
            yAxis.title().fontFamily('vazir');
            yAxis.title().height(40);

            // tooltip content font setting
            var tooltip = chart.tooltip();
            tooltip.fontFamily("vazir");

            // tooltip title font setting
            var title = chart.tooltip().title();
            title.fontFamily("vazir");

            chart.tooltip().hAlign('center').format("{%value}");

            chart.xAxis().labels().height(60);
            0
            chart.yAxis().labels().format("{%value}");

            chart.yScale().minimum(0);
            chart.yScale().ticks().allowFractional(false);

            //xAxisLabels.rotation(-90)
            // initiate drawing the chart
            chart.draw();

            chart.listen('Click', async function (event) {
                const click_tag = event.domTarget.tag;
                const index = click_tag["index"]
                const text = data.row(index)[0];
            })

        }

    </script>


    <script>

    </script>


</body>

</html>