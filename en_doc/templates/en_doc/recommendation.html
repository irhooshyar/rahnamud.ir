<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" type="text/css" href="../../static/library/bootstrap.min-4.5.2.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="../../static/library/bootstrap.min-5.1.2npm.css">

    <!-- commented for dromdown menu hover bug -->
    <!-- <link href="../../static/library/bootstrap-theme.min-3.3.6.css" rel="stylesheet"> -->
    <script src="../../static/library/bootstrap-5.1.2.bundle.min.js"></script>

    <!--BS Icons -->
    <link rel="stylesheet" href="../../static/library/bootstrap-icons-1.3.0.css">
    <!-- Fontawesome Icons -->

    <link rel="stylesheet" href="../../static/library/fontawesome-5.10.0.all.css"  />
    <link rel="stylesheet" href="../../static/library/font-awesome.min-4.7.0.css">

    <!-- anychart modules -->
    <script src="../../static/library/anychart-8.10.0-core.min.js"></script>
    <script src="../../static/library/anychart-8.10.0-cartesian.min.js"></script>

    <link href="../../static/styles/footable/footable.bootstrap.min.css" rel="stylesheet">

    <!-- Footable  -->
    <script src="../../static/js/footable/demo-rows.js"></script>
    <script src="../../static/js/footable/ie10-viewport-bug-workaround.js"></script>
    <script src="../../static/js/footable/footable.js"></script>
    <link href="../../static/styles/footable/footable.bootstrap.min.css" rel="stylesheet">
    <link href="../../static/styles/footable/docs.css" rel="stylesheet">
    <link href="../../static/styles/footable/FooTable.Glyphicons.css" rel="stylesheet">
    <link href="../../static/styles/footable/FooTable.FontAwesome.css" rel="stylesheet">


    <!-- Intro Js -->
    <script src="../../static/library/intro.min-4.3.0.js"></script>
    <link rel="stylesheet" type="text/css" href="../../static/library/introjs.min-4.3.0.css">
    <link rel="stylesheet" type="text/css" href="../../static/library/introjs-rtl.min-4.3.0.css">
    <link rel="stylesheet" type="text/css" href="../../static/library/notyf.min-npm.css">


    <!-- Blocking UI -->
    <script src="../../static/js/blockUI.js"></script>
   <script src="../../static/library/html2pdf.bundle.min-0.10.1.js" integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="../../static/styles/loader.css">

    <script type="text/javascript" src="http://l2.io/ip.js?var=myip">
    </script>

    <meta charset="UTF-8">
    <link rel="stylesheet" href="../../static/styles/en_style/index.css">
    <link rel="stylesheet" href="../../static/styles/search_chart.css">
    <link rel="stylesheet" href="../../static/styles/en_style/index2.css">
    <link rel="stylesheet" href="../../static/styles/recommendation.css">
    <link rel="stylesheet" href="../../static/styles/user_guide_tour.css">

    <link rel="stylesheet" type="text/css" href="../../static/library/jquerysctipttop.css">
    <meta charset="UTF-8">
    <title>Recommendations</title>
    {% include "doc/title_icon.html" %}
</head>

<body>
    <!-- Menu -->
    <nav dir="ltr" class="navbar nav_menu navbar-expand-lg fixed-top p-0 mt-0">
        {% include "en_doc/header.html" %}
    </nav>

    <script>
        $(document).ready(function () {

            $('select#language').on('change', function (e) {

                let selected_language = this.value;
                let current_url = window.location.href;
                if (selected_language === 'Iran') {
                    let page_name = current_url.split('/')[3]
                    console.log(page_name)
                    let requested_url = current_url.replace('/en', '')
                    window.location = requested_url;
                } else if (selected_language === 'Russia') {
                    let page_name = current_url.split('/')[3]
                    let requested_url = current_url.replace(page_name, 'ru')
                    window.location = requested_url;
                }

            });
        });
    </script>

    <script src="../../static/js/topnav_handler.js"></script>

    <!-- Main Container -->
    <div class="row flex-row px-0 py-5 px-md-5 py-md-5 m-0 mt-5">

        <div class="col">
        </div>
        <div class="col-7">


            <form class="shadow p-4 bg-white" id="recommendation_form" method="POST">

                <div class="row text">
                    <div class="form_title mb-3">
                     <p class="title ">Recommendations Form</p>
                    </div>
                    <div class="col mb-3">
                        <label style="direction: ltr"  class=" text-left bg-light float-left" for="firstname">Name <span style="color: red">*</span>:</label>
                        <input type="text" class="form-control fa-input" id="firstname" required>
                    </div>

                    <div class="col">
                        <label style="direction: ltr" class=" text-left bg-light float-left" for="lastname">Family Name<span style="color: red">*</span>:</label>
                        <input type="text" class="form-control fa-input" id="lastname" required>
                    </div>

                    <div class="mb-3">
                         <label style="direction: ltr" class=" text-left bg-light float-left" for="email">Email <span style="color: red">*</span>:</label>
                         <input type="email" class="form-control" id="email" required placeholder="example@example.com">
                     </div>

                    <div class="mb-3">
                      <label style="direction: ltr" class=" text-left bg-light float-left" for="rating">Your Score To Cybermap<span style="color: red">*</span>:</label>
                    <!-- Rating Stars Box -->
                      <div class='rating-stars text-center'>
                        <ul id='stars'>
                          <li class='star' data-value='1'>
                            <i class='fa fa-star fa-fw'></i>
                          </li>
                          <li class='star' data-value='2'>
                            <i class='fa fa-star fa-fw'></i>
                          </li>
                          <li class='star' data-value='3'>
                            <i class='fa fa-star fa-fw'></i>
                          </li>
                          <li class='star' data-value='4'>
                            <i class='fa fa-star fa-fw'></i>
                          </li>
                          <li class='star' data-value='5'>
                            <i class='fa fa-star fa-fw'></i>
                          </li>
                        </ul>
                      </div>

                    </div>

                    <div class="mb-3">
                          <label style="direction: ltr" class=" text-left bg-light float-left" for="exampleFormControlTextarea1" class="form-label">Please type your recommendations here: <span style="color: red">*</span>:</label>
                          <textarea class="form-control" id="recommendation_text" rows="20" ></textarea>
                    </div>

                    <div class="mb-3 d-grid gap-2 col-6 mx-auto">
                        <button class="btn btn-primary" value="submit" onclick=SubmitResult()>Send</button>
                    </div>
                </div>
            </form>

        </div>
        <div class="col">
        </div>


    </div>

    <!-- Scrollbar -->
    <button id="scroll_btn" class="p-0" title="Go To Top" onclick="topFunction()">
        <i class="far fa-caret-square-up"></i>
        <!-- <i class="bi bi-chevron-up"></i> -->
        <!-- <i class="bi bi-chevron-double-up"></i> -->
        <!-- <i class="bi bi-arrow-up-circle"></i> -->
    </button>
    <script src="../../static/js/scroll_button_handler.js">
    </script>

    <script src="../../static/js/zipDownload/jszip.min.js"></script>
    <script src="../../static/js/zipDownload/FileSaver.min.js"></script>
    <script>

        async function downloadFiles(file_name_list, save_file_name) {
            const country_id = file_name_list[0]["country_id"]

            let zip = new JSZip()

            const request_link = 'http://' + location.host + "/en" + "/GetCountryById/" + country_id + "/";
            let response = await fetch(request_link).then(response => response.json());
            response = response["country_information"][0]
            const country_folder = response["folder"];
            const country_name = response["name"];

            save_file_name += " Country {" + country_name + "}"


            let extension = ".txt"
            if (country_name.includes("فاوا")) {
                extension = '.docx';
            }

            for (const document of file_name_list) {
                const document_name = document["name"] + extension
                const path = 'http://' + location.host + '/media/data/' + country_folder + '\\' + document_name;

                await fetch(path)
                    .then(res => res.arrayBuffer())
                    .then(value => {
                        zip.file(document_name, value);
                    })
            }
            zip.generateAsync({
                type: "blob"
            })
                .then(function (content) {
                    // see FileSaver.js
                    saveAs(content, save_file_name + ".zip");
                });
        }


        async function DownloadSerachResultFunction() {
            save_file_name = "search result {" + document.getElementById("SearchBox").value + "}"
            downloadFiles(SearchResultValue, save_file_name)
        }

        async function ExportExcelSerachResultFunction() {
            console.log(SearchResultValue)
            var csv = "";

            sep = "\t"
            let Csv = "Document Name" + sep + "Document Level" + sep + "Document Subject" + sep +
                "Document Type" + sep + "Approval Reference" + sep + "Approval Date" + sep +
                " ‌Notification Date" + sep + "Count" + "\n"
            for (const document of SearchResultValue) {
                Csv += document["name"] + sep + document["level"] + sep + document["subject"] + sep +
                    document["type"] + sep + document["approval_reference"] + sep + document["approval_date"] + sep +
                    document["communicated_date"] + sep + document["count"] + "\n"

            }
        }

    </script>

</body>

</html>