<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" type="text/css" href="../../static/library/bootstrap.min-4.5.2.css">

    <script src="../../static/js/jquery_351/jquery.min.js"></script>

    <link rel="stylesheet" type="text/css" href="../../static/library/bootstrap.min-5.1.2npm.css">
    <script src="../../static/library/bootstrap-5.1.2.bundle.min.js"></script>

    <!--BS Icons -->
    <link rel="stylesheet" href="../../static/library/bootstrap-icons-1.3.0.css">
    <!-- Fontawesome Icons -->

    <link rel="stylesheet" href="../../static/library/fontawesome-5.10.0.all.css"  />
    <link rel="stylesheet" href="../../static/library/font-awesome.min-4.7.0.css">

    <!-- anychart modules -->
    <script src="../../static/library/anychart-8.10.0-core.min.js"></script>
    <script src="../../static/library/anychart-8.10.0-graph.min.js"></script>
    <script src="../../static/library/anychart-8.10.0-pie.min.js"></script>
    <script src="../../static/library/anychart-8.10.0-exports.min.js"></script>
    <script src="../../static/library/anychart-8.10.0-cartesian.min.js"></script>
    <script src="../../static/library/anychart-8.10.0-radar.min.js"></script>


    <!-- Footable  -->
    <script src="../../static/js/footable/demo-rows.js"></script>
    <script src="../../static/js/footable/ie10-viewport-bug-workaround.js"></script>
    <script src="../../static/js/footable/footable.js"></script>
    <link href="../../static/styles/footable/footable.bootstrap.min.css" rel="stylesheet">
    <link href="../../static/styles/footable/docs.css" rel="stylesheet">
    <link href="../../static/styles/footable/FooTable.Glyphicons.css" rel="stylesheet">
    <link href="../../static/styles/footable/FooTable.FontAwesome.css" rel="stylesheet">

    <script src="https://d3js.org/d3.v3.js"></script>
    <script src="../../static/js/jsnetworkx.js"></script>

    <link rel="stylesheet" type="text/css" href="../../static/library/tom-select-2.2.1.css">
    <script src="../../static/library/tom-select.complete-2.2.1.min.js"></script>
    <script type="text/javascript" src="../../static/js/searchable-select.js"></script>

    <link rel="stylesheet" href="../../static/styles/index2.css">
    <link rel="stylesheet" href="../../static/styles/graph.css">
    <meta charset="UTF-8">

    <!-- Intro Js -->
    <script src="../../static/library/intro.min-4.3.0.js"></script>
    <link rel="stylesheet" type="text/css" href="../../static/library/introjs.min-4.3.0.css">
    <link rel="stylesheet" type="text/css" href="../../static/library/introjs-rtl.min-4.3.0.css">
    <link rel="stylesheet" href="../../static/styles/user_guide_tour.css">

    <!-- Notyf  -->
    <link rel="stylesheet" type="text/css" href="../../static/library/notyf.min-npm.css">
    <script src="../../static/library/notyf.min.js"></script>

    <script src="./../static/js/graph/g6.min.js"></script>
    <script src="../../static/library/jquery-ui.min-1.11.4.js"></script>

    <!--<script type="text/javascript" src="http://l2.io/ip.js?var=myip">
    </script>-->

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="../../static/js/GraphClass.js"></script>

    <style>
        .white-hover:hover {
            background-color: #000000 !important;
        }
    </style>

    <title> گراف کنشگران</title>
    {% include "doc/title_icon.html" %}
</head>

<body>


    <!-- Menu -->
    <nav dir="rtl" class="navbar nav_menu navbar-expand-lg fixed-top p-0 mt-0">
        {% include "doc/header2.html" %}
    </nav>

    <script>
        $(document).ready(function () {


            // Active panel
            $('#ActorsDropdown').addClass('active');
            $('#actors_graph').addClass('active');


            $('select#language').on('change', function (e) {

                let selected_language = this.value;
                let current_url = window.location.href;
                if (selected_language === 'England') {
                    let page_name = current_url.split('/')[3]
                    let requested_url = current_url.replace(page_name, 'en')
                    window.location = requested_url;
                } else if (selected_language === 'Russia') {
                    let page_name = current_url.split('/')[3]
                    let requested_url = current_url.replace(page_name, 'ru')
                    window.location = requested_url;
                }

            });
        });
    </script>



    <div class="row flex-row-reverse px-0 py-5 px-md-5 py-md-5 m-0 mt-4">
        <form action="" class="custom-control mx-auto needs-validation" id="graph_form" enctype="multipart/form-data"
            method="post" novalidate>

            <div class="row mb-0 flex-row-reverse mx-auto">

                <div class="col-md-6 pt-3 col-12 col-lg-2 bg-light" dir="rtl">

                    <label class=" text-right bg-light float-right" style="direction: rtl;;">مجموعه سند:</label>

                    <select id="country" name="country" class="form-select text-right float-right searchable-select"
                        onchange="CountryChanged()" style="direction: rtl;">
                        {% for k,v in countries.items %}
                        <option value="{{ k }}">{{ v }}</option>
                        {% endfor %}
                    </select>
                </div>


                <div class="col-lg-10 mr-0 col-md-6 pt-5 col-12">
                    <!-- Advanced Setting btn-->
                    <!-- <button id="constraints_setting" type="button" class="btn bg-white float-right ml-4"
                        data-bs-toggle="collapse" data-bs-target="#constraints_container" aria-expanded="false"
                        aria-controls="constraints_container">تنظیمات پیشرفته</button> -->

                    <!-- Show result btn -->
                    <button type="button" id="graph_show" class="btn d-flex float-right mr-4" onclick="ShowGraph()">

                        <div class="spinner-border text-light" role="status">
                            <span class="sr-only">درحال جستجو ...</span>
                        </div>
                        نمایش
                        گراف
                    </button>
                </div>

                <div class="col-md-6 pt-3 col-12 col-lg-3 bg-light mt-1" dir="rtl">
                    <label class=" text-right bg-light float-right" style="direction: rtl;;"> نوع گراف:</label>
                    <select id="ActorGraphTypeSelect" name="ActorGraphTypeSelect"
                        class="form-select text-right float-right searchable-select" style="direction: rtl;">
                    </select>
                </div>

                <div class="col-md-3 pt-3 col-12 col-lg-3 bg-light mt-1" style="direction: rtl">
                    <label class=" text-right bg-light float-right" style="direction: rtl;;">حداقل درصد شباهت:</label>
                    <select id="MinimumSimilarity" name="MinimumSimilarity" class="form-select text-right float-right searchable-select"
                        style="direction: rtl;">
                    </select>
                </div>

                <div class="col-md-3 pt-3 col-12 col-lg-3 bg-light mt-1" style="direction: rtl">
                    <label class=" text-right bg-light float-right" style="direction: rtl;;">حداکثر درصد شباهت:</label>
                    <select id="MaximumSimilarity" name="MaximumSimilarity" class="form-select text-right float-right searchable-select"
                        style="direction: rtl;">
                    </select>
                </div>

                <div class="col-md-3 pt-3 col-12 col-lg-3 bg-light mt-1" id="actor-role-div" dir="rtl">
                    <label class=" text-right bg-light float-right" style="direction: rtl;;">نقش کنشگر:</label>
                    <select id="ActorRoleSelect" name="ActorRoleSelect" class="form-select text-right float-right searchable-select"
                        style="direction: rtl;">
                    </select>
                </div>


                <!-- <div class="col-md-6 pt-3 col-12 col-lg-3 mx-0 p-0  bg-light">
                    <div id="similarity_chart_container" style="height: 180px" class="bg-white w-100 p-0">
                    </div>
                </div> -->

            </div>

            <!-- Constraints -->


        </form>

        <!--Original Tabs -->
        <ul id="original_tabs" class="nav nav-pills mt-5 mx-auto  pr-3 pr-sm-0  float-right  d-block" id="pills-tab"
            role="tablist">

            <li class="nav-item float-right" role="presentation">
                <button id="actorsGraph_graph_tab" class="nav-link active" data-bs-toggle="pill"
                    data-bs-target="#actorsGraph_graph_pane" type="button" role="tab"
                    aria-controls="actorsGraph_graph_pane" aria-selected="false">گراف کنشگران</button>
            </li>

        </ul>

        <!-- Original Panes -->
        <div id="original_pane" class="tab-content float-right px-1 bg-white" id="pills-tabContent">

            <!--  Actors Graph Pane -->

            <div id="actorsGraph_graph_pane" class="tab-pane w-100 fade show active float-right" role="tabpanel"
                aria-labelledby="actorsGraph_graph_tab">

                <div dir="rtl" class="row mt-4 w-100 flex-row-reverse  mx-auto pb-5 px-4">

                    <div id="actorsGraph_constraints_container" class="collapse show constraints_container row flex-row-reverse pt-0 mb-0 mt-0 mx-auto">

                        <div id="actorsGraph_DegreeDiv" class="col-md-3 p-1 col-12 col-lg-6 mt-1">
                            <div class="source_header bg-white row mx-auto p-1">
                                <label class="text-center my-0" style="direction: rtl;">فیلتر درجه</label>
                            </div>
                            <div class="source_container pb-2 row mx-auto">
                                <div dir="rtl" class="wrapper mt-5 mb-1" id="actorsGraph_DegreeSlider" style="visibility: hidden;">
                                  <div class="container" style="display: flex; justify-content: center;">
                                    <div class="slider-wrapper">
                                      <div dir="ltr" id="slider-range"></div>
                                      <div dir="rtl" style="display:flex; width: 300px; justify-content: center" class="range-wrapper">
                                        <div dir="ltr" class="range mt-1"></div>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                            </div>
                        </div>

                        <div id="actorsGraph_WeightDiv" class="col-md-3 p-1 col-12 col-lg-6 mt-1">
                            <div class="source_header bg-white row mx-auto p-1">
                                <label class="text-center my-0" style="direction: rtl;">فیلتر وزن</label>
                            </div>
                            <div class="source_container pb-2 row mx-auto">
                                <div dir="rtl" class="wrapper mt-5 mb-1" id="actorsGraph_WeightSlider" style="visibility: hidden;">
                                  <div class="container" style="display: flex; justify-content: center;">
                                    <div class="slider-wrapper">
                                        <div dir="ltr" id="slider-range"></div>
                                          <div dir="rtl" style="display:flex; width: 300px; justify-content: center" class="range-wrapper">
                                            <div dir="ltr" class="range mt-1"></div>
                                          </div>
                                    </div>
                                    </div>
                                  </div>
                                </div>
                        </div>

                    </div>

                    <div class="d-flex">
                        <div class="col-md-6 p-1 col-12 col-lg-6 mt-3">
                            <div class="source_header bg-white row mx-auto p-1">
                                <label class="text-center my-0" style="direction: rtl;">نحوه نمایش</label>
                            </div>
                            <div class="source_container p-4 row mx-auto">
                                <select id="actorsGraph_ChangeLayout" name="actorsGraph_ChangeLayout" class="form-select text-right float-right searchable-select" style="direction: rtl;">
                                    <option value="grid">مربعی</option>
                                    <option value="circular"> دایره ای </option>
                                    <option value="force">ساده</option>
                                    <option value="dagre">بالا به پایین</option>
                                    <option value="radial">شعاعی</option>
                                    <option value="concentric">متحدالمرکز</option>
                                    <option value="comboForce">خوشه ای</option>
                                </select>
                            </div>
                        </div>

                        <div class="col-md-6 p-1 col-12 col-lg-6 mt-3">
                            <div class="source_header bg-white row mx-auto p-1">
                                <label class="text-center my-0" style="direction: rtl;">جستجو در نام گره</label>
                            </div>
                            <div class="source_container p-4 d-flex">
                                <input style="direction: rtl;" class="form-control text-right" placeholder="جستجو در نام گره ها ..." type="text" required="" name="actorsGraph_SearchBox" id="actorsGraph_SearchBox" value="">
                                <button type="button" id="actorsGraph_SearchBtn" class="btn modal_btn mr-2">جست‌وجو</button>
                            </div>
                        </div>

                    </div>

                    <div dir="ltr">
                        <img style="width: 4%; cursor: pointer; margin-top: 20px;" id="actorsGraph_SelectNeighbourImg" src="../../static/image/neighbourhood.png">
                        <img style="width: 3%; cursor: pointer; margin-top: 20px;" id="actorsGraph_ShowHideImg" src="../../static/image/hide_nodes.png">
                    </div>

                    <div id="actorsGraph_graph_container" class="border mt-1 position-static" style="height:500px; overflow: hidden;">
                    </div>

                    <div dir="rtl" style="display: flex; margin-bottom: 50px;">
                        <div class="col-md-6 px-0 col-12 col-lg-5 pt-1">
                            <h6 class="table_header text-center  p-2  mb-0">
                                گره های انتخاب شده
                            </h6>
                            <table id="actorsGraph_selected_node_table" class="table table-striped PopUpTable" style="width: 95%;margin: auto;">

                            </table>
                        </div>

                        <div class="col-md-6 px-0 col-12 col-lg-7 pt-1">
                        <h6 class="table_header text-center  p-2  mb-0">
                            یال های انتخاب شده
                        </h6>
                        <table id="actorsGraph_selected_edge_table" class="table table-striped PopUpTable" style="width: 95%;margin: auto;">

                        </table>
                    </div>
                    </div>

                </div>

            </div>



        </div>

    </div>

    <!-- Modal Container -->
    <div class="modal fade" id="SelectDocumentModal_Source">
        <div style="max-width: 1200px !important;" class="modal-dialog modal-dialog-scrollable">
            <div class="modal-content">
                <!-- Modal Header -->
                <div style="direction: rtl !important;" class="modal-header">
                    <h5 id="ModalHeader_Source" class="modal-title">انتخاب سند 1</h5>
                    <button type="button" class="btn-close m-0" data-bs-dismiss="modal"></button>
                </div>

                <!-- Modal body -->
                <div id="ModalBody_Source" class="modal-body text-justify">
                    <div class="container_modal">
                        <table id="PopUpTable_Source" class="table table-striped PopUpTable_Source">
                        </table>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div class="modal fade" id="SelectDocumentModal_Destination">
        <div style="max-width: 1200px !important;" class="modal-dialog modal-dialog-scrollable">
            <div class="modal-content">

                <!-- Modal Header -->
                <div style="direction: rtl !important;" class="modal-header">
                    <h5 id="ModalHeader_Destination" class="modal-title">انتخاب سند 2</h5>
                    <button type="button" class="btn-close m-0" data-bs-dismiss="modal"></button>
                </div>


                <!-- Modal body -->
                <div id="ModalBody_Destination" class="modal-body text-justify">
                    <div class="container_modal">
                        <table id="PopUpTable_Destination" class="table table-striped PopUpTable_Destination">
                        </table>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <button type="button" id="Correlation_Comparison_Modal_btn" class="btn d-none modal_btn" data-bs-toggle="modal"
        data-bs-target="#Correlation_Comparison_Modal"></button>
    <!-- Modal Container -->
    <div class="modal fade" id="Correlation_Comparison_Modal">
        <div id="modal_dialog" class="modal-dialog modal-fullscreen">
            <div class="modal-content">

                <!-- Modal Header -->
                <div style="direction: rtl !important;" class="modal-header bg-light">
                    <h5 id="Correlation_ModalHeader" class="modal-title text-center text-secondary w-100">

                    </h5>
                    <button type="button" class="btn-close m-0" data-bs-dismiss="modal"></button>
                </div>

                <!-- Modal body -->
                <div id="Correlation_Modal_Body" class="modal-body bg-light text-justify">
                    <div class="row w-100">
                        <div class="row w-100">

                            <!--Grid column-->
                            <div class="col-md-2 mb-4 ">

                                <ul class="nav nav-pills pills-primary d-flex flex-column" role="tablist">
                                    <li class="nav-item">
                                        <a class="nav-link modal_nav_link active" data-bs-toggle="pill"
                                            data-bs-target="#total_role_panel" type="button" role="tab"
                                            aria-controls="total_role_panel" aria-selected="false" data-toggle="tab"
                                            role="tab">برآیند نقش‌ها</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link modal_nav_link" data-bs-toggle="pill"
                                            data-bs-target="#motevali_panel" type="button" role="tab"
                                            aria-controls="motevali_panel" aria-selected="false" role="tab">متولی
                                            اجرا</a>
                                    </li>

                                    <li class="nav-item">
                                        <a class="nav-link modal_nav_link" data-bs-toggle="pill"
                                            data-bs-target="#hamkar_panel" type="button" role="tab"
                                            aria-controls="hamkar_panel" aria-selected="false" role="tab">همکار</a>
                                    </li>

                                    <li class="nav-item">
                                        <a class="nav-link modal_nav_link" data-bs-toggle="pill"
                                            data-bs-target="#salahiat_panel" type="button" role="tab"
                                            aria-controls="salahiat_panel" aria-selected="false" role="tab">ذی‌صلاح</a>
                                    </li>

                                </ul>

                            </div>
                            <!--Grid column-->

                            <!--Grid column-->
                            <div class="col-md-10 mb-4">

                                <!-- Tab panels -->
                                <div class="tab-content pt-0">

                                    <!--Panel 1-->
                                    <div class="tab-pane fade show active" id="total_role_panel" role="tabpanel">
                                        <div dir="ltr" id="total_comparison_chart" style="height: 470px"
                                            class="w-100 float-left px-1">
                                        </div>
                                    </div>
                                    <!--/.Panel 1-->

                                    <!--Panel 2-->
                                    <div class="tab-pane fade" id="motevali_panel" role="tabpanel">
                                        <div dir="ltr" id="motevali_comparison_chart" style="height: 470px"
                                            class="w-100 float-left px-1">
                                        </div>
                                    </div>
                                    <!--/.Panel 2-->


                                    <!--Panel 3-->
                                    <div class="tab-pane fade" id="hamkar_panel" role="tabpanel">
                                        <div dir="ltr" id="hamkar_comparison_chart" style="height: 470px"
                                            class="w-100 float-left px-1">
                                        </div>
                                    </div>
                                    <!--/.Panel 3-->

                                    <!--Panel 4-->
                                    <div class="tab-pane fade" id="salahiat_panel" role="tabpanel">
                                        <div dir="ltr" id="salahiat_comparison_chart" style="height: 470px"
                                            class="w-100 float-left px-1">
                                        </div>
                                    </div>
                                    <!--/.Panel 4-->

                                </div>


                            </div>
                            <!--Grid column-->

                        </div>
                        <!--Grid row-->
                        <!-- <div dir="ltr" id="Source_Actor_Chart" style="height: 470px" class="col-6 float-right px-1">
                            </div>
                            <div dir="ltr" id="Other_Actor_Chart" style="height: 470px" class="col-6 float-left px-1">
                            </div> -->
                    </div>
                </div>

                <!-- Modal footer -->
                <div class="modal-footer bg-light">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">بستن</button>
                </div>

            </div>
        </div>
    </div>

    <!-- Modal Container -->
    <button type="button" id="SimilarityModalBtn" class="btn d-none modal_btn" data-bs-toggle="modal"
        data-bs-target="#SimilarityModal"></button>
    <div class="modal fade" id="SimilarityModal">
        <div id="modal_dialog" class="modal-dialog  modal-fullscreen">
            <div class="modal-content">

                <!-- Modal Header -->
                <div style="direction: rtl !important;" class="modal-header">
                    <h5 id="ModalHeader" class="modal-title w-100">
                        <div class="row w-100">
                            <div id="RightHeader" class="col-6 float-right text-center my-auto"></div>
                            <div id="LeftHeader" class="col-6 float-left text-center my-auto"></div>
                        </div>
                    </h5>
                    <button type="button" class="btn-close m-0" data-bs-dismiss="modal"></button>
                </div>

                <!-- Modal body -->
                <div id="DetailText" class="modal-body bg-light text-justify">
                    <div class="row w-100 ">
                        <div id="RightDetails" class="col-6 float-right" style="overflow-y: scroll;height: 74vh;">
                        </div>
                        <div id="LeftDetails" class="col-6 float-left" style="height: 74vh;"></div>
                    </div>
                </div>

                <!-- Modal footer -->
                <div class="modal-footer">
                    <h6 style="margin-bottom: 0.5rem;direction: rtl;">
                        کلیدواژگان مشترک (فراوانی در هر سند)
                        :
                    </h6>
                    <div id="KeywordCheckList" style="direction: rtl;width: 100%" onclick="getNewParagraphs()">

                    </div>
                    <hr style="width: 100%"/>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">بستن</button>
                </div>

            </div>
        </div>
    </div>

    <!-- Modal Container -->
    <button type="button" id="AreaModalBtn" class="btn d-none modal_btn" data-bs-toggle="modal"
        data-bs-target="#AreaModal"></button>
    <div class="modal fade" id="AreaModal">
        <div id="modal_dialog1" class="modal-dialog modal-fullscreen">
            <div class="modal-content">

                <!-- Modal Header -->
                <div style="direction: rtl !important;" class="modal-header">
                    <h5 id="ModalHeader" class="modal-title w-100">
                        <div class="row w-100">
                            <div id="AreaHeader" class="col-12 float-right text-center my-auto"></div>
                        </div>
                    </h5>
                    <button type="button" class="btn-close m-0" data-bs-dismiss="modal"></button>
                </div>

                <!-- Modal body -->
                <div id="DetailText" class="modal-body bg-light text-justify">
                    <div class="px-4 w-100 ">
                        <div class="table-responsive mt-4">
                            <table class="table table-striped SearchTable" style="min-height: 200px;" id="EdgeTable">
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Modal footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">بستن</button>
                </div>

            </div>
        </div>
    </div>


    <!-- Modal Container -->
    <button type="button" id="AreaDetailModalBtn" class="btn d-none modal_btn" data-bs-toggle="modal"
        data-bs-target="#AreaDetailModal"></button>
    <div class="modal fade" id="AreaDetailModal">
        <div id="modal_dialog2" class="modal-dialog  modal-fullscreen">
            <div class="modal-content">

                <!-- Modal Header -->
                <div style="direction: rtl !important;" class="modal-header">
                    <h5 id="ModalHeader2" class="modal-title w-100">
                        <div class="row w-100">
                            <div id="AreaDetailHeader" class="col-12 float-right text-center my-auto">جزئیات</div>
                        </div>
                    </h5>
                    <button type="button" class="btn-close m-0" data-bs-dismiss="modal"
                        onclick="document.getElementById('AreaModalBtn').click()"></button>
                </div>

                <!-- Modal body -->
                <div id="DetailText2" class="modal-body bg-light text-justify">
                    <div class="px-5 w-100 " id="AreaDetailText" >
                    </div>
                </div>

                <!-- Modal footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                            onclick="document.getElementById('AreaModalBtn').click()">بازگشت</button>
                </div>

            </div>
        </div>
    </div>



    </div>

    <!-- Scrollbar -->
    <button id="scroll_btn" class="p-0" title="بالای صفحه" onclick="topFunction()">
        <i class="far fa-caret-square-up"></i>
    </button>

    <script src="../../static/js/logincheck.js"></script>

    <script src="../../static/js/scroll_button_handler.js"></script>
    <!-- Intro Js -->
    <!-- <script src="../../static/js/graph/graph_tour.js"></script> -->
    <script src="../../static/js/tour.js"></script>


    <script>
        initSearchableSelects();

        let graph_type_name = null;
        let role_name = null;
        let left_paragraphs = [];
        let left_actor_form = [];
        let right_paragraphs = [];
        let right_actor_form = [];
        let documents_information_list = []


        init()
        async function init() {
            document.getElementById("graph_show").disabled = true;

            /****************** Actor Graph Types  List ****************************/

            let request_link = 'http://' + location.host + "/GetActorGraphTypes/";
            let response = await fetch(request_link).then(response => response.json());
            response = response["ActorGraphTypes"]

            for (let i = 0; i < response.length; i++) {
                const graph_type_id = response[i]["id"]
                const graph_type_name = response[i]["name"]

                const tag = "<option value=" + graph_type_id + " >" + graph_type_name + "</option>";

                document.getElementById("ActorGraphTypeSelect").innerHTML += tag
            }

            /****************** Min Sim  List ****************************/

            for (let i = 100; i >= 0; i -= 5) {
                const tag = "<option value=" + i + " >" + i + "</option>";

                document.getElementById("MinimumSimilarity").innerHTML += tag
            }

            /****************** Max Sim  List ****************************/

            for (let i = 100; i >= 0; i -= 5) {
                const tag = "<option value=" + i + " >" + i + "</option>";

                document.getElementById("MaximumSimilarity").innerHTML += tag
            }

            /****************** Role List ****************************/

            request_link = 'http://' + location.host + "/GetActorRoleList/";
            response = await fetch(request_link).then(response => response.json());
            response = response["ActorRoleList"]

            document.getElementById("ActorRoleSelect").innerHTML = "<option selected value=" + 'همه' + " >" + "برآیند نقش‌ها" + "</option>";

            for (let i = 0; i < response.length; i++) {
                const role_id = response[i]["id"]
                const role_name = response[i]["role_name"]

                let tag = "<option value='" + role_name + "' >" + role_name + "</option>";

                document.getElementById("ActorRoleSelect").innerHTML += tag
            }

            document.getElementById("graph_show").disabled = false;

            syncAllSelects()

            //user log
            let form_data = new FormData()
            let detail_type = "نمایش پنل"
            form_data.append('detail_type', detail_type);
            UserLog(form_data)
        }

        async function CountryChanged()
        {
            return 0;
        }


        async function ShowGraph() {
            await SpinnerModeFunction("Active");

            const country_id = document.getElementById("country").value
            const graph_type_id = document.getElementById("ActorGraphTypeSelect").value
            graph_type_name = $("#ActorGraphTypeSelect  option:selected").text();
            const min_sim = document.getElementById("MinimumSimilarity").value
            const max_sim = document.getElementById("MaximumSimilarity").value
            role_name = document.getElementById("ActorRoleSelect").value

            request_link = 'http://' + location.host + "/Get_Actors_Correlation_GraphData/"
                + country_id + "/" + graph_type_id + "/" + role_name + "/" + min_sim + "/" + max_sim + "/";
            response = await fetch(request_link).then(response => response.json());
            GraphData = response["GraphData"]

            //showActorsGraph('actorsGraph_graph_container', GraphData, 'UnDirected', country_id)

            showActorsGraph2('actorsGraph_graph_container', GraphData, country_id)

            await SpinnerModeFunction("Disable");

            //user log
            let form_data = new FormData()
            let detail_type = "نمایش گراف"
            let country_name = $("#country option:selected").text();
            let graph_type = $("#ActorGraphTypeSelect option:selected").text();
            let minimum_similarity = $("#MinimumSimilarity option:selected").text();
            let maximum_similarity = $("#MaximumSimilarity option:selected").text();
            let role_type = role_name;
            form_data.append('detail_type', detail_type);
            form_data.append('country_name', country_name);
            form_data.append('graph_type', graph_type);
            form_data.append('minimum_similarity', minimum_similarity);
            form_data.append('maximum_similarity', maximum_similarity);
            form_data.append('role_type', role_type);
            
            UserLog(form_data)


        }


        async function ComparisonFunctionCorrGraph(country_id, source_actor_id, other_actor_id) {
            startFullPageBlockUI();

            document.getElementById('total_comparison_chart').innerHTML = "";
            document.getElementById('motevali_comparison_chart').innerHTML = "";
            document.getElementById('hamkar_comparison_chart').innerHTML = "";
            document.getElementById('salahiat_comparison_chart').innerHTML = "";

            document.getElementById('Correlation_ModalHeader').innerHTML = 'مقایسه روند'

            let request_link = 'http://' + location.host + "/getComparisonTrendChartsData_ByAtorsID/"
                + country_id + "/" + source_actor_id + "/" + other_actor_id + "/";
            let response = await fetch(request_link).then(response => response.json());

            let comparison_charts_data = response["comparison_charts_data"];
            let correlation_values = response["correlation_values"];
            let source_actor_name = response["source_actor_name"];
            let other_actor_name = response["other_actor_name"];


            total_chart_data = comparison_charts_data['همه']
            motevali_chart_data = comparison_charts_data['متولی اجرا']
            hamkar_chart_data = comparison_charts_data['همکار']
            salahiat_chart_data = comparison_charts_data['دارای صلاحیت اختیاری']

            total_corr = correlation_values['همه']
            motevali_corr = correlation_values['متولی اجرا']
            hamkar_corr = correlation_values['همکار']
            salahiat_corr = correlation_values['دارای صلاحیت اختیاری']


            await showComparisonYearsLineChart('total_comparison_chart', total_chart_data, source_actor_name, other_actor_name, 'برآیند نقش‌ها', total_corr)
            await showComparisonYearsLineChart('motevali_comparison_chart', motevali_chart_data, source_actor_name, other_actor_name, 'متولی اجرا', motevali_corr)
            await showComparisonYearsLineChart('hamkar_comparison_chart', hamkar_chart_data, source_actor_name, other_actor_name, 'همکار', hamkar_corr)
            await showComparisonYearsLineChart('salahiat_comparison_chart', salahiat_chart_data, source_actor_name, other_actor_name, 'دارای صلاحیت اختیاری', salahiat_corr)
            stopFullPageBlockUI('جزئیات همبستگی');
            document.getElementById('Correlation_Comparison_Modal_btn').click()

        }


        async function ComparisonFunctionSimilarityGraph(country_id, source_actor_id, other_actor_id) {
            startFullPageBlockUI();
            let request_link = 'http://' + location.host + "/getComparisonSimilarityChartsData_ByActorsID/"
                + country_id + "/" + source_actor_id + "/" + other_actor_id + "/";
            let response = await fetch(request_link).then(response => response.json());

            let right = response["right"];
            let left = response["left"];
            let keywords = response["keywords"];

            let right_tag = 'http://' + location.host + "/actors_information/?country_id=" + country_id + "/?actor_id=" + right['id']
            document.getElementById('RightHeader').innerHTML = '<a href="' + right_tag + '">' + right['name'] + "</a>";
            let left_tag = 'http://' + location.host + "/actors_information/?country_id=" + country_id + "/?actor_id=" + left['id']
            document.getElementById('LeftHeader').innerHTML = '<a href="' + left_tag + '">' + left['name'] + "</a>";


            let keywords_tag = ''
            let index = 0;
            for(let keyword of Object.keys(keywords))
            {
                keywords_tag += '<div class="form-check-inline" style="margin-left: 1rem;margin-right: 0;">'+
                          '<input class="btn-check" type="checkbox" autocomplete="off" id="inlineCheckbox' + index.toString() + '" value="' + keyword +'" checked >'+
                          '<label class="btn btn-outline-primary white-hover" for="inlineCheckbox'+index.toString() +'">'+ keyword+ '(' + keywords[keyword] + ')' +'</label>'+
                          '</div>'
                index += 1;
            }
            document.getElementById('KeywordCheckList').innerHTML = keywords_tag

            left_paragraphs = left['paragraphs']
            left_actor_form = left['forms']
            right_paragraphs = right['paragraphs']
            right_actor_form = right['forms']

            await getNewParagraphs()

            stopFullPageBlockUI('جزئیات کلیدواژگان یکسان');
            document.getElementById('SimilarityModalBtn').click()

        }


        async function ComparisonFunctionAreaGraph(country_id, source_actor_id, other_actor_id) {
            startFullPageBlockUI();
            let request_link = 'http://' + location.host + "/getComparisonAreaChartsData_ByActorsID/"
                + country_id + "/" + source_actor_id + "/" + other_actor_id + "/";
            let response = await fetch(request_link).then(response => response.json());

            {#console.log(response)#}

            document.getElementById('AreaHeader').innerText = "جدول تطابق وظایف کنشگران کلان حوزه ی " + response.src + " و کلان حوزه ی " + response.dest

            let count = 0;
            documents_information_list = []
            for(let key of Object.keys(response['actors']))
            {
                let item = response['actors'][key]
                const detail_function = "DetailFunction(" + count + ")";
                const detail = '<button type="button" class="btn modal_btn" data-bs-toggle="modal" ' + ' onclick="' + detail_function + '" data-bs-target="#myModal">جزئیات</button>'
                count += 1;
                let paragraphs_text = ''
                for (let para of item['paragraphs']) {
                    paragraphs_text += '<li class="mb-3 lh-lg">' + para + '</li>'
                }
                paragraphs_text = '<ul>'+paragraphs_text+'</ul>'
                for(let form of item['forms'] )
                {
                    paragraphs_text = await highlight(paragraphs_text,[],[form])
                }
                let cols_id = key.split("#")
                let col1_link = 'http://' + location.host + "/actors_information/?country_id=" + country_id + "/?actor_id=" + cols_id[0]
                let col1 = '<a  target="to_blank" href="' + col1_link + '">' + item['col1'] + "</a>"
                let col2_link = 'http://' + location.host + "/actors_information/?country_id=" + country_id + "/?actor_id=" + cols_id[1]
                let col2 = '<a  target="to_blank" href="' + col2_link + '">' + item['col2'] + "</a>"
                documents_information_list.push({
                    'id':count,
                    'col1':col1,
                    'col2':col2,
                    'count':item['paragraphs'].length,
                    'detail':detail,
                    'paragraphs':paragraphs_text
                })

            }
            {#console.log(documents_information_list)#}
            $('#EdgeTable').empty();
            $('#EdgeTable').footable({
                "paging": {
                    "enabled": true,
                    strings: {
                         first: '»',
                         prev:'›',
                         next: '‹',
                         last: '«'
                     }
                },
                "filtering": {
                    "enabled": false
                },
                "sorting": {
                    "enabled": true
                },
                "empty": "سندی یافت نشد.",
                "columns": [{
                    "name": "id",
                    "title": "ردیف",
                    "breakpoints": "xs sm",
                    "type": "number",
                    "style": {
                        "width": "5%"
                    }
                }, {
                    "name": "col1",
                    "title": "کنشگران کلان حوزه " + response.src,
                    "style": {
                        "width": "35%"
                    }
                }, {
                    "name": "col2",
                    "title": "کنشگران کلان حوزه " + response.dest,
                    "style": {
                        "width": "35%"
                    }
                }, {
                    "name": "count",
                    "title": "تعداد وظایف یکسان",
                    "style": {
                        "width": "15%"
                    }
                }, {
                    "name": "detail",
                    "title": "جزئیات",
                    "style": {
                        "width": "15%"
                    }
                }
                ],
                "rows": documents_information_list
            });


            stopFullPageBlockUI('جزئیات کلان حوزه');
            document.getElementById('AreaModalBtn').click()

        }


        async function ComparisonFunction(country_id, source_actor_id, other_actor_id) {
            if(graph_type_name === "گراف کلیدواژگان یکسان")
                return await ComparisonFunctionSimilarityGraph(country_id, source_actor_id, other_actor_id)
            if(graph_type_name === "گراف همبستگی")
                return await ComparisonFunctionCorrGraph(country_id, source_actor_id, other_actor_id)
            if(graph_type_name === "گراف کلان حوزه ها")
                return await ComparisonFunctionAreaGraph(country_id, source_actor_id, other_actor_id)
        }


        function DetailFunction(id)
        {
            document.getElementById('AreaDetailText').innerHTML = documents_information_list[id]['paragraphs']
            document.getElementById('AreaModalBtn').click()
            document.getElementById('AreaDetailModalBtn').click()
        }

        async function getNewParagraphs(){
            let keywords = await getActiveKeywords()
            let left_paragraphs_text = await getParagraphs(keywords,left_paragraphs)
            let right_paragraphs_text = await getParagraphs(keywords,right_paragraphs)
            document.getElementById('RightDetails').innerHTML = await highlight(right_paragraphs_text,keywords,right_actor_form)
            document.getElementById('LeftDetails').innerHTML = await highlight(left_paragraphs_text,keywords,left_actor_form)
        }


        async function highlight(paragraph_text,keywords_list, actor_forms) {
            console.log("dwdw")
            console.log(actor_forms)

        // Highlight keywords
        for (let keyword of keywords_list) {
            if (keyword === '')
                continue
            let keyword_tag = "<span class= 'bg-info text-white  rounded px-1'>" + keyword + "</span>"
            paragraph_text = paragraph_text.replaceAll(" "+keyword+" ", " "+keyword_tag+" ");

        }

        let paragraph_actor_form = '##########';

        // highlight actors forms
        for(let form of actor_forms)
        {
            if(paragraph_text.includes(' ' + form + ' '))
            {
                paragraph_actor_form = form
                {#let actor_form_tag = "<span class='other_actors'>" + form + "</span>"#}
                {#paragraph_text = paragraph_text.replaceAll(' ' + form + ' ', ' ' + actor_form_tag + ' ');#}
            }
        }

        const motevali_keywords = ['موظف است', 'مکلف است', 'مکلف‌اند', 'موظف‌اند', 'موظفند', 'مکلفند', 'موظف به', 'مکلف به'];
        const hamkaran_keywords = ['با همکاری', 'باهمکاری'];
        const salahiat_keywords = ['مختار است', 'اختیار دارد', 'می‌تواند', 'می تواند', 'میتواند', 'می­تواند', 'می‏تواند', 'مجاز است'];

        if (role_name === 'متولی اجرا' || role_name === 'همه') {
            paragraph_text = await highlightMotevalian(paragraph_text, paragraph_actor_form, motevali_keywords, 'bg-primary')
        }
        if (role_name==='همکار' || role_name === 'همه') {
            paragraph_text = await highlightHamkaran(paragraph_text, paragraph_actor_form, hamkaran_keywords, 'bg-success');

        }
        if(role_name==='دارای صلاحیت اختیاری' || role_name === 'همه'){
            console.log('inside')
            paragraph_text = await highlightSalahiat(paragraph_text, paragraph_actor_form, salahiat_keywords, 'bg-warning')
        }


        return paragraph_text
    }


        async function getParagraphs(keywords,paragraphs){
            let result_ul = ''
            for (let para of paragraphs) {
                if(!hasKeyword(para,keywords))
                    continue;
                result_ul += '<li class="mb-3 lh-lg">' + para + '</li>'
            }
            return '<ul>'+result_ul+'</ul>'
        }


        function hasKeyword(para,keywords){
            for(let keyword of keywords)
            {
                if(para.includes(' '+keyword+' '))
                    return true
            }
            return false
        }


        async function getActiveKeywords(){
            let keywords = [];
            let index = 0;
            while (true)
            {
                let query = '#inlineCheckbox'+index.toString()
                if( $(query).length === 0)
                    break;
                if($(query).is(':checked'))
                    keywords.push($(query).val())
                index += 1;
            }
            return keywords
        }


        async function highlightMotevalian(paragraph_text, actor_form, pattern_keywords, bg_color) {


            for (let pattern_keyword of pattern_keywords) {

                /* Highlight with actors list */
                let pattern_keyword_tag = "<span class='bg-secondary text-white rounded px-1'>" + pattern_keyword + "</span>"

                let actor_with_postfix_1 = actor_form + ' ' + 'جمهوری اسلامی ایران'
                let actor_with_postfix_2 = actor_form + ' ' + 'ایران'
                let actor_with_postfix_3 = actor_form + ' ' + 'کشور'

                paragraph_text = paragraph_text.split('.').map((sentence) => {


                    if (sentence.includes(actor_form + ' ' + pattern_keyword)) {

                        let actor_tag = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + actor_form + "</span>"
                        sentence = sentence.replaceAll(actor_form + ' ' + pattern_keyword, actor_tag + ' ' + pattern_keyword_tag);

                    }
                    else if (sentence.includes(actor_with_postfix_1 + ' ' + pattern_keyword)) {
                        let actor_tag = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + actor_with_postfix_1 + "</span>"
                        sentence = sentence.replaceAll(actor_with_postfix_1 + ' ' + pattern_keyword, actor_tag + ' ' + pattern_keyword_tag);
                    }
                    else if (sentence.includes(actor_with_postfix_2 + ' ' + pattern_keyword)) {
                        let actor_tag = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + actor_with_postfix_2 + "</span>"
                        sentence = sentence.replaceAll(actor_with_postfix_2 + ' ' + pattern_keyword, actor_tag + ' ' + pattern_keyword_tag);
                    }
                    else if (sentence.includes(actor_with_postfix_3 + ' ' + pattern_keyword)) {
                        let actor_tag = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + actor_with_postfix_3 + "</span>"
                        sentence = sentence.replaceAll(actor_with_postfix_3 + ' ' + pattern_keyword, actor_tag + ' ' + pattern_keyword_tag);
                    }
                    else if (sentence.includes('(' + actor_form + ')' + ' ' + pattern_keyword)) {
                        let actor_tag = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + '(' + actor_form + ')' + "</span>"
                        sentence = sentence.replaceAll('(' + actor_form + ')' + ' ' + pattern_keyword, actor_tag + ' ' + pattern_keyword_tag);
                    }
                    else if (sentence.includes('(' + actor_with_postfix_1 + ')' + ' ' + pattern_keyword)) {
                        let actor_tag = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + '(' + actor_with_postfix_1 + ')' + "</span>"
                        sentence = sentence.replaceAll('(' + actor_with_postfix_1 + ')' + ' ' + pattern_keyword, actor_tag + ' ' + pattern_keyword_tag);
                    }
                    else if (sentence.includes('(' + actor_with_postfix_2 + ')' + ' ' + pattern_keyword)) {
                        let actor_tag = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + '(' + actor_with_postfix_2 + ')' + "</span>"
                        sentence = sentence.replaceAll('(' + actor_with_postfix_2 + ')' + ' ' + pattern_keyword, actor_tag + ' ' + pattern_keyword_tag);
                    }
                    else if (sentence.includes('(' + actor_with_postfix_3 + ')' + ' ' + pattern_keyword)) {
                        let actor_tag = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + '(' + actor_with_postfix_3 + ')' + "</span>"
                        sentence = sentence.replaceAll('(' + actor_with_postfix_3 + ')' + ' ' + pattern_keyword, actor_tag + ' ' + pattern_keyword_tag);
                    }

                    return sentence
                }).join('.')

            }



            /* Highlight with actors list */
            let eghdam_keywords = ['اقدام کند', 'اقدام‌کند', 'اقدام نماید', 'اقدام‌نماید']
            let non_eghdam_keywords = pattern_keywords.filter(x => !eghdam_keywords.includes(x));

            paragraph_text = paragraph_text.split('.').map((sentence) => {

                for (let e_kw of eghdam_keywords) {

                    let pattern_keyword_tag1 = "<span class='bg-secondary text-white rounded px-1'>" + e_kw + "</span>"

                    if (sentence.includes(e_kw) && !check_non_eghdam_kw_exists(sentence, non_eghdam_keywords)) {

                        let actor_tag1 = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + actor_form + "</span>"
                        sentence = sentence.replaceAll(actor_form + ' ', actor_tag1 + ' ');

                        sentence = sentence.replaceAll(e_kw, pattern_keyword_tag1);


                    }

                }

                return sentence
            }).join('.')




            return paragraph_text;


        }


        function check_non_eghdam_kw_exists(sentence, pattern_keywords) {
            for (let p_kw of pattern_keywords) {
                if (sentence.includes(p_kw)) {
                    return true;
                }
            }
            return false;

        }



        async function highlightHamkaran(paragraph_text, actor_form, pattern_keywords, bg_color) {
            const hamkaran_punctuations = ['،', ')', ':']
            const window_length = 100;

            let space_counter = 0;
            let detected_hamkaran_list = []


            /* Highlight pattern keywords and references */
            for (let pattern_keyword of pattern_keywords) {


                /* Highlight more with actors list */
                let regex = '', result, indices = [];

                if (pattern_keyword === 'با همکاری') {
                    regex = /با همکاری/gi;
                } else {
                    regex = /باهمکاری/gi;
                }

                while ((result = regex.exec(paragraph_text))) {
                    indices.push(result.index);
                }

                for (const index of indices) {

                    let start_index = (index + pattern_keyword.length);
                    let substring = paragraph_text.substring(start_index, start_index + window_length);
                    let current_substring = substring;


                    let actor_tag = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + actor_form + "</span>"
                    // substring = substring.replaceAll(' ' + actor_form + ' ', ' ' + actor_tag + ' ');
                    substring = substring.replaceAll(' ' + actor_form, ' ' + actor_tag);
                    substring = substring.replaceAll('(' + actor_form + ')', '(' + actor_tag + ')');

                    for (let symbol of hamkaran_punctuations) {

                        actor_tag = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + actor_form + "</span>"
                        substring = substring.replaceAll(' ' + actor_form + symbol, ' ' + actor_tag + symbol);

                    }

                    let actor_without_affix = actor_form.replaceAll('وزارت ', '').replaceAll('سازمان ', '').replaceAll(' جمهوری اسلامی ایران', '')

                    if (actor_without_affix !== 'اطلاعات' && actor_without_affix !=='کشور' && !substring.includes(actor_form)) {


                        actor_tag = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + actor_form + "</span>"
                        substring = substring.replaceAll(' ' + actor_without_affix + ' ', ' ' + actor_tag + ' ');
                        substring = substring.replaceAll('(' + actor_without_affix + ')', '(' + actor_tag + ')');

                        for (let symbol of hamkaran_punctuations) {


                            actor_tag = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + actor_form + "</span>"
                            substring = substring.replaceAll(' ' + actor_without_affix + symbol, ' ' + actor_tag + symbol);

                        }

                    }



                    paragraph_text = paragraph_text.replaceAll(current_substring, substring);

                }
                /* Highlight with actors list */
                let pattern_keyword_tag = "<span class='bg-secondary text-white rounded px-1'>" + pattern_keyword + "</span>"

                paragraph_text = paragraph_text.replaceAll(pattern_keyword, pattern_keyword_tag);

            }




            return paragraph_text;



        }

        async function highlightSalahiat(paragraph_text, actor_form, pattern_keywords, bg_color) {


            for (let pattern_keyword of pattern_keywords) {

                /* Highlight with actors list */
                let pattern_keyword_tag = "<span class='bg-secondary text-white rounded px-1'>" + pattern_keyword + "</span>"

                let actor_with_postfix_1 = actor_form + ' ' + 'جمهوری اسلامی ایران'
                let actor_with_postfix_2 = actor_form + ' ' + 'ایران'
                let actor_with_postfix_3 = actor_form + ' ' + 'کشور'

                paragraph_text = paragraph_text.split('.').map((sentence) => {


                    if (sentence.includes(actor_form + ' ' + pattern_keyword)) {
                        let actor_tag = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + actor_form + "</span>"
                        sentence = sentence.replaceAll(actor_form + ' ' + pattern_keyword, actor_tag + ' ' + pattern_keyword_tag);

                    }
                    else if (sentence.includes(actor_with_postfix_1 + ' ' + pattern_keyword)) {
                        let actor_tag = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + actor_with_postfix_1 + "</span>"
                        sentence = sentence.replaceAll(actor_with_postfix_1 + ' ' + pattern_keyword, actor_tag + ' ' + pattern_keyword_tag);
                    }
                    else if (sentence.includes(actor_with_postfix_2 + ' ' + pattern_keyword)) {
                        let actor_tag = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + actor_with_postfix_2 + "</span>"
                        sentence = sentence.replaceAll(actor_with_postfix_2 + ' ' + pattern_keyword, actor_tag + ' ' + pattern_keyword_tag);
                    }
                    else if (sentence.includes(actor_with_postfix_3 + ' ' + pattern_keyword)) {
                        let actor_tag = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + actor_with_postfix_3 + "</span>"
                        sentence = sentence.replaceAll(actor_with_postfix_3 + ' ' + pattern_keyword, actor_tag + ' ' + pattern_keyword_tag);
                    }
                    else if (sentence.includes('(' + actor_form + ')' + ' ' + pattern_keyword)) {
                        let actor_tag = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + '(' + actor_form + ')' + "</span>"
                        sentence = sentence.replaceAll('(' + actor_form + ')' + ' ' + pattern_keyword, actor_tag + ' ' + pattern_keyword_tag);
                    }
                    else if (sentence.includes('(' + actor_with_postfix_1 + ')' + ' ' + pattern_keyword)) {
                        let actor_tag = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + '(' + actor_with_postfix_1 + ')' + "</span>"
                        sentence = sentence.replaceAll('(' + actor_with_postfix_1 + ')' + ' ' + pattern_keyword, actor_tag + ' ' + pattern_keyword_tag);
                    }
                    else if (sentence.includes('(' + actor_with_postfix_2 + ')' + ' ' + pattern_keyword)) {
                        let actor_tag = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + '(' + actor_with_postfix_2 + ')' + "</span>"
                        sentence = sentence.replaceAll('(' + actor_with_postfix_2 + ')' + ' ' + pattern_keyword, actor_tag + ' ' + pattern_keyword_tag);
                    }
                    else if (sentence.includes('(' + actor_with_postfix_3 + ')' + ' ' + pattern_keyword)) {
                        let actor_tag = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + '(' + actor_with_postfix_3 + ')' + "</span>"
                        sentence = sentence.replaceAll('(' + actor_with_postfix_3 + ')' + ' ' + pattern_keyword, actor_tag + ' ' + pattern_keyword_tag);
                    }

                    return sentence
                }).join('.')

            }



            return paragraph_text;

        }


        async function showComparisonYearsLineChart(chart_container, chart_data, source_actor_name, other_actor_name, role_name, correlation_value) {



            document.getElementById(chart_container).innerHTML = ""

            // create a chart
            var chart = anychart.line();

            chart
                .animation(true)
                .padding([10, 60, 10, 0])


            // tooltip content font setting
            var tooltip = chart.tooltip();
            tooltip.fontFamily("vazir");

            // tooltip title font setting
            var title = chart.tooltip().title();
            title.fontFamily("vazir");

            // set the chart title
            chart_title = "نقش: " + role_name + '\n' + "میزان همبستگی: " + correlation_value + '\n'
            chart.title(chart_title);
            chart.title().fontFamily("vazir").textDirection('rtl');;

            // set the interactivity mode
            // chart.interactivity().hoverMode("single");


            var data = anychart.data.set(chart_data)


            var other_actor_series_data = data.mapAs({ x: 0, value: 2 });
            // create the second series, set the data and name  
            var other_actor_series = chart.line(other_actor_series_data);
            other_actor_series.name(other_actor_name);

            // configure the visual settings of the second series
            other_actor_series.normal().stroke("#ffc107", 2, "10 5", "round");
            other_actor_series.hovered().stroke("#ffc107", 4, "10 5", "round");
            other_actor_series.selected().stroke("#ffc107", 6, "10 5", "round");


            var source_actor_series_data = data.mapAs({ x: 0, value: 1 });
            // create the second series, set the data and name  
            var source_actor_series = chart.line(source_actor_series_data);
            source_actor_series.name(source_actor_name);

            // configure the visual settings of the second series
            source_actor_series.normal().stroke("#007bff", 2, "10 5", "round");
            source_actor_series.hovered().stroke("#007bff", 4, "10 5", "round");
            source_actor_series.selected().stroke("#007bff", 6, "10 5", "round");

            // set the titles of the axes
            chart.xAxis().title("سال");
            chart.yAxis().title("تعداد پاراگراف");


            // x axix labels font setting
            var xAxisLabels = chart.xAxis().labels();
            xAxisLabels.fontFamily("vazir");

            var yAxisLabels = chart.yAxis().labels();
            yAxisLabels.fontFamily("vazir");

            // Not allow labels overlapping
            var xAxis = chart.xAxis();
            xAxis.overlapMode("noOverlap");
            xAxis.title().fontFamily('vazir');
xAxis.title().fontWeight("bold");

            // xAxis.staggerMode(false);

            var yAxis = chart.yAxis();
            yAxis.title().fontFamily('vazir');
yAxis.title().fontWeight("bold");
            yAxis.title().height(40);

            // chart.xScale().mode('continuous');
            chart.yScale().ticks().allowFractional(false)

            // set the container id
            chart.container(chart_container);


            // enable the legend
            chart.legend(true);

            var legend = chart.legend();
            legend.fontFamily('vazir')

            // set position mode
            legend.positionMode("inside");
            // set position and alignement
            legend.position("top");
            legend.align("center");
            legend.itemsLayout("horizontalExpandable");

            // initiate drawing the chart
            chart.draw();
        }



        async function showActorsGraph(container, actors_graph_data, graph_type, country_id) {

            document.getElementById(container).innerHTML = ''
            // create a chart and set the data
            var chart = anychart.graph(actors_graph_data);

            // set the container id
            chart.container(container);


            chart.nodes().normal().height(35);
            chart.nodes().hovered().height(40);
            chart.nodes().selected().height(40);
            chart.nodes().normal().stroke(null);
            chart.nodes().selected().stroke("#1481c0", 3);

            chart.nodes().labels().enabled(true);
            chart.nodes().labels().format("{%actor_name}").fontFamily('vazir');
            chart.nodes().labels().fontSize(14);
            chart.nodes().labels().fontWeight(600);

            chart.nodes().tooltip().format("{%actor_name}");
            chart.nodes().tooltip().fontFamily('vazir');

            chart.edges().tooltip().fontFamily('vazir');
            if( graph_type_name == 'گراف کلان حوزه ها')
                chart.edges().tooltip().format(" کلان حوزه:  {%source_actor_name} \n کلان حوزه:  {%dest_actor_name}\n شباهت:  {%sim}");
            else
                chart.edges().tooltip().format(" کنشگر:  {%source_actor_name} \n کنشگر:  {%dest_actor_name}\n شباهت:  {%sim}");

            if (graph_type === "Directed") {
                chart.edges().arrows({
                    enabled: true,
                    size: 10,
                    position: '50%'
                });
            }
            // initiate drawing the chart
            chart.draw();

            chart.listen('dblClick', async function (event) {
                const click_tag = event.domTarget.tag;
                console.log(click_tag)
                if (click_tag["type"] === "node") {
                    window.open('http://' + location.host + "/actors_information/?country_id=" + country_id + "/?actor_id=" + click_tag["id"])
                } else if (click_tag["type"] === "edge") {
                    edges = actors_graph_data['edges']
                    edge_id = parseInt(click_tag['id'].split('_')[1])

                    selected_edge = edges[edge_id]

                    source_actor_id = selected_edge['from']
                    source_actor_name = selected_edge['source_actor_name']

                    dest_actor_id = selected_edge['to']
                    dest_actor_name = selected_edge['dest_actor_name']
                    
                    await ComparisonFunction(country_id,source_actor_id,dest_actor_id)

                }

            })

        }

        async function showActorsGraph2(mycontainer, actors_graph_data, country_id) {

            var select = $("#ChangeLayout");
            select.val(select.children(":first").val());

            document.getElementById(mycontainer).innerHTML = ""

            const Nodes_data = actors_graph_data["nodes"]
            const Edges_data = actors_graph_data["edges"]

            container = document.getElementById("actorsGraph_graph_container");
            const width = 0.88 * window.innerWidth
            const height = container.scrollHeight  || 500;
            let Graph_Object = new MyGraph("actorsGraph_graph_container", Nodes_data, Edges_data, {}, {}, width, height, "circular", "actorsGraph_ChangeLayout", false,
                "Yellow", "actorsGraph_DegreeSlider", "actorsGraph_WeightSlider", 1, 1, "actorsGraph_selected_node_table", "actorsGraph_selected_edge_table",
                "actorsGraph_SelectNeighbourImg", "actorsGraph_ShowHideImg", "شباهت", actorsGraph_node_dbl_click, actorsGraph_edge_dbl_click,
                "actorsGraph_SearchBox", "actorsGraph_SearchBtn")

            await Graph_Object.show()

        }

        async function actorsGraph_node_dbl_click(node_data)
        {
            const country_id = document.getElementById("country").value
            window.open('http://' + location.host + "/actors_information/?country_id=" + country_id + "/?actor_id=" + node_data["id"])
        }
        async function actorsGraph_edge_dbl_click(edge_data)
        {
            const country_id = document.getElementById("country").value
            const source_actor_id = edge_data['source']
            const dest_actor_id = edge_data['target']
            await ComparisonFunction(country_id,source_actor_id,dest_actor_id)
        }

        async function SpinnerModeFunction(mode) {
                if (mode === "Active") {
                    $(".spinner-border").addClass("active");
                } else if (mode === "Disable") {
                    $(".spinner-border").removeClass("active");
                }
        }

    </script>

</body>


<!-- save log user -->
<script>
    async function UserLog(form_data) {
        if (getCookie("username") !== "") {
            const user_name = getCookie("username")
            let page_url = window.location.pathname
            const user_ip = "127.0.0.0"

            page_url = page_url.slice(0, -1);
            if (page_url === "") {
                page_url = "/0";
            }


            let link_request = 'http://' + location.host + "/UserLogSaved/" + user_name + page_url + "/" + user_ip + "/";

            $.ajax({
                url: link_request,
                data: form_data,
                type: 'POST',
                contentType: false,
                processData: false,
                async: true,


            }).done(function (res) {
                console.log("done")

            }).fail(function (res) {
                console.log("fail")
            });

        }
    }
</script>
<!-- Intro Js -->
<script src="../../static/js/graph/graph_tour.js">
</script>
<script src="../../static/js/tour.js"></script>

<!-- {#
<script src="../../static/js/UserLogSave.js"></script>#} -->
<script src="../../static/js/signout_function.js"></script>

<!-- BS Tooltips handler -->
<script src="../../static/js/tooltip_handler.js"></script>


<!-- Blocking UI -->
<script src="../../static/js/blockUI.js"></script>
<script src="../../static/js/blockUI_handler.js"></script>
<link rel="stylesheet" href="../../static/styles/loader.css">

</html>