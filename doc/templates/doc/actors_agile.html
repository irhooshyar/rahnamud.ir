<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" type="text/css" href="../../static/library/bootstrap.min-4.5.2.css">
    <link rel="stylesheet" type="text/css" href="../../static/library/bootstrap.min-5.1.2npm.css">

    <script src="../../static/js/jquery_351/jquery.min.js"></script>
    <script src="../../static/library/bootstrap-5.1.2.bundle.min.js"></script>

    <!--BS Icons -->
    <link rel="stylesheet" href="../../static/library/bootstrap-icons-1.3.0.css">
    <!-- Fontawesome Icons -->

    <link rel="stylesheet" href="../../static/library/fontawesome-5.10.0.all.css"  />
    <link rel="stylesheet" href="../../static/library/font-awesome.min-4.7.0.css">


    <!-- anychart modules -->
    <script src="../../static/library/anychart-8.10.0-core.min.js"></script>
    <script src="../../static/library/anychart-8.10.0-graph.min.js"></script>
    <script src="../../static/library/anychart-8.10.0-pie.min.js"></script>
    <script src="../../static/library/anychart-8.10.0-exports.min.js"></script>
    <script src="../../static/library/anychart-8.10.0-cartesian.min.js"></script>
    <script src="../../static/library/anychart-8.10.0-radar.min.js"></script>

    <link rel="stylesheet" type="text/css" href="../../static/library/tom-select-2.2.1.css">
    <script src="../../static/library/tom-select.complete-2.2.1.min.js"></script>
    <script type="text/javascript" src="../../static/js/searchable-select.js"></script>

    <!-- Multi Select  -->
    <link rel="stylesheet" type="text/css" href="../../static/styles/multiselect/multiselect-style.css">
    <script type="text/javascript" src="../../static/js/multiselect/jquery-2.2.4.min.js"></script>
    <script type="text/javascript" src="../../static/js/multiselect/jquery.multi-select.js"></script>





    <!-- Footable  -->
    <script src="../../static/js/footable/demo-rows.js"></script>
    <script src="../../static/js/footable/ie10-viewport-bug-workaround.js"></script>
    <script src="../../static/js/footable/footable.js"></script>
    <link href="../../static/styles/footable/footable.bootstrap.min.css" rel="stylesheet">
    <link href="../../static/styles/footable/docs.css" rel="stylesheet">
    <link href="../../static/styles/footable/FooTable.Glyphicons.css" rel="stylesheet">
    <link href="../../static/styles/footable/FooTable.FontAwesome.css" rel="stylesheet">

    <!-- Download Zip Files -->
    <script src="../../static/js/zipDownload/jszip.min.js"></script>
    <script src="../../static/js/zipDownload/FileSaver.min.js"></script>

    <link rel="stylesheet" href="../../static/styles/index2.css">
    <link rel="stylesheet" href="../../static/styles/adaptation.css">

    <link rel="stylesheet" type="text/css" href="../../static/library/jquerysctipttop.css">

    <!-- Intro Js -->
    <script src="../../static/library/intro.min-4.3.0.js"></script>
    <link rel="stylesheet" type="text/css" href="../../static/library/introjs.min-4.3.0.css">
    <link rel="stylesheet" type="text/css" href="../../static/library/introjs-rtl.min-4.3.0.css">
    <link rel="stylesheet" href="../../static/styles/user_guide_tour.css">

    <!-- Notyf  -->
    <link rel="stylesheet" type="text/css" href="../../static/library/notyf.min-npm.css">
    <script src="../../static/library/notyf.min.js"></script>

    <!--<script type="text/javascript" src="http://l2.io/ip.js?var=myip">
    </script>-->
    <script src="../../static/js/chart.js"></script>

    <title>چابک سازی کنشگران</title>
    {% include "doc/title_icon.html" %}

</head>

<body>
    {% load static %}
    <!-- Menu -->
    <nav dir="rtl" class="navbar nav_menu navbar-expand-lg fixed-top p-0 mt-0">
        {% include "doc/header2.html" %}
    </nav>

    <script>
        $(document).ready(function () {

            // Active panel
            $('#ActorsDropdown').addClass('active');
            $('#actors_agile').addClass('active');

            $('select#language').on('change', function (e) {

                let selected_language = this.value;
                let current_url = window.location.href;
                if (selected_language === 'England') {
                    let page_name = current_url.split('/')[3]
                    let requested_url = current_url.replace(page_name, 'en')
                    window.location = requested_url;
                } else if (selected_language === 'Russia') {
                    let page_name = current_url.split('/')[3]
                    let requested_url = current_url.replace(page_name, 'ru')
                    window.location = requested_url;
                }

            });
        });
    </script>

    <!-- Main Container includes: Form Fields, Tab Pills, Tab Panes -->
    <div class="row flex-row-reverse px-0 py-5 px-md-5 py-md-5 m-0 mt-4">

        <!-- Form Fields -->
        <!-- Form Fields -->
        <form action="" class="custom-control mx-auto needs-validation" id="info_form" enctype="multipart/form-data"
            method="post" novalidate>

            <!-- Primary Fields in First Row -->
            <div class="row flex-row-reverse mt-2 mx-auto">

                <!-- Country Input -->
                <div class="col-md-6  pt-3 col-12 col-lg-2 mt-1 bg-light" dir="rtl">

                    <label class=" text-right bg-light float-right" style="direction: rtl;;">مجموعه سند:</label>
                    <select dir="rtl" id="country" name="country" class="form-select text-right float-right searchable-select"
                        style="direction: rtl;" onchange="CountryChanged()">
                        {% for k,v in countries.items %}
                        <option value="{{ k }}">{{ v }}</option>
                        {% endfor %}
                    </select>

                </div>


                <!-- Actor Area-->
                <div class="col-md-6  pt-3 col-12 col-lg-2 mt-1 bg-light" dir="rtl">

                    <label class=" text-right bg-light float-right" style="direction: rtl;;">حوزه:</label>

                    <select id="ActorAreaSelect" onchange="AreaChanged()" class="form-select text-right float-right searchable-select"
                        style="direction: rtl;">
                    </select>

                </div>

                <!-- Actor Sub-Area-->
                <div class="col-md-6  pt-3 col-12 col-lg-2 mt-1 bg-light" dir="rtl">

                    <label class=" text-right bg-light float-right" style="direction: rtl;;"> زیر حوزه:</label>

                    <select disabled id="ActorSubAreaSelect" onchange="SubAreaChanged()"
                        class="form-select text-right float-right searchable-select" style="direction: rtl;">
                    </select>

                </div>

                <!-- Actor Type-->
                <div class="col-md-6  pt-3 col-12 col-lg-2 mt-1 bg-light" dir="rtl">

                    <label class=" text-right bg-light float-right" style="direction: rtl;;">نقش:</label>

                    <select id="ActorTypeSelect" class="form-select text-right float-right searchable-select" style="direction: rtl;">
                        <option value="1">برایند نقش ها</option>
                        <option value="2">متولی اجرا</option>
                        <option value="3">همکار</option>
                        <option value="4">دارای صلاحیت اختیاری</option>
                    </select>

                </div>

                <!-- Year -->
                <div class="col-md-6  pt-3 col-12 col-lg-2 mt-1 bg-light" dir="rtl">

                    <label class=" text-right bg-light float-right" style="direction: rtl;;">حداقل سال عدم فعالیت:</label>

                    <select id="YearSelect" class="form-select text-right float-right searchable-select" style="direction: rtl;">
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                    </select>

                </div>

                <!--  Buttons -->
                <div class="col-lg-2 col-md-6 pt-5 mt-1 col-12">
                    <button type="button" id="document_search" onclick="ShowResult()"
                        class="btn d-flex float-right mr-2">
                        <div class="spinner-border text-light" role="status">
                            <span class="sr-only">درحال جستجو ...</span>
                        </div>
                        نمایش
                    </button>
                </div>

            </div>


        </form>

        <div dir="rtl" class="row w-100 p-0">
            <!--Original Tabs -->
            <ul id="original_tabs" class="nav nav-pills mt-5 mx-auto  pr-3 pr-sm-0  float-right  d-block" id="pills-tab"
                role="tablist">

                <li class="nav-item float-right" role="presentation">
                    <button id="search_result_tab" class="nav-link active" data-bs-toggle="pill"
                        data-bs-target="#search_result_pane" type="button" role="tab" aria-controls="search_result_pane"
                        aria-selected="true">نتایج جست‌وجو</button>
                </li>

                <li class="nav-item float-right" role="presentation">
                    <button id="bar_chart_info_tab" class="nav-link" data-bs-toggle="pill"
                        data-bs-target="#bar_chart_info_pane" type="button" role="tab"
                        aria-controls="bar_chart_info_pane" aria-selected="false">داشبورد آماری</button>
                </li>

                <!-- Result Count -->
                <p id="SearchResultLable" class="text-left float-left text-secondary pl-2"></p>
            </ul>

            <!-- Original Panes -->
            <div id="original_pane" class="tab-content float-right px-1" id="pills-tabContent">

                <!-- Search Result Pane -->
                <div id="search_result_pane" class="tab-pane w-100 fade show active float-right" role="tabpanel"
                    aria-labelledby="search_result_tab">
                    <div class="float-left">
                        <!-- Download Buttons -->

                        <button class="btn float-left p-0 px-1 mt-2" id="ExportExcel" data-bs-toggle="tooltip"
                                data-bs-placement="top" title="خروجی اکسل" onclick="ExportExcelSerachResultFunction()"
                                type="button">
                            <i class="far fa-file-excel text-success m-0" style="font-size: 25px;margin: 0px;"></i>
                        </button>
                    </div>
                    <!-- Search Result table -->
                    <div class="table-responsive search_result_table mt-4">
                        <table class="table table-striped SearchTable" style="min-height: 200px;" id="SearchTable">
                        </table>
                    </div>
                </div>

                <!-- Bar chart Info Pane -->
                <div dir="rtl" style="min-height: 200px;" class="tab-pane fade float-right w-100"
                    id="bar_chart_info_pane" role="tabpanel" aria-labelledby="bar_chart_info_tab">

                    <div class="row mt-4 w-100 flex-row-reverse justify-content-around mx-0 px-0">
                        <div id="actor_container" class="full" chart-height="2000px"/>
                    </div>
                </div>

            </div>
        </div>
    </div>


    <!-- Modal Container -->
    <div class="modal fade" id="myModal">
        <div class="modal-dialog modal-dialog-scrollable modal-xl">
            <div class="modal-content">

                <!-- Modal Header -->
                <div style="direction: rtl !important;" class="modal-header">
                    <h5 id="ModalHeader" class="modal-title">تحلیل روند</h5>
                    <button type="button" class="btn-close m-0" data-bs-dismiss="modal"></button>
                </div>

                <!-- Modal body -->
                <!-- Time Series Chart  Pane -->
                    <div id="time_series_analysis_pane" class="tab-pane w-100 float-right" role="tabpanel"
                        aria-labelledby="time_series_analysis_tab">


                        {% comment %} <button id="ARIMA_chart_btn" onclick="PredictionFunction('ARIMA')" class="btn px-1 py-0 mr-2 mt-1"
                            type="button" data-bs-toggle="modal" data-bs-target="#Correlation_Comparison_Modal">
                            <img data-bs-toggle="tooltip" data-bs-placement="left" title="ARIMA" width="32px" height="32px"
                                src="{% static 'icons/chart_icons/ARIMA_1.png' %}" alt="">
                        </button>
                        <br>


                        <button id="LSTM_chart_btn" disabled onclick="PredictionFunction('LSTM')" type="button"
                            data-bs-toggle="modal" data-bs-target="#Correlation_Comparison_Modal"
                            class="btn px-1 py-0 mr-2 my-1">
                            <img data-bs-toggle="tooltip" data-bs-placement="left" title="LSTM" width="32px" height="32px"
                                src="{% static 'icons/chart_icons/LSTM_1.png' %}" alt="">
                        </button> {% endcomment %}

                        <div id="trend_charts" class="row mt-4 w-100 flex-row mx-0 px-4 pb-5">


                            <div dir="ltr" id="time_series_analysis_chart_container" style="height: 450px"
                                class="bg-white w-100 p-1">
                            </div>

                        </div>

                    </div>
                <!-- Modal footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">بستن</button>
                </div>

            </div>
        </div>
    </div>


    <!-- ChartModal Container -->
    <button type="button" id="ChartModalBtn" class="btn d-none modal_btn" data-bs-toggle="modal"
        data-bs-target="#ChartModal"></button>
    <div class="modal fade" id="ChartModal">
        <div class="modal-dialog modal-dialog-scrollable modal-lg">
            <div class="modal-content">

                <!-- Modal Header -->
                <div style="direction: rtl !important;" class="modal-header">
                    <h5 id="ChartModalHeader" class="modal-title">عنوان</h5>
                    <button type="button" class="btn-close m-0" data-bs-dismiss="modal"></button>
                </div>

                <!-- Modal body -->
                <div id="ChartModalText" class="modal-body text-justify">
                </div>

                <!-- Modal footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">بستن</button>
                </div>

            </div>
        </div>
    </div>

    <!-- Scrollbar -->
    <button id="scroll_btn" class="p-0" title="بالای صفحه" onclick="topFunction()">
        <i class="far fa-caret-square-up"></i>
        <!-- <i class="bi bi-chevron-up"></i> -->
        <!-- <i class="bi bi-chevron-double-up"></i> -->
        <!-- <i class="bi bi-arrow-up-circle"></i> -->
    </button>

    <script src="../../static/js/logincheck.js"></script>

    <script src="../../static/js/scroll_button_handler.js">
    </script>
    <!-- Intro Js -->
    <script src="../../static/js/search/search_tour.js"></script>
    <script src="../../static/js/tour.js"></script>

<script>
    all_type = {
        1: 'برایند نقش ها',
        2: 'متولی اجرا',
        3: 'همکار',
        4: 'دارای صلاحیت اختیاری'
    }
    initSearchableSelects()
    init()

    let SearchResultValue = {}

    container_id_list = ['SearchTable','SearchResultLable','time_series_analysis_chart_container']

    function clearPrevResults(container_id_list) {
        for (container_id of container_id_list) {
            document.getElementById(container_id).innerHTML = "";
        }
    }

    async function init() {
        document.getElementById("document_search").disabled = true;

        /* Get Actors List */
        let request_link = 'http://' + location.host + "/GetActorsList/";
        let response = await fetch(request_link).then(response => response.json());
        actors_list = response["actorsList"];

        /* Get Actors Dict */
        request_link = 'http://' + location.host + "/GetActorsDict/";
        response = await fetch(request_link).then(response => response.json());
        actors_dict = response['actorsDict']


        const country_id = document.getElementById("country").value
        document.getElementById("document_search").disabled = true;


        /****************** Actors Area List ****************************/

        request_link = 'http://' + location.host + "/GetActorAreaList/";
        response = await fetch(request_link).then(response => response.json());
        response = response["ActorAreaList"]
        let options = [{ value:'0', text: 'همه' }];
        for (let i = 0; i < response.length; i++) {
            const area_id = response[i]["id"]
            const area_name = response[i]["area_name"]

            options.push({ value: area_id, text: area_name});

        }
        syncSelectOptions("ActorAreaSelect", options)

        document.getElementById("document_search").disabled = false;

        //user log
        let form_data = new FormData()
        let detail_type = "نمایش پنل"
        form_data.append('detail_type', detail_type);
        UserLog(form_data)


    }


    async function ShowResult() {
        clearPrevResults(container_id_list);
        await SpinnerModeFunction("Active");
        startBlockUI('search_result_pane');
        startBlockUI('bar_chart_info_pane');

        const country_id = document.getElementById("country").value;
        const area_id = document.getElementById("ActorAreaSelect").value;
        const type = document.getElementById("ActorTypeSelect").value;
        const year = document.getElementById("YearSelect").value;

        request_link = 'http://' + location.host + "/GetActorTimeSeries_Agile/" + year + "/" + type + "/" + country_id + "/" + area_id + "/" ;
        response = await fetch(request_link).then(response => response.json());

        SearchResultValue = response['actors']
        SearchResultValue['ActorTypeSelect'] = type;
        notyf.dismissAll();

        /* Get Actors Info */
        await getActorsAgileInfo(response);
        stopBlockUI('search_result_pane', 'نتایج جستجو');

        /* Show Chart  */
        await showChartData(response['actors'], "actor_container",  false)
        stopBlockUI('bar_chart_info_pane', 'داشبورد آماری');

        await SpinnerModeFunction("Disable");

        //user log
        let form_data = new FormData()
        let detail_type = "نتایج جست و جو"
        let country_name = $("#country option:selected").text();
        let min_year = year;
        let ActorArea_doc = $("#ActorAreaSelect option:selected").text();
        let ActorType_doc = $("#ActorTypeSelect option:selected").text();
        form_data.append('detail_type', detail_type);
        form_data.append('country_name', country_name);
        form_data.append('min_year', min_year);
        form_data.append('ActorArea_doc', ActorArea_doc);
        form_data.append('ActorType_doc', ActorType_doc);
        UserLog(form_data)
    }


    function showChartData(data, container, keySort) {
        let chart_data = []
        for (const actor of data) {
            chart_data.push([actor['actor_name'], actor['year_count'], actor['years']])
        }
        showChart(chart_data, container, keySort)
    }


    function showChart(data, container, keySort) {
        const options = {
            data,
            keySort,
            xAxisTitle: "نام کنشگر",
            yAxisTitle: "تعداد سال‌های بدون فعالیت",
            title: "نمودار سال‌های عدم فعالیت هر کنشگر",
            onclick: async function (event, data) {
            const click_tag = event.domTarget.tag;

            const index = click_tag["index"]
            console.log(data.row(index))
            const actor = data.row(index)[0];
            const years = data.row(index)[2]
            let header = "نام کنشگر: " + actor

            document.getElementById("ChartModalHeader").innerText = header
            document.getElementById("ChartModalText").innerHTML = ""
            i = 1
            for (year of years) {
                document.getElementById("ChartModalText").innerHTML += '<p>' + i + ". " + year['start_year'] + '-' + year['end_year'] + '</p>';
                i += 1
            }
            $("#ChartModalBtn").click();
        }
        }
        newBarChart(container, options);
    }


    async function getActorsAgileInfo(response) {
        let index = 1;
        let actor_result = [];

        document.getElementById("SearchTable").innerHTML = "";
        const type = all_type[document.getElementById("ActorTypeSelect").value]

        for (let actor of response['actors']) {
            const id = actor['id']
            const name = actor['actor_name']
            const country_id = actor['country_id']
            const actor_id = actor['actor_id']
            const years = actor['years']
            const proposed_actors = actor['proposed_actors']

            const actor_link = 'http://' + location.host + "/actors_information/?country_id=" + country_id + "/?actor_id=" + actor_id
            const actor_name = '<a target="_blank" href="' + actor_link + '">' + name + "</a>"

            const detail_function = "ActorDetailFunction('" + country_id + "','" + actor_id + "')"
            const detail = '<button type="button" class="btn modal_btn" data-bs-toggle="modal" ' + ' onclick="' + detail_function + '" data-bs-target="#detailModal">جزئیات</button>'

            year_tag = ''
            for (year of years) {
                year_tag += year['start_year'] + '-' + year['end_year'] + '<br>'
            }

            proposed_actors_tag = ''
            for (proposed_actor of proposed_actors) {
                const proposed_actor_link = 'http://' + location.host + "/actors_information/?country_id=" + proposed_actor['country_id'] + "/?actor_id=" + proposed_actor['actor_id']
                proposed_actors_tag += '<a target="_blank" href="' + proposed_actor_link + '">' + proposed_actor['name'] + "</a>"
            }
            const row = { "index": index, "name": actor_name, "year": year_tag, "time_series_analysis":detail, "proposed_actors": proposed_actors_tag ,'type':type};

            actor_result.push(row);
            index += 1;

        }
        document.getElementById("SearchResultLable").innerText = (index-1).toString() + " کنشگر یافت شد";

        $('#SearchTable').empty();
        $('.SearchTable').footable({
            "paging": {
                "enabled": true,
                 strings: {
                         first: '»',
                         prev:'›',
                         next: '‹',
                         last: '«'
                     }
            },
            "filtering": {
                "enabled": false
            },
            "sorting": {
                "enabled": true
            },
            "empty": "کنشگری یافت نشد.",
            "columns": [{
                "name": "index",
                "title": "ردیف",
                "breakpoints": "xs sm",
                "type": "number",
                "style": {
                    "width": "5%"
                }
            }, {
                "name": "name",
                "title": "نام کنشگر",
                "style": {
                    "width": "20%"
                }
            }, {
                "name": "type",
                "title": "نقش کنشگر",
                "style": {
                    "width": "10%"
                }
            }, {
                "name": "proposed_actors",
                "title": "کنشگران مناسب برای ادغام",
                "style": {
                    "width": "20%"
                }
            }, {
                "name": "year",
                "title": "بازه عدم فعالیت",
                "style": {
                    "width": "10%"
                }
            }, {
                "name": "time_series_analysis",
                "title": "تحلیل روند",
                "style": {
                    "width": "10%"
                }
            }
            ],
            "rows": actor_result
        });
    }

    async function ActorDetailFunction(country_id, actor_id) {
        document.getElementById('time_series_analysis_chart_container').innerHTML = "";
        $('#myModal').modal('show');
        await getTimeSeriesChartData(country_id, actor_id,'time_series_analysis_chart_container', 'تحلیل زمانی');
    }

    /************** Time-Series chart data tab ***************************************/

    async function getTimeSeriesChartData(country_id , actor_id, container_id, tab_name) {

        startBlockUI(container_id);

        let request_link = 'http://' + location.host + "/GetActorTimeSeries_ChartData/"
            + country_id + "/" + actor_id + "/";
        let response = await fetch(request_link).then(response => response.json());

        let years_chart_data = response["years_chart_data"];

        let years_chart_data_predict = response["predictions"];
        let lstm_chart_data = response["lstm_chart_data"];

        let last_year = response["last_year"];
        let actor_name = response["actor_name"];

        await showYearsLineChart(container_id, actor_name, years_chart_data, country_id, years_chart_data_predict, last_year, 'ARIMA')

        stopBlockUI(container_id, tab_name);
    }


    async function showYearsLineChart(chart_container, actor_name, chart_data, country_id, chart_data_predict, last_year, model_name) {


        document.getElementById(chart_container).innerHTML = ""

        // create a chart
        var chart = anychart.line();

        chart
            .animation(true)
            .padding([10, 60, 10, 0])


        // tooltip content font setting
        var tooltip = chart.tooltip();
        tooltip.fontFamily("vazir");

        // tooltip title font setting
        var title = chart.tooltip().title();
        title.fontFamily("vazir");

        // set the chart title
        chart_title = "کنشگر: " + actor_name + '\n' + 'مدل پیش‌بینی‌گر: ' + model_name + "\n"
        chart.title(chart_title);
        chart.title().fontFamily("vazir").textDirection('rtl');;

        // set predict Line

        year_line = last_year

        var marker = chart.lineMarker();
        // marker.axis(chart);
        marker.layout("vertical");
        marker.value(year_line);
        marker.stroke({
            thickness: 2,
            color: "#0D0",
            dash: "2 4"
        });

       // add prdict data
        chart_data = chart_data.concat(chart_data_predict)
        // set the interactivity mode
        // chart.interactivity().hoverMode("single");
        trend_started = false
        edited_chart_data = []

        for (column of chart_data) {
            total_count = column[4]
            if (total_count == 0 && !trend_started) {

            } else {
                edited_chart_data.push(column);
                trend_started = true
            }
        }

        var data = anychart.data.set(edited_chart_data)

        var total_series_data = data.mapAs({ x: 0, value: 4 });
        // create the second series, set the data and name
        var total_series = chart.line(total_series_data);
        total_series.name("برآیند نقش‌ها");

        // configure the visual settings of the second series
        total_series.normal().stroke("#6a0dad", 2, "10 5", "round");
        total_series.hovered().stroke("#6a0dad", 4, "10 5", "round");
        total_series.selected().stroke("#6a0dad", 6, "10 5", "round");


        var hamkaran_series_data = data.mapAs({ x: 0, value: 2 });
        // create the second series, set the data and name
        var hamkaran_series = chart.line(hamkaran_series_data);
        hamkaran_series.name("همکار");

        // configure the visual settings of the second series
        hamkaran_series.normal().stroke("#28a745", 2, "10 5", "round");
        hamkaran_series.hovered().stroke("#28a745", 4, "10 5", "round");
        hamkaran_series.selected().stroke("#28a745", 6, "10 5", "round");


        // map the data
        var salahiat_series_data = data.mapAs({ x: 0, value: 3 });

        // create the first series, set the data and name
        var salahiat_series = chart.line(salahiat_series_data);
        salahiat_series.name("دارای صلاحیت اختیاری");

        // configure the visual settings of the first series
        salahiat_series.normal().stroke("#ffc107", 2, "10 5", "round");
        salahiat_series.hovered().stroke("#ffc107", 4, "10 5", "round");
        salahiat_series.selected().stroke("#ffc107", 6, "10 5", "round");


        var motevalian_series_data = data.mapAs({ x: 0, value: 1 });
        // create the first series, set the data and name
        var motevalian_series = chart.line(motevalian_series_data);
        motevalian_series.name("متولی اجرا");

        // configure the visual settings of the first series
        motevalian_series.normal().stroke("#007bff", 2, "10 5", "round");
        motevalian_series.hovered().stroke("#007bff", 4, "10 5", "round");
        motevalian_series.selected().stroke("#007bff", 6, "10 5", "round");
        // set the chart title

        // set the titles of the axes
        chart.xAxis().title("سال");
        chart.yAxis().title("تعداد وظایف");


        // x axix labels font setting
        var xAxisLabels = chart.xAxis().labels();
        xAxisLabels.fontFamily("vazir");
        xAxisLabels.rotation(315);

        var yAxisLabels = chart.yAxis().labels();
        yAxisLabels.fontFamily("vazir");

        // Not allow labels overlapping
        var xAxis = chart.xAxis();
        xAxis.overlapMode("noOverlap");
        xAxis.title().fontFamily('vazir');
        xAxis.title().fontWeight("bold");

        // xAxis.staggerMode(false);

        var yAxis = chart.yAxis();
        yAxis.title().fontFamily('vazir');
        yAxis.title().fontWeight("bold");
        yAxis.title().height(40);

        // chart.xScale().mode('continuous');
        chart.yScale().ticks().allowFractional(false)

        // set the container id
        chart.container(chart_container);


        // enable the legend
        chart.legend(true);

        var legend = chart.legend();
        legend.fontFamily('vazir')

        // set position mode
        legend.positionMode("inside");
        // set position and alignement
        legend.position("top");
        legend.align("center");
        legend.itemsLayout("horizontalExpandable");

        // initiate drawing the chart
        chart.draw();
    }


    function popup_handler() {
        var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'))
        var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
            return new bootstrap.Popover(popoverTriggerEl)
        });
    }

    async function SpinnerModeFunction(mode) {
        if (mode === "Active") {
            $(".spinner-border").addClass("active");
        } else if (mode === "Disable") {
            $(".spinner-border").removeClass("active");
        }
    }

    async function CountryChanged() {
        clearPrevResults(container_id_list);
        await init();
    }

    async function AreaChanged() {

        document.getElementById("document_search").disabled = true;
        document.getElementById('ActorSubAreaSelect').innerHTML = '' +
            '<label class=" text-right bg-light float-right" style="direction: rtl;">زیر حوزه:</label>' +
            '<select id="ActorSubAreaSelect" onchange="SubAreaChanged()" class="form-select text-right float-right" style="direction: rtl;">' +
            '</select>'

        let selected_area_id = document.getElementById('ActorAreaSelect').value
        let request_link = 'http://' + location.host + "/GetSubAreasByAreaId/" + selected_area_id + "/";
        let response = await fetch(request_link).then(response => response.json());
        response = response["SubAreaList"];


        let options = [{ value:'0', text: 'همه' }];

        for (let i = 0; i < response.length; i++) {
            const sub_area_id = response[i]["id"]
            const sub_area_name = response[i]["name"]

            options.push({ value: sub_area_id, text: sub_area_name});

        }
        syncSelectOptions("ActorSubAreaSelect", options)
        document.getElementById("document_search").disabled = false;

    }


</script>

<script src="../../static/js/zipDownload/jszip.min.js"></script>
<script src="../../static/js/zipDownload/FileSaver.min.js"></script>
<script>

    async function ExportExcelSerachResultFunction() {
        var csv = "";

        sep = ","
        index = 1

        let Csv = "ردیف"+ sep + "نام کنشگر" + sep + "نقش کنشگر" + sep + "کنشگران مناسب برای ادغام" + sep +
            "سال" + "\n"
        for (const actor of SearchResultValue) {
            proposed_actors = actor['proposed_actors']
            years = actor['years']
            pa = ""
            year = ""
            for (const proposed_actor of proposed_actors) {
                pa += proposed_actor['name'] + "/"
            }
            for (const y of years) {
                year += y['start_year'] + "-" + y['end_year'] + "/"
            }
            type = all_type[SearchResultValue['ActorTypeSelect']]
            Csv += index + sep + actor['actor_name'] + sep + type + sep + pa + sep + year + "\n"

            index += 1
        }

        let save_file_name = "چابک سازی کنشگران"

        let csvContent = "data:text/csv;charset=utf-8,%EF%BB%BF" + encodeURI(Csv);
        var link = document.createElement("a");
        link.setAttribute("href", csvContent);
        link.setAttribute("download", save_file_name + ".csv");
        document.body.appendChild(link);
        link.click()
    }



    /* Search after press Enter */
    $("#info_form").submit(function () { return false; });
    $("#SearchBox").keyup(function (event) {
        event.preventDefault();
        if (event.keyCode === 13) {
            $("#document_search").click();
        }
    });

</script>
</body>

<!-- save log user -->
<script>
    async function UserLog(form_data) {
        if (getCookie("username") !== "") {
            const user_name = getCookie("username")
            let page_url = window.location.pathname
            const user_ip = "127.0.0.0"
            page_url = page_url.slice(0, -1);
            if (page_url === "") {
                page_url = "/0";
            }


            let link_request = 'http://' + location.host + "/UserLogSaved/" + user_name + page_url + "/" + user_ip + "/";

            $.ajax({
                url: link_request,
                data: form_data,
                type: 'POST',
                contentType: false,
                processData: false,
                async: true,


            }).done(function (res) {
                console.log("done")

            }).fail(function (res) {
                console.log("fail")
            });

        }
    }
</script>

<script src="../../static/js/tooltip_handler.js"></script>

<!-- Intro Js -->
<script src="../../static/js/search/search_tour.js">
</script>
<script src="../../static/js/tour.js"></script>

<script src="../../static/js/signout_function.js"></script>


<!-- Blocking UI -->
<script src="../../static/js/blockUI.js"></script>
<script src="../../static/js/blockUI_handler.js"></script>
<link rel="stylesheet" href="../../static/styles/loader.css">


</html>