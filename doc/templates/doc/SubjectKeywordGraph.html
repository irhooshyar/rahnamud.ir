<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" type="text/css" href="../../static/library/bootstrap.min-4.5.2.css">
    <script src="../../static/js/jquery_351/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="../../static/library/bootstrap.min-5.1.2npm.css">
    <script src="../../static/library/bootstrap-5.1.2.bundle.min.js"></script>

    <!--BS Icons -->
    <link rel="stylesheet" href="../../static/library/bootstrap-icons-1.3.0.css">
    <!-- Fontawesome Icons -->

    <link rel="stylesheet" href="../../static/library/fontawesome-5.10.0.all.css"  />
    <link rel="stylesheet" href="../../static/library/font-awesome.min-4.7.0.css">

    <!-- anychart modules -->
    <script src="../../static/library/anychart-8.10.0-core.min.js"></script>
    <script src="../../static/library/anychart-8.10.0-graph.min.js"></script>
    <script src="../../static/library/anychart-8.10.0-pie.min.js"></script>
    <script src="../../static/library/anychart-8.10.0-exports.min.js"></script>
    <script src="../../static/library/anychart-8.10.0-cartesian.min.js"></script>


    <script src="https://d3js.org/d3.v3.js"></script>
    <script src="../../static/js/jsnetworkx.js"></script>

    <link rel="stylesheet" type="text/css" href="../../static/library/tom-select-2.2.1.css">
    <script src="../../static/library/tom-select.complete-2.2.1.min.js"></script>
    <script type="text/javascript" src="../../static/js/searchable-select.js"></script>

    <link rel="stylesheet" href="../../static/styles/index2.css">
    <link rel="stylesheet" href="../../static/styles/graph.css">
    <meta charset="UTF-8">

    <!-- simple graph  -->
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script src="../../static/library/d3.tip.v0.6.3.js"></script>
    <link rel="stylesheet" href="../../static/styles/sim_graph.css">

    <!-- Intro Js -->
    <script src="../../static/library/intro.min-4.3.0.js"></script>
    <link rel="stylesheet" type="text/css" href="../../static/library/introjs.min-4.3.0.css">
    <link rel="stylesheet" type="text/css" href="../../static/library/introjs-rtl.min-4.3.0.css">
    <link rel="stylesheet" href="../../static/styles/user_guide_tour.css">

    <!-- Notyf  -->
    <link rel="stylesheet" type="text/css" href="../../static/library/notyf.min-npm.css">
    <script src="../../static/library/notyf.min.js"></script>

    <script type="text/javascript" src="http://l2.io/ip.js?var=myip">
    </script>

    <script src="../../static/library/g6.min-4.3.11.js"></script>
    <script src="../../static/library/jquery-ui.min-1.11.4.js"></script>

        <!-- Footable  -->
    <script src="../../static/js/footable/demo-rows.js"></script>
    <script src="../../static/js/footable/ie10-viewport-bug-workaround.js"></script>
    <script src="../../static/js/footable/footable.js"></script>
    <link href="../../static/styles/footable/footable.bootstrap.min.css" rel="stylesheet">
    <link href="../../static/styles/footable/docs.css" rel="stylesheet">
    <link href="../../static/styles/footable/FooTable.Glyphicons.css" rel="stylesheet">
    <link href="../../static/styles/footable/FooTable.FontAwesome.css" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="../../static/js/GraphClass.js"></script>

    <title>دسته‌بندی مبتنی‌بر کلیدواژه</title>
    {% include "doc/title_icon.html" %}
</head>

<body>


    <!-- Menu -->
    <nav dir="rtl" class="navbar nav_menu navbar-expand-lg fixed-top p-0 mt-0">
        {% include "doc/header2.html" %}
    </nav>

    <script>
        $(document).ready(function () {


            // Active panel
            $('#AIDropdown').addClass('active');
            $('#SubjectKeywordGraph').addClass('active');


            $('select#language').on('change', function (e) {

                let selected_language = this.value;
                let current_url = window.location.href;
                if (selected_language === 'England') {
                    let page_name = current_url.split('/')[3]
                    let requested_url = current_url.replace(page_name, 'en')
                    window.location = requested_url;
                } else if (selected_language === 'Russia') {
                    let page_name = current_url.split('/')[3]
                    let requested_url = current_url.replace(page_name, 'ru')
                    window.location = requested_url;
                }

            });
        });
    </script>



    <div class="row flex-row-reverse px-0 py-5 px-md-5 py-md-5 m-0 mt-4">
        <form action="" class="custom-control mx-auto needs-validation" id="graph_form" enctype="multipart/form-data"
            method="post" novalidate>

            <div class="row mb-0 flex-row-reverse mx-auto">

                <div class="col-md-6 pt-3 col-12 col-lg-2 bg-light" dir="rtl">

                    <label class=" text-right bg-light float-right" style="direction: rtl;;">مجموعه سند:</label>

                    <select dir="rtl" id="country" name="country"
                        class="form-select text-right float-right searchable-select" style="direction: rtl;"
                        onchange="CountryChanged()">
                        {% for k,v in countries.items %}
                            {% if v == 'هوش‌یار' %}
                            <option value="{{ k }}">{{ v }}- قوانین</option>
                            {% endif %}
                        {% endfor %}
                    </select>
                </div>

                <div class="col-md-6 pt-3 col-12 col-lg-4 bg-light" dir="rtl">
                    <label class=" text-right bg-light float-right" style="direction: rtl;;">نسخه گراف:</label>
                    <select id="VersionSelect" class="form-select text-right float-right searchable-select" style="direction: rtl;">
                    </select>
                </div>

                <div class="col-lg-3 mr-0 col-md-6 pt-5 col-12">
                    <!-- Show result btn -->
                    <button type="button" id="graph_show" class="btn float-right" onclick="ShowGraph()">نمایش</button>
                </div>
            </div>
        </form>

        <!--Original Tabs -->
        <ul id="original_tabs" class="nav nav-pills mt-5 mx-auto  pr-3 pr-sm-0  float-right  d-block" id="graph_tab"
            role="tablist">
            <li class="nav-item float-right" role="presentation">
                <button id="subjectkeyword_graph_tab" class="nav-link active" data-bs-toggle="pill"
                    data-bs-target="#subjectkeyword_graph_pane" type="button" role="tab"
                    aria-controls="subjectkeyword_graph_pane" aria-selected="false">گراف موضوع-کلیدواژه</button>
            </li>
            <li class="nav-item float-right" role="presentation" id="subject_view_tab">
                <button class="nav-link" data-bs-toggle="pill" data-bs-target="#subject_view_pane" type="button"
                    role="tab" aria-controls="subject_view_pane" aria-selected="true">نمایش احکام</button>
            </li>
            <li class="nav-item float-right" role="presentation">
                <button id="subjectsubject_graph_tab" class="nav-link" data-bs-toggle="pill"
                    data-bs-target="#subjectsubject_graph_pane" type="button" role="tab"
                    aria-controls="subjectsubject_graph_pane" aria-selected="false">‌گراف موضوع-موضوع</button>
            </li>
        </ul>

        <!-- Original Panes -->
        <div id="original_pane" class="tab-content float-right px-1 bg-white" id="pills-tabContent">

            <!--  Document Graph Pane -->
            <div id="subjectkeyword_graph_pane" class="tab-pane w-100 fade show active float-right" role="tabpanel"
                aria-labelledby="subjectkeyword_graph_tab">

                <div class="row mt-4 w-100 mx-auto pb-5 px-4" dir="rtl">

                    <div id="subjectkeyword_constraints_container" class="collapse show constraints_container row flex-row-reverse pt-0 mb-0 mt-0 mx-auto">

                        <div id="subjectkeyword_DegreeDiv" class="col-md-12 p-1 col-12 col-lg-12 mt-1">
                            <div class="source_header bg-white row mx-auto p-1">
                                <label class="text-center my-0" style="direction: rtl;">فیلتر درجه</label>
                            </div>
                            <div class="source_container pb-2 row mx-auto">
                                <div dir="rtl" class="wrapper mt-5 mb-1" id="subjectkeyword_DegreeSlider" style="visibility: hidden;">
                                  <div class="container" style="display: flex; justify-content: center;">
                                    <div class="slider-wrapper" style="width: 100%">
                                      <div dir="ltr" id="slider-range"></div>
                                      <div dir="rtl" style="display:flex; width: 300px; justify-content: center" class="range-wrapper">
                                        <div dir="ltr" class="range mt-1"></div>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                            </div>
                        </div>

                        <div id="subjectkeyword_WeightDiv" class="col-md-3 p-1 col-12 col-lg-6 mt-1" style="display: none">
                            <div class="source_header bg-white row mx-auto p-1">
                                <label class="text-center my-0" style="direction: rtl;">فیلتر وزن</label>
                            </div>
                            <div class="source_container pb-2 row mx-auto">
                                <div dir="rtl" class="wrapper mt-5 mb-1" id="subjectkeyword_WeightSlider" style="visibility: hidden;">
                                  <div class="container" style="display: flex; justify-content: center;">
                                    <div class="slider-wrapper">
                                        <div dir="ltr" id="slider-range"></div>
                                          <div dir="rtl" style="display:flex; width: 300px; justify-content: center" class="range-wrapper">
                                            <div dir="ltr" class="range mt-1"></div>
                                          </div>
                                    </div>
                                    </div>
                                  </div>
                                </div>
                        </div>

                    </div>

                    <div class="d-flex">
                        <div class="col-md-6 p-1 col-12 col-lg-6 mt-3">
                            <div class="source_header bg-white row mx-auto p-1">
                                <label class="text-center my-0" style="direction: rtl;">نحوه نمایش</label>
                            </div>
                            <div class="source_container p-4 row mx-auto">
                                <select id="subjectkeyword_ChangeLayout" name="subjectkeyword_ChangeLayout" class="form-select text-right float-right searchable-select" style="direction: rtl;">
                                    <option value="grid">مربعی</option>
                                    <option value="circular"> دایره ای </option>
                                    <option value="force">ساده</option>
                                    <option value="dagre">بالا به پایین</option>
                                    <option value="radial">شعاعی</option>
                                    <option value="concentric">متحدالمرکز</option>
                                    <option value="comboForce">خوشه ای</option>
                                </select>
                            </div>
                        </div>

                        <div class="col-md-6 p-1 col-12 col-lg-6 mt-3">
                            <div class="source_header bg-white row mx-auto p-1">
                                <label class="text-center my-0" style="direction: rtl;">جستجو در نام گره</label>
                            </div>
                            <div class="source_container p-4 d-flex">
                                <input style="direction: rtl;" class="form-control text-right" placeholder="جستجو در نام گره ها ..." type="text" required="" name="subjectkeyword_SearchBox" id="subjectkeyword_SearchBox" value="">
                                <button type="button" id="subjectkeyword_SearchBtn" class="btn modal_btn mr-2">جست‌وجو</button>
                            </div>
                        </div>


                        <div class="col-md-6 p-1 col-12 col-lg-6 mt-1 d-flex">

                        </div>
                    </div>

                    <div dir="ltr">
                        <img style="width: 4%; cursor: pointer; margin-top: 20px;" id="subjectkeyword_SelectNeighbourImg" src="../../static/image/neighbourhood.png">
                        <img style="width: 3%; cursor: pointer; margin-top: 20px;" id="subjectkeyword_ShowHideImg" src="../../static/image/hide_nodes.png">
                    </div>

                    <div id="subjectkeyword_graph_container" class="border mt-1 position-static" style="height:500px; overflow: hidden;">
                    </div>

                    <div dir="rtl" style="display: flex; margin-bottom: 50px;">
                        <div class="col-md-6 px-0 col-12 col-lg-5 pt-1">
                            <h6 class="table_header text-center  p-2  mb-0">
                                گره های انتخاب شده
                            </h6>
                            <table id="subjectkeyword_selected_node_table" class="table table-striped PopUpTable" style="width: 95%;margin: auto;">

                            </table>
                        </div>

                        <div class="col-md-6 px-0 col-12 col-lg-7 pt-1">
                        <h6 class="table_header text-center  p-2  mb-0">
                            یال های انتخاب شده
                        </h6>
                        <table id="subjectkeyword_selected_edge_table" class="table table-striped PopUpTable" style="width: 95%;margin: auto;">

                        </table>
                    </div>
                    </div>

                </div>

            </div>

            <!--  Document Subject Pane -->
            <div class="tab-pane fadefloat-right w-100" id="subject_view_pane" role="tabpanel"
                aria-labelledby="subject_view_tab">
                <div class="row mt-4 w-100 flex-row-reverse  mx-auto pb-5 px-4">
                    <div class="col-md-12 pt-3 col-12 col-lg-12">
                        <div class="table-responsive search_result_table mt-4"  dir="rtl">
                            <table class="table table-striped SearchTable" style="min-height: 200px;" id="SubjectTable">
                            </table>
                        </div>
                    </div>
                </div>

            </div>

            <!-- SubjectSubject Graph -->
            <div id="subjectsubject_graph_pane" class="tab-pane w-100 fade float-right" role="tabpanel"
                aria-labelledby="subjectsubject_graph_tab">

                <div class="row mt-4 w-100 mx-auto pb-5 px-4" dir="rtl">

                    <div id="subjectsubject_constraints_container" class="collapse show constraints_container row flex-row-reverse pt-0 mb-0 mt-0 mx-auto">

                        <div id="subjectsubject_DegreeDiv" class="col-md-3 p-1 col-12 col-lg-6 mt-1">
                            <div class="source_header bg-white row mx-auto p-1">
                                <label class="text-center my-0" style="direction: rtl;">فیلتر درجه</label>
                            </div>
                            <div class="source_container pb-2 row mx-auto">
                                <div dir="rtl" class="wrapper mt-5 mb-1" id="subjectsubject_DegreeSlider" style="visibility: hidden;">
                                  <div class="container" style="display: flex; justify-content: center;">
                                    <div class="slider-wrapper">
                                      <div dir="ltr" id="slider-range"></div>
                                      <div dir="rtl" style="display:flex; width: 300px; justify-content: center" class="range-wrapper">
                                        <div dir="ltr" class="range mt-1"></div>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                            </div>
                        </div>

                        <div id="subjectsubject_WeightDiv" class="col-md-3 p-1 col-12 col-lg-6 mt-1">
                            <div class="source_header bg-white row mx-auto p-1">
                                <label class="text-center my-0" style="direction: rtl;">فیلتر وزن</label>
                            </div>
                            <div class="source_container pb-2 row mx-auto">
                                <div dir="rtl" class="wrapper mt-5 mb-1" id="subjectsubject_WeightSlider" style="visibility: hidden;">
                                  <div class="container" style="display: flex; justify-content: center;">
                                    <div class="slider-wrapper">
                                        <div dir="ltr" id="slider-range"></div>
                                          <div dir="rtl" style="display:flex; width: 300px; justify-content: center" class="range-wrapper">
                                            <div dir="ltr" class="range mt-1"></div>
                                          </div>
                                    </div>
                                    </div>
                                  </div>
                                </div>
                        </div>

                    </div>

                    <div class="d-flex">
                        <div class="col-md-6 p-1 col-12 col-lg-6 mt-3">
                            <div class="source_header bg-white row mx-auto p-1">
                                <label class="text-center my-0" style="direction: rtl;">نحوه نمایش</label>
                            </div>
                            <div class="source_container p-4 row mx-auto">
                                <select id="subjectsubject_ChangeLayout" name="subjectsubject_ChangeLayout" class="form-select text-right float-right searchable-select" style="direction: rtl;">
                                    <option value="grid">مربعی</option>
                                    <option value="circular"> دایره ای </option>
                                    <option value="force">ساده</option>
                                    <option value="dagre">بالا به پایین</option>
                                    <option value="radial">شعاعی</option>
                                    <option value="concentric">متحدالمرکز</option>
                                    <option value="comboForce">خوشه ای</option>
                                </select>
                            </div>
                        </div>

                        <div class="col-md-6 p-1 col-12 col-lg-6 mt-3">
                            <div class="source_header bg-white row mx-auto p-1">
                                <label class="text-center my-0" style="direction: rtl;">جستجو در نام گره</label>
                            </div>
                            <div class="source_container p-4 d-flex">
                                <input style="direction: rtl;" class="form-control text-right" placeholder="جستجو در نام گره ها ..." type="text" required="" name="subjectsubject_SearchBox" id="subjectsubject_SearchBox" value="">
                                <button type="button" id="subjectsubject_SearchBtn" class="btn modal_btn mr-2">جست‌وجو</button>
                            </div>
                        </div>


                        <div class="col-md-6 p-1 col-12 col-lg-6 mt-1 d-flex">

                        </div>
                    </div>

                    <div dir="ltr">
                        <img style="width: 4%; cursor: pointer; margin-top: 20px;" id="subjectsubject_SelectNeighbourImg" src="../../static/image/neighbourhood.png">
                        <img style="width: 3%; cursor: pointer; margin-top: 20px;" id="subjectsubject_ShowHideImg" src="../../static/image/hide_nodes.png">
                    </div>

                    <div id="subjectsubject_graph_container" class="border mt-1 position-static" style="height:500px; overflow: hidden;">
                    </div>

                    <div dir="rtl" style="display: flex; margin-bottom: 50px;">
                        <div class="col-md-6 px-0 col-12 col-lg-5 pt-1">
                            <h6 class="table_header text-center  p-2  mb-0">
                                گره های انتخاب شده
                            </h6>
                            <table id="subjectsubject_selected_node_table" class="table table-striped PopUpTable" style="width: 95%;margin: auto;">

                            </table>
                        </div>

                        <div class="col-md-6 px-0 col-12 col-lg-7 pt-1">
                        <h6 class="table_header text-center  p-2  mb-0">
                            یال های انتخاب شده
                        </h6>
                        <table id="subjectsubject_selected_edge_table" class="table table-striped PopUpTable" style="width: 95%;margin: auto;">

                        </table>
                    </div>
                    </div>

                </div>

            </div>

        </div>
    </div>

        <!-- ChartModal Container -->
    <button type="button" id="ChartModalBtn" class="btn d-none modal_btn" data-bs-toggle="modal"
        data-bs-target="#ChartModal"></button>
    <div class="modal fade" id="ChartModal">
        <div class="modal-dialog modal-dialog-scrollable modal-lg " style="max-width: 85%">
            <div class="modal-content">

                <!-- Modal Header -->
                <div style="direction: rtl !important;" class="modal-header">
                    <h5 id="ChartModalHeader" class="modal-title">عنوان</h5>
                    <button type="button" class="btn-close m-0" data-bs-dismiss="modal"></button>
                </div>

                <!-- Modal body -->
                <div id="ChartModalText" class="modal-body text-justify">
                    <div class="col-md-4 px-4 col-12 col-lg-12 p-3 border">
                        <h5 class="extractected_references w-100 mt-4 text-center float-right pt-3 pb-3">
                            توزیع اسناد احکام بر اساس مرجع تصویب
                        </h5>
                        <br>
                        <div id="approval_container" style="height: 85vh" class="bg-white w-100 p-4">
                        </div>
                    </div>
                    <div class="col-md-4 px-4 col-12 col-lg-12 p-3 border">
                        <h5 class="extractected_references w-100 mt-4 text-center float-right pt-3 pb-3">
                            توزیع اسناد احکام بر اساس سال تصویب
                        </h5>
                        <br>
                        <div id="year_container" style="height: 85vh" class="bg-white w-100 p-4">
                        </div>
                    </div>
                    <div class="col-md-4 px-4 col-12 col-lg-12 p-3 border">
                        <h5 class="extractected_references w-100 mt-4 text-center float-right pt-3 pb-3">
                            توزیع اسناد احکام بر اساس سطح سند
                        </h5>
                        <br>
                        <div id="level_container" style="height: 85vh" class="bg-white w-100 p-4">
                        </div>
                    </div>
                    <div class="col-md-4 px-4 col-12 col-lg-12 p-3 border">
                        <h5 class="extractected_references w-100 mt-4 text-center float-right pt-3 pb-3">
                            توزیع اسناد احکام بر اساس نوع سند
                        </h5>
                        <br>
                        <div id="type_container" style="height: 85vh" class="bg-white w-100 p-4">
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>


    <!-- DetailModal Container -->
    <button type="button" id="DetailModalBtn" class="btn d-none modal_btn" data-bs-toggle="modal" data-bs-target="#DetailModal"></button>
    <div class="modal fade" id="DetailModal">
        <div class="modal-dialog modal-dialog-scrollable modal-lg" style="max-width: 85%">
            <div class="modal-content">

                <!-- Modal Header -->
                <div style="direction: rtl !important;" class="modal-header">
                    <h5 id="DetailModalHeader" class="modal-title">عنوان</h5>
                    <button type="button" class="btn-close m-0" data-bs-dismiss="modal"></button>
                </div>

                <!-- Modal body -->
                <div id="ChartModalText" class="modal-body text-justify">
                    <h6 id="DocsCount" class='text-secondary'></h6>
                    <div id="DetailModalBody">
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- ParagraphModal Container -->
    <button type="button" id="ParagraphModalBtn" class="btn d-none modal_btn" data-bs-toggle="modal" data-bs-target="#ParagraphModal"></button>
    <div class="modal fade" id="ParagraphModal">
        <div class="modal-dialog modal-dialog-scrollable modal-lg" style="max-width: 85%">
            <div class="modal-content">

                <!-- Modal Header -->
                <div style="direction: rtl !important;" class="modal-header">
                    <h5 id="ParagraphModalHeader" class="modal-title">عنوان</h5>
                    <button type="button" class="btn-close m-0" data-bs-dismiss="modal"></button>
                </div>

                <!-- Modal body -->
                <div id="ChartModalText" class="modal-body text-justify">
                    <div id="ParagraphModalBody">
                        <div class="table-responsive search_result_table mt-4">
                            <table class="table table-striped" style="min-height: 200px;" id="ParagraphModalTable">
                            </table>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Scrollbar -->
    <button id="scroll_btn" class="p-0" title="بالای صفحه" onclick="topFunction()">
        <i class="far fa-caret-square-up"></i>
    </button>

    <script src="../../static/js/logincheck.js"></script>

    <script src="../../static/js/scroll_button_handler.js"></script>
    <!-- Intro Js -->
    <script src="../../static/js/graph/graph_tour.js"></script>
    <script src="../../static/js/tour.js"></script>

    <script>
        initSearchableSelects();
        init()

        container_id_list = ['subjectkeyword_ChangeLayout', "subjectsubject_ChangeLayout"]

        let graph_object;
        let data_graph;
        let document_graph_object;
        let min_selected_degree;
        let max_selected_degree;
        let min_selected_weight;
        let max_selected_weight;
        let show_hide_state = "show"

        function clearPrevResults(container_id_list) {
            for (container_id of container_id_list) {
                document.getElementById(container_id).innerHTML = "";
            }
        }

        async function init() {
            const country_id = document.getElementById("country").value

            // Add Version
            let request_link = 'http://' + location.host + "/GetSubjectKeywordGraphVersion/"
            let response = await fetch(request_link).then(response => response.json());
            let versions = response["Versions"]

            let options = [];

            for (let row of versions)
            {
                options.push({value:row[0], text: row[1]});
            }

            syncSelectOptions('VersionSelect', options)

            const control = document.getElementById('VersionSelect').tomselect
            control.setValue("12");

            //user log
            let form_data = new FormData()
            detail_type = "نمایش پنل"
            .append('detail_type', detail_type);
            UserLog(form_data)

        }


        function CountryChanged() {
            clearPrevResults(container_id_list);
            init()
        }

        async function showSubjectTableData()
        {
            const version_id = document.getElementById("VersionSelect").value
            let request_link = 'http://' + location.host + "/GetSubjectListByVersionId/" + version_id + "/"
            let response = await fetch(request_link).then(response => response.json());

            let subject_data = response["Subject_Data"]

            let subject_table_data = []
            let i = 1;
            for (const subject of subject_data) {
                const subject_id = subject["subject_id"]
                const subject_name = subject["subject_name"]
                const paragraph_count = subject["paragraph_count"]

                const showKeywords_function = "ShowKeywordsList('" + subject_id + "', '"+subject_name+"')"
                const showKeywords = '<button type="button" class="btn modal_btn" data-bs-toggle="modal" onclick="' + showKeywords_function + '" data-bs-target="">انتخاب</button>'


                const showParagraphList_function = "ShowParagraphList('" + subject_id + "', '"+subject_name+"')"
                const showParagraphList = '<button type="button" class="btn modal_btn" data-bs-toggle="modal" onclick="' + showParagraphList_function + '" data-bs-target="">انتخاب</button>'

                const showChart_function = "ShowSubjectChart('" + subject_id + "', '"+subject_name+"')"
                const showChart = '<button type="button" class="btn modal_btn" data-bs-toggle="modal" onclick="' + showChart_function + '" data-bs-target="">انتخاب</button>'


                const downloadParagraphList_function = "DowunloadParagraphList('" + subject_id + "', '"+subject_name+"')"
                const downloadParagraphList = '<i class="fa fa-file-excel-o" style="font-size:30px;color:green; cursor: pointer" onclick="' + downloadParagraphList_function + '"></i>'

                const res = {id: i, subject_name:subject_name, paragraph_count: paragraph_count, showKeywords: showKeywords, showChart:showChart, showParagraphList:showParagraphList, downloadParagraphList: downloadParagraphList}

                subject_table_data.push(res)

                i+=1
            }

            $('#SubjectTable').empty();
            $('#SubjectTable').footable({
                "paging": {
                    "enabled": true,
                     strings: {
                         first: '»',
                         prev:'›',
                         next: '‹',
                         last: '«'
                     }
                },
                "filtering": {
                    "enabled": false
                },
                "sorting": {
                    "enabled": true
                },
                "empty": "موضوعی وجود ندارد",
                "columns": [{
                    "name": "id",
                    "title": "ردیف",
                    "breakpoints": "xs sm",
                    "type": "number",
                    "style": {
                        "width": "5%"
                    }
                }, {
                    "name": "subject_name",
                    "title": "نام موضوع",
                    "style": {
                        "width": "20%"
                    }
                },{
                    "name": "paragraph_count",
                    "title": "تعداد احکام",
                    "style": {
                        "width": "15%"
                    }
                },
                    {
                    "name": "showKeywords",
                    "title": "نمایش کلیدواژه ها",
                    "style": {
                        "width": "15%"
                    }
                },{
                    "name": "showChart",
                    "title": "تحلیل نموداری",
                    "style": {
                        "width": "15%"
                    }
                },{
                    "name": "showParagraphList",
                    "title": "نمایش احکام",
                    "style": {
                        "width": "15%"
                    }
                },{
                    "name": "downloadParagraphList",
                    "title": "دانلود احکام",
                    "style": {
                        "width": "15%"
                    }
                }
                ],
                "rows": subject_table_data
            });
        }

        async function ShowKeywordsList(subject_id, subject_name)
        {
            startFullPageBlockUI();

            $("#DetailModalBtn").click()

            let request_link = 'http://' + location.host + "/GetSubjectKeywordsListBySubjectId/" + subject_id + "/"
            let response = await fetch(request_link).then(response => response.json());
            let Keyword_List = response["Keyword_List"]
            let result_tag = ""
            for (const keyword of Keyword_List) {
                let keyword_word = keyword["word"]
                let keyword_score = keyword["score"]

                let text = keyword_word + "&nbsp;" + "(" + keyword_score + ")"

                let tag = "<p style='margin-right: 10px;'>" + text + "</p>"
                result_tag += "<div class='col-4 mt-2' style='display: inline-flex; border-bottom: 1px dashed; justify-content: center;'>" + tag  + "</div>"
            }

            document.getElementById("DetailModalHeader").innerHTML = subject_name + "&emsp;&emsp;&emsp;&emsp;" + "کلیدواژه (امتیاز)"
            document.getElementById("DetailModalBody").innerHTML = result_tag

            stopFullPageBlockUI('نمایش کلیدواژه ها');

        }

        async function ShowSubjectChart(subject_id, subject_name)
        {
            $("#ChartModalBtn").click()

            startFullPageBlockUI();

            document.getElementById("ChartModalHeader").innerHTML = subject_name

            let request_link = 'http://' + location.host + "/GetSubjectDocumentChartDataBySubjectId/" + subject_id + "/"
            let response = await fetch(request_link).then(response => response.json());
            let approval_references_data = response["approval_references_data"]
            let level_data = response["level_data"]
            let type_data = response["type_data"]
            let approval_year_data = response["approval_year_data"]


            showChartData(type_data, "type_container", false, "نوع سند")
            showChartData(level_data, "level_container", false, "سطح سند")
            showChartData(approval_year_data, "year_container", true, "سال تصویب سند")
            showChartData(approval_references_data, "approval_container", false, "مرجع تصویب سند")

            stopFullPageBlockUI('اطلاعات نموداری');

        }

        async function DowunloadParagraphList(subject_id, subject_name)
        {
            startFullPageBlockUI();
            let request_link = 'http://' + location.host + "/CreateDocumentCSVDataBySubjectId/" + subject_id + "/"
            let response = await fetch(request_link).then(response => response.json());
            let file_name = response["file_name"]
            const path = 'http://' + location.host + '/media/' + file_name;
            var link = document.createElement("a");
            link.href = path
            link.click()
            stopFullPageBlockUI('دانلود فایل');
        }

        async function ShowParagraphList (subject_id, subject_name)
        {
            startFullPageBlockUI();

            document.getElementById("ParagraphModalHeader").innerHTML = "موضوع" + subject_name
            $("#ParagraphModalBtn").click()

            let request_link = 'http://' + location.host + "/GetSubjectDocumentParagraphListBySubjectId/" + subject_id + "/" + location.host + "/"
            let response = await fetch(request_link).then(response => response.json());
            let ParagraphDataList = response["ParagraphDataList"]


            $('#ParagraphModalTable').empty();
            $('#ParagraphModalTable').footable({
                "paging": {
                    "enabled": true,
                     strings: {
                         first: '»',
                         prev:'›',
                         next: '‹',
                         last: '«'
                     }
                },
                "filtering": {
                    "enabled": false
                },
                "sorting": {
                    "enabled": true
                },
                "empty": "موضوعی وجود ندارد",
                "columns": [{
                    "name": "id",
                    "title": "ردیف",
                    "breakpoints": "xs sm",
                    "type": "number",
                    "style": {
                        "width": "5%"
                    }
                }, {
                    "name": "doc_name",
                    "title": "نام سند",
                    "style": {
                        "width": "25%"
                    }
                },{
                    "name": "paragraph_text",
                    "title": "متن حکم",
                    "style": {
                        "width": "55%"
                    }
                },
                    {
                    "name": "score",
                    "title": "امتیاز",
                    "style": {
                        "width": "15%"
                    }
                },],
                "rows": ParagraphDataList
            });

            stopFullPageBlockUI('نمایش حکم ها');


        }

        async function showSubjectSubjectGraph()
        {
            const country_id = document.getElementById("country").value
            let version_id = document.getElementById("VersionSelect").value

            let request_link = 'http://' + location.host + "/GetSubjectSubjectGraphData/" + country_id + "/" + version_id + "/"
            let response = await fetch(request_link).then(response => response.json());
            const Nodes_data = response["Nodes_data"]
            let Edges_data = response["Edges_data"]

            /* Delete Self Loop */
            Edges_data = Edges_data.filter(function (item,i){
                return item["source"] !== item["target"];
            });


            container = document.getElementById("subjectsubject_graph_container");
            const width = 0.88 * window.innerWidth
            const height = container.scrollHeight || 500;

            let Graph_Object = new MyGraph("subjectsubject_graph_container", Nodes_data, Edges_data, {}, {}, width, height, "circular", "subjectsubject_ChangeLayout", false,
            "Yellow", "subjectsubject_DegreeSlider", "subjectsubject_WeightSlider", 1, 10, "subjectsubject_selected_node_table", "subjectsubject_selected_edge_table",
            "subjectsubject_SelectNeighbourImg", "subjectsubject_ShowHideImg", "تعداد احکام", subjectsubject_node_dbl_click, "",
            "subjectsubject_SearchBox", "subjectsubject_SearchBtn")

            await Graph_Object.show()
        }

        async function subjectsubject_node_dbl_click(node_data)
        {
            await ShowParagraphList(node_data["id"], node_data["name"])
        }

        async function showSubjectKeywordGraph()
        {
            let version_id = document.getElementById("VersionSelect").value
            let request_link = 'http://' + location.host + "/SubjectKeywordGraphExtractor/" + version_id + "/"
            let response = await fetch(request_link).then(response => response.json());

            let Nodes_data = response["Nodes_data"]
            let Edges_data = response["Edges_data"]


            container = document.getElementById("subjectkeyword_graph_container");
            const width = 0.88 * window.innerWidth
            const height = container.scrollHeight  || 500;

            let Graph_Object = new MyGraph("subjectkeyword_graph_container", Nodes_data, Edges_data, {}, {}, width, height, "circular", "subjectkeyword_ChangeLayout", false,
                "Yellow", "subjectkeyword_DegreeSlider", "", 1, 1, "subjectkeyword_selected_node_table", "subjectkeyword_selected_edge_table",
                "subjectkeyword_SelectNeighbourImg", "subjectkeyword_ShowHideImg", "", subjectkeyword_node_dbl_click, "",
                "subjectkeyword_SearchBox", "subjectkeyword_SearchBtn")

            await Graph_Object.show()
        }

        async function subjectkeyword_node_dbl_click(node_data)
        {
            if (node_data["id"].startsWith("S") === true) {
                await ShowParagraphList(node_data["id"].substring(1), node_data["name"])
            }
            else if (node_data["id"].startsWith("K") === false)
            {
                startFullPageBlockUI();

                document.getElementById("ParagraphModalHeader").innerHTML = "کلیدواژه: " + node_data["name"]
                $("#ParagraphModalBtn").click()

                let version_id = document.getElementById("VersionSelect").value
                let keyword_name = node_data["name"]

                let request_link = 'http://' + location.host + "/GetSubjectsListByKeywordId/" + version_id + "/" + keyword_name + "/"
                let response = await fetch(request_link).then(response => response.json());

                const KeywordList = response["KeywordList"]

                $('#ParagraphModalTable').empty();
                $('#ParagraphModalTable').footable({
                    "paging": {
                        "enabled": true,
                         strings: {
                             first: '»',
                             prev:'›',
                             next: '‹',
                             last: '«'
                         }
                    },
                    "filtering": {
                        "enabled": false
                    },
                    "sorting": {
                        "enabled": true
                    },
                    "empty": "موضوعی وجود ندارد",
                    "columns": [{
                        "name": "id",
                        "title": "ردیف",
                        "breakpoints": "xs sm",
                        "type": "number",
                        "style": {
                            "width": "5%"
                        }
                    }, {
                        "name": "keyword",
                        "title": "کلیدواژه",
                        "style": {
                            "width": "25%"
                        }
                    },{
                        "name": "subject_name",
                        "title": "موضوع",
                        "style": {
                            "width": "55%"
                        }
                    },
                        {
                        "name": "score",
                        "title": "امتیاز",
                        "style": {
                            "width": "15%"
                        }
                    },],
                    "rows": KeywordList
                });

                $("ParagraphModalBtn").click()

                stopFullPageBlockUI('نمایش حکم ها');

            }
        }

        async function ShowGraph()
        {
            startFullPageBlockUI()

            /********************** Get Subject List **************************/
            await showSubjectKeywordGraph()
            await showSubjectTableData()
            await showSubjectSubjectGraph()
            /********************** Graph **************************/


            //user log
            let form_data = new FormData()
            let detail_type = "نمایش گراف"
            let country_name = $("#country option:selected").text();
            let graph_type = $("#GraphType option:selected").text();
            let minimum_similarity = $("#MinimumSimilarity option:selected").text();
            {#let tab_name = $('ul#original_tabs').find('button.active').text()#}
            form_data.append('detail_type', detail_type);
            form_data.append('country_name', country_name);
            form_data.append('graph_type', graph_type);
            form_data.append('minimum_similarity', minimum_similarity);
            {#form_data.append('tab_name', tab_name);#}
            UserLog(form_data)

            /*********************** Show Graph ****************************/

            stopFullPageBlockUI("دسته بندی مبتنی بر کلیدواژه")

        }




    </script>


</body>


<!-- save log user -->
<script>

    function showChartData(data, container, keySort, xAxisTitle) {
        let chart_data = []
        for (const row of data)
        {
            let data = row["data"]
            if (data === null)
            {
                data = "نامشخص"
            }

            chart_data.push([data, row["count"]])
        }
        showChart(chart_data, container, keySort, xAxisTitle)
    }

    function showChart(data, position, keySort, xAxisTitle) {

        if (keySort === true) {
            data.sort(function (element_a, element_b) {
                return element_a[0] - element_b[0];
            });
        }
        else {
            data.sort(function (element_a, element_b) {
                return element_a[1] - element_b[1];
            });
        }

        data.sort(function (x, y) { return x[0] === 'نامشخص' ? -1 : y[0] === 'نامشخص' ? 1 : 0; });

        // Sorts the data by descending.
        data = anychart.data.set(data)

        document.getElementById(position).innerHTML = ""

        chart = anychart.column();
        chart.container(position);
        // create a column series and set the data
        var series = chart.column(data);
        chart
            .animation(true)
            .padding([10, 40, 5, 20])


        chart.background().fill('#ffffff');
        series.normal().fill("#488fb8", 1);
        series.normal().stroke("#488fb8", 0);

        // var state = series.normal();
        // state.fill('#1481c0')

        // x axix labels font setting
        var xAxisLabels = chart.xAxis().labels();
        xAxisLabels.fontFamily("vazir");
        xAxisLabels.rotation(315);

        var yAxisLabels = chart.yAxis().labels();
        yAxisLabels.fontFamily("vazir");

        // Not allow labels overlapping
        let xAxis = chart.xAxis();
        xAxis.overlapMode("noOverlap");
        xAxis.title(xAxisTitle);
        xAxis.title().fontFamily('vazir');
        xAxis.title().fontWeight("bold");
        xAxis.title().height(40);

        var yAxis = chart.yAxis();
        yAxis.title("تعداد سند");
        yAxis.title().fontFamily('vazir');
        yAxis.title().fontWeight("bold");
        yAxis.title().height(40);


        // tooltip content font setting
        var tooltip = chart.tooltip();
        tooltip.fontFamily("vazir");

        // tooltip title font setting
        var title = chart.tooltip().title();
        title.fontFamily("vazir");

        chart.tooltip().hAlign('center').format("{%value}");

        chart.xAxis().labels().height(60);

        chart.yAxis().labels().format("{%value}");

        chart.yScale().minimum(0);
        chart.yScale().ticks().allowFractional(false);

        //xAxisLabels.rotation(-90)
        // initiate drawing the chart
        chart.draw();

        chart.listen("mouseOver", function (e) {
            document.body.style.cursor = "help";
        });
        chart.listen("mouseOut", function (e) {
            document.body.style.cursor = "auto";
        });


    }


    async function UserLog(form_data){
            if (getCookie("username") !== "") {
                const user_name = getCookie("username")
                let page_url = window.location.pathname
                const user_ip = myip

                page_url = page_url.slice(0, -1);
                if(page_url==="")
                {
                    page_url = "/0";
                }


                let link_request = 'http://' + location.host + "/UserLogSaved/" + user_name + page_url + "/"+ user_ip["ip"] + "/";

                $.ajax({
                    url: link_request,
                    data: form_data,
                    type: 'POST',
                    contentType: false,
                    processData: false,
                    async: true,


                }).done(function (res) {
                    console.log("done")

                }).fail(function (res) {
                    console.log("fail")
                });

            }
        }



</script>
<!-- Intro Js -->
<script src="../../static/js/graph/graph_tour.js">
</script>
<script src="../../static/js/tour.js"></script>

{#<script src="../../static/js/UserLogSave.js"></script>#}
<script src="../../static/js/signout_function.js"></script>

<!-- BS Tooltips handler -->
<script src="../../static/js/tooltip_handler.js"></script>


<!-- Blocking UI -->
<script src="../../static/js/blockUI.js"></script>
<script src="../../static/js/blockUI_handler.js"></script>
<link rel="stylesheet" href="../../static/styles/loader.css">
<!-- save log user -->
<script>
    async function UserLog(form_data){
            if (getCookie("username") !== "") {
                const user_name = getCookie("username")
                let page_url = window.location.pathname
                const user_ip = myip

                page_url = page_url.slice(0, -1);
                if(page_url==="")
                {
                    page_url = "/0";
                }


                let link_request = 'http://' + location.host + "/UserLogSaved/" + user_name + page_url + "/"+ user_ip["ip"] + "/";

                $.ajax({
                    url: link_request,
                    data: form_data,
                    type: 'POST',
                    contentType: false,
                    processData: false,
                    async: true,


                }).done(function (res) {
                    console.log("done")

                }).fail(function (res) {
                    console.log("fail")
                });

            }
        }
</script>

<script>
</script>

</html>