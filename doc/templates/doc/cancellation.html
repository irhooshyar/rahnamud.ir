<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" type="text/css" href="../../static/library/bootstrap.min-4.5.2.css">
    <link rel="stylesheet" type="text/css" href="../../static/library/bootstrap.min-5.1.2npm.css">

    <script src="../../static/js/jquery_351/jquery.min.js"></script>
    <script src="../../static/library/bootstrap-5.1.2.bundle.min.js"></script>

    <!--BS Icons -->
    <link rel="stylesheet" href="../../static/library/bootstrap-icons-1.3.0.css">
    <!-- Fontawesome Icons -->

    <link rel="stylesheet" href="../../static/library/fontawesome-5.10.0.all.css"  />
    <link rel="stylesheet" href="../../static/library/font-awesome.min-4.7.0.css">


    <!-- anychart modules -->
    <script src="../../static/library/anychart-8.10.0-core.min.js"></script>
    <script src="../../static/library/anychart-8.10.0-graph.min.js"></script>
    <script src="../../static/library/anychart-8.10.0-pie.min.js"></script>
    <script src="../../static/library/anychart-8.10.0-exports.min.js"></script>
    <script src="../../static/library/anychart-8.10.0-cartesian.min.js"></script>
    <script src="../../static/library/anychart-8.10.0-radar.min.js"></script>

    <script src="../../static/library/anychart-base.min-8.10.0.js"></script>
    <!-- <script src="../../static/library/anychart-8.10.0-exports.min.js"></script> -->
    <script src="../../static/library/anychart-ui.min-8.10.0.js"></script>
    <link rel="stylesheet" type="text/css" href="../../static/library/anychart-ui.min-8.10.0.css">
    <link rel="stylesheet" type="text/css" href="../../static/library/anychart-font.min-8.10.0.css">

    <!-- Multi Select  -->
    <link rel="stylesheet" type="text/css" href="../../static/styles/multiselect/multiselect-style.css">
    <script type="text/javascript" src="../../static/js/multiselect/jquery-2.2.4.min.js"></script>
    <script type="text/javascript" src="../../static/js/multiselect/jquery.multi-select.js"></script>





    <!-- Footable  -->
    <script src="../../static/js/footable/demo-rows.js"></script>
    <script src="../../static/js/footable/ie10-viewport-bug-workaround.js"></script>
    <script src="../../static/js/footable/footable.js"></script>
    <link href="../../static/styles/footable/footable.bootstrap.min.css" rel="stylesheet">
    <link href="../../static/styles/footable/docs.css" rel="stylesheet">
    <link href="../../static/styles/footable/FooTable.Glyphicons.css" rel="stylesheet">
    <link href="../../static/styles/footable/FooTable.FontAwesome.css" rel="stylesheet">

    <!-- Download Zip Files -->
    <script src="../../static/js/zipDownload/jszip.min.js"></script>
    <script src="../../static/js/zipDownload/FileSaver.min.js"></script>

    <link rel="stylesheet" href="../../static/styles/index2.css">
    <link rel="stylesheet" href="../../static/styles/adaptation.css">

    <link rel="stylesheet" type="text/css" href="../../static/library/jquerysctipttop.css">

    <!-- Intro Js -->
    <script src="../../static/library/intro.min-4.3.0.js"></script>
    <link rel="stylesheet" type="text/css" href="../../static/library/introjs.min-4.3.0.css">
    <link rel="stylesheet" type="text/css" href="../../static/library/introjs-rtl.min-4.3.0.css">
    <link rel="stylesheet" href="../../static/styles/user_guide_tour.css">

    <!-- Notyf  -->
    <link rel="stylesheet" type="text/css" href="../../static/library/notyf.min-npm.css">
    <script src="../../static/library/notyf.min.js"></script>


    <!--<script type="text/javascript" src="http://l2.io/ip.js?var=myip">
    </script>-->

    <meta charset="UTF-8">
    <title>تحلیل ابطال</title>
    {% include "doc/title_icon.html" %}



    <script>
        $(document).ready(function () {

            // Active panel
            $('#ApprovalsDropdown').addClass('active');
            $('#cancellation').addClass('active');



            // chart controller


            $('select#language').on('change', function (e) {

                let selected_language = this.value;
                let current_url = window.location.href;
                if (selected_language === 'England') {
                    let page_name = current_url.split('/')[3]
                    let requested_url = current_url.replace(page_name, 'en')
                    window.location = requested_url;
                } else if (selected_language === 'Russia') {
                    let page_name = current_url.split('/')[3]
                    let requested_url = current_url.replace(page_name, 'ru')
                    window.location = requested_url;
                }

            });


        });
    </script>

</head>

<body>
    {% load static %}

    <!-- Menu -->
    <nav dir="rtl" class="navbar nav_menu navbar-expand-lg fixed-top p-0 mt-0">
        {% include "doc/header2.html" %}
    </nav>
    <!-- Main Container includes: Form Fields, Tab Pills, Tab Panes -->
    <div class="row flex-row-reverse px-0 py-5 px-md-5 py-md-5 m-0">
        <div dir="rtl" class="row w-100 p-0">
            <!--Original Tabs -->
            <ul id="original_tabs" class="nav nav-pills mt-5 mx-auto  pr-3 pr-sm-0  float-right  d-block" id="pills-tab"
                role="tablist">


                <li class="nav-item float-right" role="presentation">
                    <button id="search_result_tab" class="nav-link active" data-bs-toggle="pill"
                        data-bs-target="#search_result_pane" type="button" role="tab" aria-controls="search_result_pane"
                        aria-selected="true">دسته‌بندی آراء</button>
                </li>
                <!--
                <li class="nav-item float-right" role="presentation">
                    <button id="terms_graph_tab" class="nav-link" data-bs-toggle="pill" data-bs-target="#terms_graph_pane" type="button" role="tab" aria-controls="terms_graph_pane" aria-selected="false">گراف کلمات</button>
                </li>
                -->
                <li class="nav-item float-right" role="presentation">
                    <button id="bar_chart_info_tab" class="nav-link" data-bs-toggle="pill"
                        data-bs-target="#bar_chart_info_pane" type="button" role="tab"
                        aria-controls="bar_chart_info_pane" aria-selected="false">داشبورد آماری</button>
                </li>

                <li class="nav-item float-right" role="presentation">
                    <button id="vote_result_tab" class="nav-link" data-bs-toggle="pill"
                        data-bs-target="#vote_result_pane" type="button" role="tab" aria-controls="vote_result_pane"
                        aria-selected="false">آراء دیوان عدالت اداری</button>
                </li>

            </ul>

            <!-- Original Panes -->
            <div id="original_pane" class="tab-content float-right px-1 bg-white" id="pills-tabContent">


                <!-- Search Result Pane -->
                <div id="search_result_pane" class="tab-pane w-100 fade show active float-right" role="tabpanel"
                    aria-labelledby="search_result_tab">
                    <!-- Search Result table -->
                    <div class="table-responsive search_result_table mt-4">
                        <!-- Download Buttons -->
                        <button type="button" data-bs-toggle="tooltip" data-bs-placement="top" title="دانلود اسناد"
                            class="btn float-left p-0 px-1 mt-2" id="DownloadBtn" onclick="DownloadSerachResultFunction()"
                            type="button">
                            <i class="far fa-file-archive m-0" style="font-size: 25px;margin: 0px;"></i>

                        </button>

                        <button class="btn float-left p-0 px-1 mt-2" id="ExportExcel" data-bs-toggle="tooltip"
                            data-bs-placement="top" title="خروجی اکسل" onclick="ExportExcelSerachResultFunction()"
                            type="button">
                            <i class="far fa-file-excel text-success m-0" style="font-size: 25px;margin: 0px;"></i>
                        </button>

                        <!-- Result Count -->
                        <p id="SearchResultLable" class="text-left float-left text-secondary pl-2"></p>
                        <table class="table table-striped SearchTable" style="min-height: 200px;" id="SearchTable">
                        </table>
                    </div>

                </div>

                <!-- Bar chart Info Pane -->
                <div dir="rtl" style="min-height: 200px;" class="tab-pane fade float-right w-100"
                    id="bar_chart_info_pane" role="tabpanel" aria-labelledby="bar_chart_info_tab">

                    <!-- Main Container includes: Form Fields, Tab Pills, Tab Panes -->
                    <div class="row flex-row-reverse px-0 py-5 px-md-5 py-md-5 m-0 mt-5">


                        <div dir="rtl" class="row shadow w-100 p-0">
                            <div id="trend_charts" class="row mt-4 w-100 flex-row mx-0 px-4 pb-5">
                                <div dir="ltr" id="time_series_analysis_chart_container" style="height: 450px"
                                    class="bg-white w-100 p-1">
                                </div>
                            </div>
                        </div>



                        <div dir="rtl" class="row shadow w-100 p-0">
                            <div id="subject_container_div" class="row mt-4 w-100 flex-row mx-0 px-4 pb-5">
                                <div dir="ltr" id="subject_container" style="height: 450px"
                                    class="bg-white w-100 p-1">
                                </div>
                            </div>
                        </div>

                        <div dir="rtl" class="row shadow w-100 p-0">
                            <div id="year_container_div" class="row mt-4 w-100 flex-row mx-0 px-4 pb-5">
                                <div dir="ltr" id="year_container" style="height: 450px"
                                    class="bg-white w-100 p-1">
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- Vote Result Pane -->
                <div id="vote_result_pane" class="tab-pane w-100 fade float-right" role="tabpanel"
                    aria-labelledby="vote_result_tab">
                    <!-- Vote Result table -->
                    <div class="table-responsive vote_result_table mt-4">
                        <!-- Download Buttons -->
                        <button type="button" data-bs-toggle="tooltip" data-bs-placement="top" title="دانلود اسناد"
                            class="btn float-left p-0 px-1 mt-2" id="DownloadBtn" onclick="DownloadSerachResultFunction()"
                            type="button">
                            <i class="far fa-file-archive m-0" style="font-size: 25px;margin: 0px;"></i>

                        </button>

                        <button class="btn float-left p-0 px-1 mt-2" id="ExportExcel" data-bs-toggle="tooltip"
                            data-bs-placement="top" title="خروجی اکسل" onclick="ExportExcelSerachResultFunction()"
                            type="button">
                            <i class="far fa-file-excel text-success m-0" style="font-size: 25px;margin: 0px;"></i>
                        </button>

                        <!-- Result Count -->
                        <p id="VoteResultLable" class="text-left float-left text-secondary pl-2"></p>
                        <table class="table table-striped VoteTable" style="min-height: 200px;" id="VoteTable">
                        </table>
                    </div>

                </div>

                <!--  Document Graph Pane -->
                <div class="tab-pane fade show float-right w-100" id="document_graph_pane" role="tabpanel"
                    aria-labelledby="document_graph_tab">
                    <div class="row mt-4 w-100 flex-row-reverse  mx-auto pb-5 px-4">
                        <!-- doc colors -->
                        <ul id="ColorBox"
                            class="list-group flex-row-reverse list-unstyled w-100 list-group-horizontal text-right">
                        </ul>
                        <script src="../../static/js/graph/color_picker_handler.js">
                        </script>
                        <div id="advanced_graph_container" class="w-100 border mt-1" style="height:500px;">
                        </div>
                    </div>
                </div>

                <!--  Definition Keywords Graph Pane -->
                <div class="tab-pane fade show float-right w-100" id="definition_keywords_graph_pane" role="tabpanel"
                    aria-labelledby="definition_keywords_graph_tab">
                    <!-- keyword graph container -->
                    <div class="row mt-4 w-100 flex-row mx-0 px-4 pb-5">

                        <div id="definition_keywords_graph_container" class="w-100 border" style="height: 500px;">
                        </div>
                    </div>
                </div>


            </div>

        </div>
    </div>



    <!-- Details Modal Container -->
    <div class="modal fade" id="detailModal">
        <div class="modal-dialog modal-dialog-scrollable modal-xl">
            <div class="modal-content">

                <!-- Modal Header -->
                <div style="direction: rtl !important;" class="modal-header">
                    <h5 id="ModalHeader" class="modal-title">عنوان</h5>
                    <button type="button" class="btn-close m-0" data-bs-dismiss="modal"></button>
                </div>

                <!-- Modal body -->
                <div class="modal-body bg-light text-justify">
                    <div id="DetailText" class="bg-light text-justify">
                    </div>
                </div>
                <!-- Modal footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">بستن</button>
                </div>

            </div>
        </div>
    </div>

    <!-- ChartModal Container -->
    <button type="button" id="actors_modal_btn" class="btn d-none modal_btn" data-bs-toggle="modal"
        data-bs-target="#actors_modal"></button>
    <div class="modal fade" id="actors_modal">
        <div class="modal-dialog modal-dialog-scrollable modal-xl">
            <div class="modal-content">

                <!-- Modal Header -->
                <div style="direction: rtl !important;" class="modal-header">
                    <h5 id="actor_modal_header" class="modal-title">عنوان</h5>
                    <button type="button" class="btn-close m-0" data-bs-dismiss="modal"></button>
                </div>
                <!-- Modal body -->

                <div class="bg-light modal-body text-justify">
                    <div id="actor_modal_body" class="bg-light text-justify">

                    </div>
                </div>
                <!-- Modal footer -->
                <div id="modal_footer" class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">بستن
                    </button>
                </div>

            </div>
        </div>
    </div>


    <!-- ChartModal Container -->
    <button type="button" id="edge_modal_btn" class="btn d-none modal_btn" data-bs-toggle="modal"
        data-bs-target="#edge_modal"></button>

    <div class="modal fade" id="edge_modal">
        <div class="modal-dialog modal-dialog-scrollable modal-xl">
            <div class="modal-content">

                <!-- Modal Header -->
                <div style="direction: rtl !important;" class="modal-header">
                    <div id="edge_modal_header" class="modal-title">
                        <span class="text-secondary">کنش‌گر: </span>
                        <h5 id="edge_actor_modal_header" class="d-inline-block text-right"></h5>
                        <br>
                        <span class="text-secondary">کلیدواژه: </span>
                        <h6 id="edge_keyword_modal_header" class="d-inline-block text-right"></h6>
                    </div>

                    <button type="button" class="btn-close m-0" data-bs-dismiss="modal"></button>
                </div>

                <!-- Modal body -->
                <div id="edge_actor_paragraphs" class="modal-body bg-light text-justify">

                    <div id="edge_actor_modal_body">

                    </div>
                </div>


                <!-- Modal footer -->
                <div id="modal_footer" class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">بستن
                    </button>
                </div>

            </div>
        </div>
    </div>

    <!-- ُStackChartModal Container -->
    <button type="button" id="actors_effect_modal_btn" class="btn d-none modal_btn" data-bs-toggle="modal"
        data-bs-target="#actors_effect_modal"></button>
    <div class="modal fade" id="actors_effect_modal">
        <div class="modal-dialog modal-dialog-scrollable modal-xl">
            <div class="modal-content">

                <!-- Modal Header -->
                <div style="direction: rtl !important;" class="modal-header">
                    <h5 id="actor_effect_modal_header" class="modal-title">عنوان</h5>
                    <button type="button" class="btn-close m-0" data-bs-dismiss="modal"></button>
                </div>

                <!-- Modal body -->
                <div class="bg-light modal-body text-justify">
                    <!-- <div class="highlight_options mt-0 p-0 float-left" style="z-index: 13;">
                        <button onclick="showOtherActors()" data-bs-toggle="tooltip" data-bs-placement="right"
                            title="نمایش سایر کنشگران" class="btn border float-left m-0  px-1"><i
                                style="font-size: 24px;" class="bi text-primary bi-people-fill"></i></button> -->
                    <!-- <button class="btn float-left m-0  px-1"><i style="font-size: 24px;" class="bi text-success bi-hourglass-split"></i></button> -->
                    <!-- </div>
                    <br> -->
                    <div id="actor_effect_modal_body" class="bg-light text-justify">

                    </div>
                </div>

                <!-- Modal footer -->
                <div id="actor_effect_modal_footer" class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">بستن
                    </button>
                </div>
            </div>
        </div>
    </div>


    <!-- Actor-Supervisor Edge modal Container -->
    <button type="button" id="actor_supervisor_edge_modal_btn" class="btn d-none modal_btn" data-bs-toggle="modal"
        data-bs-target="#actor_supervisor_edge_modal"></button>

    <div class="modal fade" id="actor_supervisor_edge_modal">
        <div class="modal-dialog modal-dialog-scrollable modal-xl">
            <div class="modal-content">

                <!-- Modal Header -->
                <div style="direction: rtl !important;" class="modal-header">
                    <div id="edge_modal_header" class="modal-title">
                        <span class="text-secondary">کنش‌گر: </span>
                        <h5 id="edge_actor_name_header" class="d-inline-block text-right"></h5>
                        <br>
                        <span class="text-secondary">ناظر: </span>
                        <h6 id="edge_supervisor_name_header" class="d-inline-block text-right"></h6>
                    </div>

                    <button type="button" class="btn-close m-0" data-bs-dismiss="modal"></button>
                </div>

                <!-- Modal body -->
                <div id="edge_actor_supervisor_paragraphs" class="modal-body bg-light text-justify">

                    <br>

                    <div id="edge_actor_supervisor_modal_body">

                    </div>
                </div>


                <!-- Modal footer -->
                <div id="modal_footer" class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">بستن
                    </button>
                </div>

            </div>
        </div>
    </div>





    <!-- YearModal Container -->
    <button type="button" id="year_modal_btn" class="btn d-none modal_btn" data-bs-toggle="modal"
        data-bs-target="#year_modal"></button>
    <div class="modal fade" id="year_modal">
        <div class="modal-dialog modal-dialog-scrollable modal-xl">
            <div class="modal-content">

                <!-- Modal Header -->
                <div style="direction: rtl !important;" class="modal-header">
                    <div id="edge_modal_header" class="modal-title">
                        <span class="text-secondary">موضوع: </span>
                        <h5 id="year_actor_modal_header" class="d-inline-block text-right"></h5>
                        <br>
                        <span class="text-secondary">در سال: </span>
                        <h6 id="year_name_modal_header" class="d-inline-block text-right"></h6>
                    </div>

                    <button type="button" class="btn-close m-0" data-bs-dismiss="modal"></button>
                </div>

                <!-- Modal body -->

                <div class="bg-light modal-body text-justify">

                    <div id="year_modal_body" class="bg-light text-justify">

                    </div>
                </div>
                <!-- Modal footer -->
                <div id="modal_footer" class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">بستن
                    </button>
                </div>

            </div>
        </div>
    </div>


    <!-- Toast -->
    <div class="position-absolute top-0 start-50 translate-middle p-3" style="z-index: 11;margin-top:95px;">
        <div dir="rtl" id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div dir="rtl" class="toast-header">
                <img width="25px;" src="../../static/icons/logo/logo1.png" class="rounded mx-0" alt="...">
                <strong dir="rtl" class="w-100 mr-2 mt-1">هوش‌یار</strong>
                <button type="button" class="btn-close float-left ml-0" data-bs-dismiss="toast"
                    aria-label="Close"></button>
            </div>
            <div class="toast-body">
                <i style="position: relative; top: -7px; font-size: 18px;"
                    class="bi bi-exclamation-triangle-fill  text-warning"></i>
                <span id="toast_message">
                    موضوعی انتخاب نشده‌است.
                </span>
            </div>
        </div>
    </div>


    <!-- Modal Container -->
    <div class="modal fade" id="Correlation_Comparison_Modal">
        <div id="modal_dialog" class="modal-dialog  modal-fullscreen">
            <div class="modal-content">

                <!-- Modal Header -->
                <div style="direction: rtl !important;" class="modal-header bg-light">
                    <h5 id="Correlation_ModalHeader" class="modal-title text-center text-secondary w-100">

                    </h5>
                    <button type="button" class="btn-close m-0" data-bs-dismiss="modal"></button>
                </div>

                <!-- Modal body -->
                <div id="Correlation_Modal_Body" class="modal-body bg-light text-justify">
                    <div class="row w-100">
                        <div class="row w-100">

                            <!--Grid column-->
                            <div class="col-md-2 mb-4 ">

                                <ul class="nav nav-pills pills-primary d-flex flex-column" role="tablist">
                                    <li class="nav-item">
                                        <a class="nav-link modal_nav_link active" data-bs-toggle="pill"
                                            data-bs-target="#total_role_panel" type="button" role="tab"
                                            aria-controls="total_role_panel" aria-selected="false" data-toggle="tab"
                                            role="tab">برآیند نقش‌ها</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link modal_nav_link" data-bs-toggle="pill"
                                            data-bs-target="#motevali_panel" type="button" role="tab"
                                            aria-controls="motevali_panel" aria-selected="false" role="tab">متولی
                                            اجرا</a>
                                    </li>

                                    <li class="nav-item">
                                        <a class="nav-link modal_nav_link" data-bs-toggle="pill"
                                            data-bs-target="#hamkar_panel" type="button" role="tab"
                                            aria-controls="hamkar_panel" aria-selected="false" role="tab">همکار</a>
                                    </li>

                                    <li class="nav-item">
                                        <a class="nav-link modal_nav_link" data-bs-toggle="pill"
                                            data-bs-target="#salahiat_panel" type="button" role="tab"
                                            aria-controls="salahiat_panel" aria-selected="false" role="tab">ذی‌صلاح</a>
                                    </li>

                                </ul>

                            </div>
                            <!--Grid column-->

                            <!--Grid column-->
                            <div class="col-md-10 mb-4">

                                <!-- Tab panels -->
                                <div class="tab-content pt-0">

                                    <!--Panel 1-->
                                    <div class="tab-pane fade show active" id="total_role_panel" role="tabpanel">
                                        <div dir="ltr" id="total_comparison_chart" style="height: 470px"
                                            class="w-100 float-left px-1">
                                        </div>
                                    </div>
                                    <!--/.Panel 1-->

                                    <!--Panel 2-->
                                    <div class="tab-pane fade" id="motevali_panel" role="tabpanel">
                                        <div dir="ltr" id="motevali_comparison_chart" style="height: 470px"
                                            class="w-100 float-left px-1">
                                        </div>
                                    </div>
                                    <!--/.Panel 2-->


                                    <!--Panel 3-->
                                    <div class="tab-pane fade" id="hamkar_panel" role="tabpanel">
                                        <div dir="ltr" id="hamkar_comparison_chart" style="height: 470px"
                                            class="w-100 float-left px-1">
                                        </div>
                                    </div>
                                    <!--/.Panel 3-->

                                    <!--Panel 4-->
                                    <div class="tab-pane fade" id="salahiat_panel" role="tabpanel">
                                        <div dir="ltr" id="salahiat_comparison_chart" style="height: 470px"
                                            class="w-100 float-left px-1">
                                        </div>
                                    </div>
                                    <!--/.Panel 4-->

                                </div>


                            </div>
                            <!--Grid column-->

                        </div>
                        <!--Grid row-->
                        <!-- <div dir="ltr" id="Source_Actor_Chart" style="height: 470px" class="col-6 float-right px-1">
                        </div>
                        <div dir="ltr" id="Other_Actor_Chart" style="height: 470px" class="col-6 float-left px-1">
                        </div> -->
                    </div>
                </div>

                <!-- Modal footer -->
                <div class="modal-footer bg-light">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">بستن</button>
                </div>

            </div>
        </div>
    </div>

    <!-- ChartModal Container -->
    <button type="button" id="ChartModalBtn" class="btn d-none modal_btn" data-bs-toggle="modal"
    data-bs-target="#ChartModal"></button>
    <div class="modal fade" id="ChartModal">
        <div class="modal-dialog modal-dialog-scrollable modal-lg">
            <div class="modal-content">

                <!-- Modal Header -->
                <div style="direction: rtl !important;" class="modal-header">
                    <h5 id="ChartModalHeader" class="modal-title">عنوان</h5>
                    <button type="button" class="btn-close m-0" data-bs-dismiss="modal"></button>
                </div>

                <!-- Modal body -->
                <div id="ChartModalText" class="modal-body text-justify">
                </div>

                <!-- Modal footer -->
                <div dir="rtl" class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">بستن</button>
                </button>
                    {% comment %} <button id="DownloadDocuments" class="btn btn-primary"><i class="fa fa-download"></i> دانلود
                        اسناد</button>

                    <button id="ExportExcel2" class="btn btn-primary"><i class="fa fa-download"></i> خروجی اکسل
                    </button> {% endcomment %}
                </div>

            </div>
        </div>
    </div>

    <!-- Scrollbar -->
    <button id="scroll_btn" class="p-0" title="بالای صفحه" onclick="topFunction()">
        <i class="far fa-caret-square-up"></i>
    </button>

    <script src="../../static/js/logincheck.js"></script>

    <script src="../../static/js/scroll_button_handler.js">
    </script>

</body>

<!-- Blocking UI -->
<script src="../../static/js/blockUI.js"></script>
<script src="../../static/js/blockUI_handler.js"></script>
<link rel="stylesheet" href="../../static/styles/loader.css">

<script>
    var details_list = []
    let actors_list = []
    let actors_dict = {}

    /* Optianal keywords need to be highlighted */
    const optional_keywords = ['به‌منظور', 'نسبت به']
    let optional_after_terms_count = {}
    optional_after_terms_count['به‌منظور'] = 2
    optional_after_terms_count['نسبت به'] = 2

    let preprocessed_keywords_text = 'empty';
    let SearchResultValue = {}
    let multiselect_role_value = '0';
    let multiselect_actor_value = '';

    /* Global Constants */
    const motevalian_punctuations = ['.', '،', 'ـ', '-', ':'];
    const hamkaran_punctuations = ['،', ')', ':']

    const motevali_keywords = ['موظف است', 'مکلف است', 'مکلف‌اند', 'موظف‌اند', 'موظفند', 'مکلفند', 'موظف به', 'مکلف به'];
    const hamkaran_keywords = ['با همکاری', 'باهمکاری'];
    const salahiat_keywords = ['مختار است', 'اختیار دارد', 'می‌تواند', 'می تواند', 'میتواند', 'می­تواند', 'می‏تواند', 'مجاز است'];


    const deadline_pattern_keywords = ['ظرف', 'ظرف مدت', 'ظرف مهلت', 'طی', 'طی مدت', 'طی مهلت', 'حداکثر', 'فواصل زمانی', 'هر']
    const time_categories = ['روز', 'هفته', 'ماه', 'سال']
    const numbers_dict = {
        "یک": {
            'value': 1,
        },
        "دو": {
            'value': 2,
        },
        "سه": {
            'value': 3,
        },
        "چهار": {
            'value': 4,
        },
        "پنج": {
            'value': 5,
        },
        "شش": {
            'value': 6,
        },
        "هفت": {
            'value': 7,
        },
        "هشت": {
            'value': 8,
        },
        "نه": {
            'value': 9,
        },
        "ده": {
            'value': 10,
        }
    }

    init()


    container_id_list = ['SearchTable', 'CorrelationTable', 'DocumentCount',
        'actors_chart_container', 'actors_supervisors_graph_container',
        'time_series_analysis_chart_container',
        'roles_radar_chart_container', 'subjects_radar_chart_container',
        'Word_cloud_analysis_chart_container',
        'actors_effect_stack_chart_container', 'MaxMinActorTable',
        'ActorsWithoutDutyTable']

    function clearPrevResults(container_id_list) {
        for (let container_id of container_id_list) {
            document.getElementById(container_id).innerHTML = "";
        }
    }

    async function init() {
        startBlockUI('search_result_pane');
        
        request_link = 'http://' + location.host + "/SearchDocument_ES2/" + "1" + "/" + "0" + "/" + "0" + "/" + "10" + "/" +
            "214" + "/" + "0" + "/" + "0" + "/" + "0" + "/" + "0" + "/" + "0" + "/" + "عنوان" + "/" + "ابطال" + "/" + "exact" + "/"


        response = await fetch(request_link).then(response => response.json());
        documents = response['result']


        /* Get Actors List */
        request_link = 'http://' + location.host + "/GetActorsList/";
        response = await fetch(request_link).then(response => response.json());
        actors_list = response["actorsList"];

        show_actors_table(documents,actors_list)
        stopBlockUI('search_result_pane', 'دسته‌بندی آراء');

        startBlockUI('vote_result_pane');

        /* Get Divan documents  */
        request_link = 'http://' + location.host + "/GetIndictmentDocs/";
        response = await fetch(request_link).then(response => response.json());
        votes = response["result"];

        show_votes_table(votes)
        stopBlockUI('vote_result_pane', 'آراء دیوان عدالت اداری');

        GetChartData_Es("1",votes)

    }


    async function show_actors_table(documents,actors_list) {
        vaziran_kw = ['هیات وزیران', 'هیئت وزیران']

        showra_kw = ['شورای اسلامی']
        uni_kw = ['دانشگاه']
        isar_kw = ['ایثارگران']
        actors_kw = actors_list

        kw_dict = {
            "vaziran_kw": {
                "list": vaziran_kw,
                "count": 0,
                "document_id_list": []
            },
            "showra_kw": {
                "list": showra_kw,
                "count": 0,
                "document_id_list": []
            },
            "uni_kw": {
                "list": uni_kw,
                "count": 0,
                "document_id_list": []
            },
            "isar_kw": {
                "list": isar_kw,
                "count": 0,
                "document_id_list": []
            },
        }

        for (actor of actors_list) {
            kw_dict[actor] = {
                "list": [actor],
                "count": 0,
                "document_id_list": []                
            }
        }

        kw_dict["other"] = {
            "list": [' '],
            "count": 0,
            "document_id_list": []
        }


        for (doc of documents) {
            doc_id = doc['_id']
            doc_name = doc['_source']['name'];

            for (const [key, value] of Object.entries(kw_dict)) {
                kw_list = value['list']
                selected_flag = false;
                for (kw of kw_list) {
                    if (doc_name.includes(kw)) {
                        value['count'] += 1
                        value['document_id_list'].push([doc_id, doc_name]);
                        selected_flag = true;
                        kw_dict[key] = value;
                        break
                    }
                }
                if (selected_flag)
                    break
            }

        }

        console.log(kw_dict)

        result_chart_data = []
        for (const [key, value] of Object.entries(kw_dict)) {
            if (value['count'] != 0) {
                column_name = value['list'][0] == ' ' ? 'سایر': value['list'][0]
                column_count = value['count']
                column = [column_name, column_count, key]
                result_chart_data.push(column)
            }
        }

        showDocumentInformation(kw_dict)
        details_list = kw_dict

        showChart(result_chart_data,'time_series_analysis_chart_container','',[],true)


    }


    async function show_votes_table(votes) {
        let votes_information_list = votes
        // some code

        showVoteInformation(votes_information_list)
    }


    function showChart(data, position, documents_information_result, keySort) {


        if (keySort === true) {
            data.sort(function (element_a, element_b) {
                return element_a[0] - element_b[0];
            });
        }
        else {
            data.sort(function (element_a, element_b) {
                return element_a[1] - element_b[1];
            });
        }

        data.sort(function (x, y) { return x[0] === 'نامشخص' ? -1 : y[0] === 'نامشخص' ? 1 : 0; });

        // Sorts the data by descending.
        data = anychart.data.set(data)

        document.getElementById(position).innerHTML = ""

        chart = anychart.column();
        chart.container(position);
        // create a column series and set the data
        var series = chart.column(data);
        chart
            .animation(true)
            .padding([10, 40, 5, 20])


        chart.background().fill('#ffffff');
        series.normal().fill("#488fb8", 1);
        series.normal().stroke("#488fb8", 0);

        // var state = series.normal();
        // state.fill('#1481c0')

        // x axix labels font setting
        var xAxisLabels = chart.xAxis().labels();
        xAxisLabels.fontFamily("vazir");

        var yAxisLabels = chart.yAxis().labels();
        yAxisLabels.fontFamily("vazir");

        // Not allow labels overlapping
        var xAxis = chart.xAxis();
        xAxis.overlapMode("noOverlap");

        var yAxis = chart.yAxis();
        yAxis.title("تعداد سند");
        yAxis.title().fontFamily('vazir');
yAxis.title().fontWeight("bold");
        yAxis.title().height(40);

        // tooltip content font setting
        var tooltip = chart.tooltip();
        tooltip.fontFamily("vazir");

        // tooltip title font setting
        var title = chart.tooltip().title();
        title.fontFamily("vazir");

        chart.tooltip().hAlign('center').format("{%value}");

        chart.xAxis().labels().height(60);

        chart.yAxis().labels().format("{%value}");

        chart.yScale().minimum(0);
        chart.yScale().ticks().allowFractional(false);

        //xAxisLabels.rotation(-90)
        // initiate drawing the chart
        chart.draw();

        chart.listen('Click', async function (event) {
            const click_tag = event.domTarget.tag;
            var index = click_tag["index"]
            console.log(index)
            const text = data.row(index)[0];
            const actor = data.row(index)[2];
            let filtered_result = []
            let header = ""

            docs = details_list[actor]['document_id_list']

            document.getElementById("ChartModalText").innerHTML = ""
            document.getElementById("ChartModalHeader").innerHTML = 'اسناد دسته ' + details_list[actor]['list'][0]

            /*  Show detail Result */
            let filtered_result_tag = ""
            index = 1;
            for (let doc of docs) {
                const link = 'http://' + location.host + "/information/?id=" + doc[0];
                let title_tag = "<a href='" + link + "'>" + doc[1] + "</a>";
                paragraph_tag = "<li class='mt-3'>" + title_tag + "</li>";
                filtered_result_tag += paragraph_tag;
            }

            filtered_result_tag = "<ol start='1'>" + filtered_result_tag + "</ol>"
            document.getElementById("ChartModalText").innerHTML = filtered_result_tag


            $("#ChartModalBtn").click();


        })

    }


    async function PredictionFunction(model_name) {

        country_id = document.getElementById('country').value
        actor_id = document.getElementById('ActorSelect').value

        startFullPageBlockUI();

        document.getElementById('total_comparison_chart').innerHTML = "";
        document.getElementById('motevali_comparison_chart').innerHTML = "";
        document.getElementById('hamkar_comparison_chart').innerHTML = "";
        document.getElementById('salahiat_comparison_chart').innerHTML = "";

        document.getElementById('Correlation_ModalHeader').innerHTML = 'پیش‌بینی روند'

        let request_link = 'http://' + location.host + "/GetPredictionChartsData_ByAtorsID/"
            + country_id + "/" + actor_id + "/" + model_name + "/"
        let response = await fetch(request_link).then(response => response.json());

        let comparison_charts_data = response["comparison_charts_data"];
        let prediction_rmse = response["prediction_rmse"];
        let best_parameters = response["best_parameters"];
        let actor_name = response["actor_name"];

        total_chart_data = comparison_charts_data['همه']
        total_rmse = prediction_rmse['همه']
        total_best_cfg = best_parameters['همه']

        motevali_chart_data = comparison_charts_data['متولی اجرا']
        motevali_rmse = prediction_rmse['متولی اجرا']
        motevali_best_cfg = best_parameters['متولی اجرا']

        hamkar_chart_data = comparison_charts_data['همکار']
        hamkar_rmse = prediction_rmse['همکار']
        hamkar_best_cfg = best_parameters['همکار']

        salahiat_chart_data = comparison_charts_data['دارای صلاحیت اختیاری']
        salahiat_rmse = prediction_rmse['دارای صلاحیت اختیاری']
        salahiat_best_cfg = best_parameters['دارای صلاحیت اختیاری']



        showPredictionsYearsLineChart('total_comparison_chart', total_chart_data, actor_name, model_name, 'برآیند نقش‌ها', total_rmse, total_best_cfg);
        showPredictionsYearsLineChart('motevali_comparison_chart', motevali_chart_data, actor_name, model_name, 'متولی اجرا', motevali_rmse, motevali_best_cfg);
        showPredictionsYearsLineChart('hamkar_comparison_chart', hamkar_chart_data, actor_name, model_name, 'همکار', hamkar_rmse, hamkar_best_cfg);
        showPredictionsYearsLineChart('salahiat_comparison_chart', salahiat_chart_data, actor_name, model_name, 'دارای صلاحیت اختیاری', salahiat_rmse, salahiat_best_cfg);
        stopFullPageBlockUI('پیش‌بینی روند');



    }


    async function showCorrelationInformation(table_result) {

        $('#CorrelationTable').empty();
        $('.CorrelationTable').footable({
            "paging": {
                "enabled": true,
                strings: {
                        first: '»',
                        prev:'›',
                        next: '‹',
                        last: '«'
                    }
            },
            "filtering": {
                "enabled": false
            },
            "sorting": {
                "enabled": true
            },
            "empty": "کنشگری یافت نشد.",
            "columns": [{
                "name": "id",
                "title": "ردیف",
                "breakpoints": "xs sm",
                "type": "number",
                "style": {
                    "width": "5%"
                }
            }, {
                "name": "actor_tag",
                "title": "نام کنشگر",
                "style": {
                    "width": "35%"
                }
            }, {
                "name": "motevali_corr",
                "title": "شباهت (متولی)",
                "style": {
                    "width": "15%"
                }
            }, {
                "name": "hamkar_corr",
                "title": "شباهت (همکار)",
                "style": {
                    "width": "15%"
                }
            }, {
                "name": "salahiat_corr",
                "title": "شباهت (ذی صلاح)",
                "style": {
                    "width": "15%"
                }
            }, {
                "name": "total_corr",
                "title": "شباهت (برآیند)",
                "style": {
                    "width": "15%"
                },
                "sorted": true,
                "direction": "DESC"
            }

                , {
                "name": "detail",
                "title": "جزئیات",
                "style": {
                    "width": "5%"
                }
            }
            ],
            "rows": table_result
        });


    }

    /************** Subject Radar chart data tab ***************************************/

    async function getSubjectRadarChartData(country_id, multiselect_role_value, actor_id, preprocessed_keywords_text) {

        startBlockUI('subjects_radar_chart_container');

        let request_link = 'http://' + location.host + "/GetActorSubjectsRadar_ChartData/"
            + country_id + "/" + multiselect_role_value + "/" + actor_id + "/" + preprocessed_keywords_text + "/";
        let response = await fetch(request_link).then(response => response.json());

        let subjects_chart_data = response["subjects_chart_data"];

        console.log(subjects_chart_data)

        let actor_name = GetMultiSelectText('ActorSelect');

        await showRadarChart('subjects_radar_chart_container', actor_name, subjects_chart_data, 'تحلیل موضوعی', country_id, preprocessed_keywords_text)
        stopBlockUI('subjects_radar_chart_container', 'تحلیل موضوعی کنشگر');
    }

    /************** Role Radar chart data tab ***************************************/

    async function getRoleRadarChartData(country_id, multiselect_role_value, actor_id, preprocessed_keywords_text) {

        startBlockUI('roles_radar_chart_container');

        let request_link = 'http://' + location.host + "/GetActorRolesRadar_ChartData/"
            + country_id + "/" + multiselect_role_value + "/" + actor_id + "/" + preprocessed_keywords_text + "/";
        let response = await fetch(request_link).then(response => response.json());

        let roles_chart_data = response["roles_chart_data"];

        console.log(roles_chart_data)

        let actor_name = GetMultiSelectText('ActorSelect');

        await showRadarChart('roles_radar_chart_container', actor_name, roles_chart_data, 'تحلیل نقش', country_id, preprocessed_keywords_text)
        stopBlockUI('roles_radar_chart_container', 'تحلیل نقش‌های کنشگر');
    }

    async function showRadarChart(chart_container, actor_name, chart_data, chart_pre_title, country_id, preprocessed_keywords_text) {
        document.getElementById(chart_container).innerHTML = ""


        anychart.onDocumentReady(function () {

            // create a chart
            chart = anychart.radar();


            chart
                .animation(true)
                .padding([10, 60, 10, 0])

            // set the chart title
            chart_title = chart_pre_title + '\n' + "کنشگر: " + actor_name + "\n"

            chart.title(chart_title);
            chart.title().fontFamily("vazir");;


            // create the first series (line) and set the data
            var series = chart.line(chart_data);

            series.normal().stroke("4 #00cc99");
            series.hovered().stroke("4 #00cc99");
            series.selected().stroke("4 #00cc99");

            // set the container id
            chart.container(chart_container);
            // initiate drawing the chart


            // chart.xScale().mode('continuous');
            chart.yScale().ticks().allowFractional(false)


            // x axix labels font setting
            var xAxisLabels = chart.xAxis().labels();
            xAxisLabels.fontFamily("vazir");
            xAxisLabels.fontWeight(600);

            // y axix labels font setting
            var yAxisLabels = chart.yAxis().labels();
            yAxisLabels.fontFamily("vazir");

            chart.tooltip().title().fontFamily('vazir');
            chart.tooltip().fontFamily('vazir');
            chart.tooltip().hAlign('center').format("{%value}%");

            chart.yGrid().palette(["gray 0.05", "gray 0.1"]);

            chart.draw();

        });
    }

    /************** Time-Series chart data tab ***************************************/

    async function getTimeSeriesChartData(country_id, multiselect_role_value, actor_id, preprocessed_keywords_text, container_id, tab_name) {


        startBlockUI(container_id)
        let request_link = 'http://' + location.host + "/GetActorTimeSeries_ChartData/"
            + country_id + "/" + actor_id + "/";
        let response = await fetch(request_link).then(response => response.json());

        let years_chart_data = response["years_chart_data"];

        let years_chart_data_predict = response["predictions"];
        let lstm_chart_data = response["lstm_chart_data"];
        console.log(years_chart_data)
        console.log(years_chart_data_predict)
        let last_year = response["last_year"];
        let actor_name = response["actor_name"];

        await showYearsLineChart(container_id, actor_name, years_chart_data, country_id, preprocessed_keywords_text, years_chart_data_predict, last_year, 'ARIMA')
        // await showYearsLineChart('lstm_chart_container', actor_name, lstm_chart_data, country_id, preprocessed_keywords_text, [], last_year, 'LSTM')

        stopBlockUI(container_id, tab_name);
    }



    async function showYearsLineChart(chart_container, actor_name, chart_data, country_id, preprocessed_keywords_text, chart_data_predict, last_year, model_name) {


        document.getElementById(chart_container).innerHTML = ""

        // create a chart
        var chart = anychart.line();

        chart
            .animation(true)
            .padding([10, 60, 10, 0])


        // tooltip content font setting
        var tooltip = chart.tooltip();
        tooltip.fontFamily("vazir");

        // tooltip title font setting
        var title = chart.tooltip().title();
        title.fontFamily("vazir");

        // set the chart title
        chart_title = "جریان‌یابی موضوعات" + '\n' + 'مدل پیش‌بینی‌گر: ' + model_name + "\n"
        chart.title(chart_title);
        chart.title().fontFamily("vazir").textDirection('rtl');;

        // set predict Line

        year_line = last_year

        var marker = chart.lineMarker();
        // marker.axis(chart);
        marker.layout("vertical");
        marker.value(year_line);
        marker.stroke({
            thickness: 2,
            color: "#0D0",
            dash: "2 4"
        });

        // add prdict data
        chart_data = chart_data.concat(chart_data_predict)

        // set the interactivity mode
        // chart.interactivity().hoverMode("single");
        trend_started = false
        edited_chart_data = []

        for (column of chart_data) {
            total_count = column[4]
            if (total_count == 0 && !trend_started) {

            } else {
                edited_chart_data.push(column);
                trend_started = true
            }
        }

        var data = anychart.data.set(edited_chart_data)

        var total_series_data = data.mapAs({ x: 0, value: 4 });
        // create the second series, set the data and name  
        var total_series = chart.line(total_series_data);
        total_series.name("هولوکاست");

        // configure the visual settings of the second series
        total_series.normal().stroke("#6a0dad", 2, "10 5", "round");
        total_series.hovered().stroke("#6a0dad", 4, "10 5", "round");
        total_series.selected().stroke("#6a0dad", 6, "10 5", "round");


        var hamkaran_series_data = data.mapAs({ x: 0, value: 2 });
        // create the second series, set the data and name  
        var hamkaran_series = chart.line(hamkaran_series_data);
        hamkaran_series.name("مقاومت");

        // configure the visual settings of the second series
        hamkaran_series.normal().stroke("#28a745", 2, "10 5", "round");
        hamkaran_series.hovered().stroke("#28a745", 4, "10 5", "round");
        hamkaran_series.selected().stroke("#28a745", 6, "10 5", "round");


        // map the data
        var salahiat_series_data = data.mapAs({ x: 0, value: 3 });

        // create the first series, set the data and name
        var salahiat_series = chart.line(salahiat_series_data);
        salahiat_series.name("شعر");

        // configure the visual settings of the first series
        salahiat_series.normal().stroke("#ffc107", 2, "10 5", "round");
        salahiat_series.hovered().stroke("#ffc107", 4, "10 5", "round");
        salahiat_series.selected().stroke("#ffc107", 6, "10 5", "round");


        var motevalian_series_data = data.mapAs({ x: 0, value: 1 });
        // create the first series, set the data and name
        var motevalian_series = chart.line(motevalian_series_data);
        motevalian_series.name("روانشناسی");

        // configure the visual settings of the first series
        motevalian_series.normal().stroke("#007bff", 2, "10 5", "round");
        motevalian_series.hovered().stroke("#007bff", 4, "10 5", "round");
        motevalian_series.selected().stroke("#007bff", 6, "10 5", "round");
        // set the chart title

        // set the titles of the axes
        chart.xAxis().title("سال");
        chart.yAxis().title("فروانی");


        // x axix labels font setting
        var xAxisLabels = chart.xAxis().labels();
        xAxisLabels.fontFamily("vazir");

        var yAxisLabels = chart.yAxis().labels();
        yAxisLabels.fontFamily("vazir");

        // Not allow labels overlapping
        var xAxis = chart.xAxis();
        xAxis.overlapMode("noOverlap");
        xAxis.title().fontFamily('vazir');
xAxis.title().fontWeight("bold");

        // xAxis.staggerMode(false);

        var yAxis = chart.yAxis();
        yAxis.title().fontFamily('vazir');
yAxis.title().fontWeight("bold");
        yAxis.title().height(40);

        // chart.xScale().mode('continuous');
        chart.yScale().ticks().allowFractional(false)

        // set the container id
        chart.container(chart_container);


        // enable the legend
        chart.legend(true);

        var legend = chart.legend();
        legend.fontFamily('vazir')

        // set position mode
        legend.positionMode("inside");
        // set position and alignement
        legend.position("top");
        legend.align("center");
        legend.itemsLayout("horizontalExpandable");

        // initiate drawing the chart
        chart.draw();

        // motevalian columns
        motevalian_series.listen('click', async function (event) {
            const click_tag_index = event.domTarget.tag;
            const doc_year = edited_chart_data[click_tag_index][0];
            const actor_role_name = 'روانشناسی';

            await showYearParagraphs_Modal(country_id, actor_name, actor_role_name, doc_year, preprocessed_keywords_text);

        });

        // hamkaran columns
        hamkaran_series.listen('click', async function (event) {
            const click_tag_index = event.domTarget.tag;
            const doc_year = edited_chart_data[click_tag_index][0];
            const actor_role_name = 'مقاومت';

            await showYearParagraphs_Modal(country_id, actor_name, actor_role_name, doc_year, preprocessed_keywords_text);
        });

        // salahiat columns
        salahiat_series.listen('click', async function (event) {
            /* Modal Headers */
            const click_tag_index = event.domTarget.tag;
            const doc_year = edited_chart_data[click_tag_index][0];
            const actor_role_name = 'شعر';

            await showYearParagraphs_Modal(country_id, actor_name, actor_role_name, doc_year, preprocessed_keywords_text);
        });

        // total columns
        total_series.listen('click', async function (event) {
            /* Modal Headers */
            const click_tag_index = event.domTarget.tag;
            const doc_year = edited_chart_data[click_tag_index][0];
            const actor_role_name = 'هولوکاست';

            await showYearParagraphs_Modal(country_id, actor_name, actor_role_name, doc_year, preprocessed_keywords_text);
        });



    }


    async function showYearParagraphs_Modal(country_id, actor_name, actor_role_name, doc_year, preprocessed_keywords_text) {



        startFullPageBlockUI()


        document.getElementById('year_modal_body').innerHTML = ""

        /* Modal Title */
        const title_tag = actor_role_name
        $('#year_actor_modal_header').text(title_tag);

        const year_tag = doc_year
        $('#year_name_modal_header').text(year_tag);

        paragraph_tag = '';
        let keywords_list = preprocessed_keywords_text.split(",")

        document_id = 1
        document_name = "فلسفه سیاسی"

        document_link = 'http://' + location.host + "/information/?id=" + document_id
        doc_name = '<a class="bold text-secondary" target="to_blank" href="' + document_link + '">' + document_name + "</a>"

        paragraph_tag += "<li class='mb-3 lh-lg'>" + doc_name + "</li>";

        // =======================================================================
        document_id = 1
        document_name = "اثر مرکب"

        document_link = 'http://' + location.host + "/information/?id=" + document_id
        doc_name = '<a class="bold text-secondary" target="to_blank" href="' + document_link + '">' + document_name + "</a>"

        paragraph_tag += "<li class='mb-3 lh-lg'>" + doc_name + "</li>";

        // =======================================================================
        document_id = 1
        document_name = "مقاومت در اشعار"

        document_link = 'http://' + location.host + "/information/?id=" + document_id
        doc_name = '<a class="bold text-secondary" target="to_blank" href="' + document_link + '">' + document_name + "</a>"

        paragraph_tag += "<li class='mb-3 lh-lg'>" + doc_name + "</li>";

        // =======================================================================

        document.getElementById('year_modal_body').innerHTML = '<ol start="1">' + paragraph_tag + '</ol>'
        popup_handler();

        $("#year_modal_btn").click();


        stopFullPageBlockUI('کتب مرتبط با سال')


    }

    /************** Actors-Supervisors Graph tab ***************************************/

    async function getActorsSupervisorsGraphData(country_id, area_id, multiselect_actor_value, multiselect_role_value, preprocessed_keywords_text) {
        startBlockUI('actors_supervisors_graph_container');

        let request_link = 'http://' + location.host + "/GetActorsSupervisorsGraphData/"
            + country_id + "/" + area_id + "/" + multiselect_actor_value + "/" + preprocessed_keywords_text + "/";
        let response = await fetch(request_link).then(response => response.json());

        let actors_supervisors_graph_data = response["actors_supervisors_graph_data"];
        await ToggleSupervisorsGraphTabShow(actors_supervisors_graph_data)
        await showActorsKeywordsGraph('actors_supervisors_graph_container', actors_supervisors_graph_data, 'Directed', country_id, multiselect_role_value, preprocessed_keywords_text);
        stopBlockUI('actors_supervisors_graph_container', 'گراف نظارت');
    }



    async function ToggleSupervisorsGraphTabShow(actors_supervisors_graph_data) {
        if (actors_supervisors_graph_data['nodes'].length == 0) {
            if ($('#actors_supervisors_tab').hasClass('active')) {
                $('#actors_supervisors_tab').click();
            }

            $('#actors_supervisors_tab').hide();

        } else {
            $('#actors_supervisors_tab').show();
        }
    }


    async function showActorSupervisorEdgeModal(paragraphs_dict_result, source_actor_name, supervisor_name, preprocessed_keywords_text) {

        let keywords_list = preprocessed_keywords_text.split(',')

        /* Title Text */
        $('#edge_actor_name_header').text(source_actor_name)
        $('#edge_supervisor_name_header').text(supervisor_name)
        /* Body Text */

        document.getElementById("edge_actor_supervisor_modal_body").innerHTML = ""
        let paragraph_tag = '';

        for (const [paragraph_id, paragraph_info] of Object.entries(paragraphs_dict_result)) {
            document_id = paragraph_info['document_id']
            document_name = paragraph_info['document_name']

            document_link = 'http://' + location.host + "/information/?id=" + document_id
            doc_name = '<a class="bold text-secondary" target="to_blank" href="' + document_link + '">' + document_name + "</a>"

            paragraph_text = paragraph_info['paragraph_text'];
            source_actor_form = paragraph_info['source_actor_form']
            supervisor_actor_form = paragraph_info['supervisor_actor_form']

            highlighted_paragraph = await highlightActorSupervisor(paragraph_text, source_actor_form, supervisor_actor_form, keywords_list)
            paragraph_tag += "<li class='mb-3 lh-lg'>" + doc_name + highlighted_paragraph + "</li>"
        }

        document.getElementById("edge_actor_supervisor_modal_body").innerHTML = "<ul>" + paragraph_tag + "</ul>"

        $('#actor_supervisor_edge_modal_btn').click();

    }

    async function highlightActorSupervisor(paragraph_text, source_actor_form, supervisor_actor_form, keywords_list) {

        report_keywords = ['گزارش عملکرد', 'گزارش']
        paragraph_text = await highlightMotevalian(paragraph_text, source_actor_form, motevali_keywords, 'bg-success');
        paragraph_text = await highlightLegalDeadline(paragraph_text, motevali_keywords)


        // highlight other actors
        paragraph_text = await highlightOtherActors(paragraph_text, source_actor_form)

        // Highlight search keywords
        if (!keywords_list.includes('empty')) {
            for (keyword of keywords_list) {
                let keyword_tag = "<span class= 'bg-info text-white  rounded px-1'>" + keyword + "</span>"
                paragraph_text = paragraph_text.replaceAll(keyword, keyword_tag);

            }
        }

        // Highlight report keywords
        for (keyword of report_keywords) {
            report_keyword_tag = "<span class='border border-secondary border-2  px-1 rounded'>" + keyword + "</span>"
            paragraph_text = paragraph_text.replaceAll(' ' + keyword + ' ', ' ' + report_keyword_tag + ' ')

        }

        return paragraph_text;
    }


    /************** Documents result tab ***************************************/

    async function showDocumentInformation(documents_information_dict) {

        SearchResultValue = documents_information_dict;

        document.getElementById("SearchResultLable").innerText = (Object.keys(documents_information_dict).length).toString() + " دسته یافت شد.";
        let index = 1;
        let document_result = []

        for (var actor in documents_information_dict) {

            const name = documents_information_dict[actor]['list'][0]
            const count = documents_information_dict[actor]['count']

            const detail_function = "DetailFunction('" + actor + "')"
            const detail = '<button type="button" class="btn modal_btn" data-bs-toggle="modal" ' + ' onclick="' + detail_function + '" data-bs-target="#detailModal">جزئیات</button>'

            const row = {
                "id": index, 
                "name": name,
                'count': count,
                "detail": detail
            }
            if (name !=' '){
            document_result.push(row)
            index += 1
            }

        }
        $('#SearchTable').empty();
        $('.SearchTable').footable({
            "paging": {
                "enabled": true,
                strings: {
                        first: '»',
                        prev:'›',
                        next: '‹',
                        last: '«'
                    }
            },
            "filtering": {
                "enabled": false
            },
            "sorting": {
                "enabled": true
            },
            "empty": "دسته ای یافت نشد.",
            "columns": [{
                "name": "id",
                "title": "ردیف",
                "breakpoints": "xs sm",
                "type": "number",
                "style": {
                    "width": "5%"
                }
            }, {
                "name": "name",
                "title": "نام دسته",
                "style": {
                    "width": "35%"
                }
            }, {
                "name": "count",
                "title": "تعداد سند",
                "sorted": true,
                "direction": 'DESC',
                "style": {
                    "width": "15%"
                }
            }, {
                "name": "detail",
                "title": "جزئیات",
                "style": {
                    "width": "5%"
                }
            }
            ],
            "rows": document_result
        });

    }


    async function showVoteInformation(votes_information_list) {
        SearchResultValue = votes_information_list;

        document.getElementById("VoteResultLable").innerText = (votes_information_list.length).toString() + " رای یافت شد.";
        let index = 1;
        let vote_result = []

        for (var vote of votes_information_list) {

            const petition_number = vote['indictment_number']
            const date = vote['doc_approval_date']
            const subject = vote['categories']
            const doc_id = vote['doc_id']

            const doc_name = vote['doc_name'].length < 50 ?  vote['doc_name'] : vote['doc_name'].slice(0,50) + ' ...'

            const document_link = 'http://' + location.host + "/information/?id=" + doc_id
            const doc_tag = '<a title="' + vote['doc_name'] + '" href="' + document_link + '">' + doc_name + "</a>"

            const affected_name = vote['affected_document_name'].length < 50 ?  vote['affected_document_name'] : vote['affected_document_name'].slice(0,50) + ' ...'
            const affected = '<span title="'+ vote['affected_document_name'] + '" >' + affected_name + '</span>'
            const clause = '-'


            const row = {
                "index": index, 
                "petition_number": petition_number,
                "date": date,
                "subject": subject,
                "title": doc_tag,
                "document": affected,
                "clause": clause,
            }
            vote_result.push(row)
            index += 1
        }
        $('#VoteTable').empty();
        $('.VoteTable').footable({
            "paging": {
                "enabled": true,
                strings: {
                        first: '»',
                        prev:'›',
                        next: '‹',
                        last: '«'
                    }
            },
            "filtering": {
                "enabled": false
            },
            "sorting": {
                "enabled": true
            },
            "empty": "رایی یافت نشد.",
            "columns": [{
                "name": "index",
                "title": "ردیف",
                "breakpoints": "xs sm",
                "type": "number",
                "style": {
                    "width": "5%"
                }
            }, {
                "name": "petition_number",
                "title": "شماره دادنامه",
                "style": {
                    "width": "15%"
                }
            }, {
                "name": "date",
                "title": "تاریخ رای",
                "style": {
                    "width": "15%"
                }
            }, {
                "name": "subject",
                "title": "دسته موضوع",
                "style": {
                    "width": "15%"
                }
            }, {
                "name": "title",
                "title": "عنوان رای",
                "style": {
                    "width": "15%"
                }
            }, {
                "name": "document",
                "title": "مصوبه ابطال شده",
                "style": {
                    "width": "15%"
                }
            }, {
                "name": "clause",
                "title": "بند یا ماده ابطال شده",
                "style": {
                    "width": "15%"
                }
            }
            ],
            "rows": vote_result
        });        
    }

    async function ComparisonFunction(country_id, source_actor_id, other_actor_id) {
        startFullPageBlockUI();

        document.getElementById('total_comparison_chart').innerHTML = "";
        document.getElementById('motevali_comparison_chart').innerHTML = "";
        document.getElementById('hamkar_comparison_chart').innerHTML = "";
        document.getElementById('salahiat_comparison_chart').innerHTML = "";

        document.getElementById('Correlation_ModalHeader').innerHTML = 'مقایسه روند'

        let request_link = 'http://' + location.host + "/getComparisonTrendChartsData_ByAtorsID/"
            + country_id + "/" + source_actor_id + "/" + other_actor_id + "/";
        let response = await fetch(request_link).then(response => response.json());

        let comparison_charts_data = response["comparison_charts_data"];
        let correlation_values = response["correlation_values"];
        let source_actor_name = response["source_actor_name"];
        let other_actor_name = response["other_actor_name"];


        total_chart_data = comparison_charts_data['همه']
        motevali_chart_data = comparison_charts_data['متولی اجرا']
        hamkar_chart_data = comparison_charts_data['همکار']
        salahiat_chart_data = comparison_charts_data['دارای صلاحیت اختیاری']

        total_corr = correlation_values['همه']
        motevali_corr = correlation_values['متولی اجرا']
        hamkar_corr = correlation_values['همکار']
        salahiat_corr = correlation_values['دارای صلاحیت اختیاری']


        await showComparisonYearsLineChart('total_comparison_chart', total_chart_data, source_actor_name, other_actor_name, 'برآیند نقش‌ها', total_corr)
        await showComparisonYearsLineChart('motevali_comparison_chart', motevali_chart_data, source_actor_name, other_actor_name, 'متولی اجرا', motevali_corr)
        await showComparisonYearsLineChart('hamkar_comparison_chart', hamkar_chart_data, source_actor_name, other_actor_name, 'همکار', hamkar_corr)
        await showComparisonYearsLineChart('salahiat_comparison_chart', salahiat_chart_data, source_actor_name, other_actor_name, 'دارای صلاحیت اختیاری', salahiat_corr)
        stopFullPageBlockUI('جزئیات همبستگی');
    }


    async function GetChartData_Es(country_id, documents_information_result) {

            let request_link = '';
            startBlockUI('bar_chart_info_pane');

            subject_data = {}
            approval_references_data = {}
            level_data = {}
            approval_year_data = {}
            type_data = {}
            doc_ids = []

            for (doc of documents_information_result) {
                doc_id = doc['document_id']
                doc_ids.push(doc_id)

                doc_subject = doc['categories']
                doc_approval_year =  doc['approval_year']


                if (!(doc_subject in subject_data)) {
                    subject_data[doc_subject] = { "name": doc_subject, "count": 1 }
                }
                else {
                    subject_data[doc_subject]["count"] += 1

                }

    
                if (!(doc_approval_year in approval_year_data)) {
                    approval_year_data[doc_approval_year] = {
                        "name": doc_approval_year, "count": 1
                    }
                }

                else {
                    approval_year_data[doc_approval_year]["count"] += 1

                }
            }


            /* Show Chart  */

            showChartData(subject_data, "subject_container", [], false)
            showChartData(approval_year_data, "year_container", [], true)


            stopBlockUI('bar_chart_info_pane', 'داشبورد آماری');

        }


        function showChartData(data, container, documents_information_result, keySort) {
            let chart_data = []
            for (const [key, value] of Object.entries(data)) {
                if (value['count'] > 1){
                    chart_data.push([value["name"], value["count"]])
                }
            }
            showChart(chart_data, container, documents_information_result, keySort)
        }


    async function showPredictionsYearsLineChart(chart_container, chart_data, actor_name, model_name, role_name, rmse_value, best_cfg) {



        document.getElementById(chart_container).innerHTML = ""

        // create a chart
        var chart = anychart.line();

        chart
            .animation(true)
            .padding([10, 60, 10, 0])


        // tooltip content font setting
        var tooltip = chart.tooltip();
        tooltip.fontFamily("vazir");

        // tooltip title font setting
        var title = chart.tooltip().title();
        title.fontFamily("vazir");
        // set the chart title
        if (best_cfg.length == 0) {
            best_cfg_msg = 'نامشخص'
        }
        else {
            best_cfg_msg = 'p: ' + best_cfg[0] + ', d: ' + best_cfg[1] + ', q: ' + best_cfg[2]

        }
        chart_title = "کنشگر: " + actor_name + '\n' + "مدل پیش‌بینی‌گر: " + model_name + '\n' + "RMSE: " + rmse_value + '\n'
            + "پارامترهای بهینه: " + best_cfg_msg + "\n"
        chart.title(chart_title);
        chart.title().fontFamily("vazir").textDirection('rtl');;

        // set the interactivity mode
        // chart.interactivity().hoverMode("single");



        trend_started = false
        edited_chart_data = []

        for (column of chart_data) {
            total_count = column[1]
            if (total_count == 0 && !trend_started) {

            } else {
                edited_chart_data.push(column);
                trend_started = true
            }
        }

        var data = anychart.data.set(edited_chart_data)


        var marker = chart.lineMarker();
        // marker.axis(chart);
        marker.layout("vertical");
        marker.value(195);
        marker.stroke({
            thickness: 2,
            color: "#0D0",
            dash: "2 4"
        });




        var marker2 = chart.lineMarker();
        // marker.axis(chart);
        marker2.layout("vertical");
        marker2.value(1400);
        marker2.stroke({
            thickness: 2,
            color: "#0D0",
            dash: "2 4"
        });


        var prediction_series_data = data.mapAs({ x: 0, value: 3 });
        // create the second series, set the data and name  
        var prediction_series = chart.line(prediction_series_data);
        prediction_series.name('پیش‌بینی');

        // configure the visual settings of the second series
        prediction_series.normal().stroke("#28a745", 2, "10 5", "round");
        prediction_series.hovered().stroke("#28a745", 4, "10 5", "round");
        prediction_series.selected().stroke("#28a745", 6, "10 5", "round");


        var test_series_data = data.mapAs({ x: 0, value: 2 });
        // create the second series, set the data and name  
        var test_series = chart.line(test_series_data);
        test_series.name('ارزیابی');

        // configure the visual settings of the second series
        test_series.normal().stroke("#ffc107", 2, "10 5", "round");
        test_series.hovered().stroke("#ffc107", 4, "10 5", "round");
        test_series.selected().stroke("#ffc107", 6, "10 5", "round");


        var actor_series_data = data.mapAs({ x: 0, value: 1 });
        // create the second series, set the data and name  
        var actor_series = chart.line(actor_series_data);
        actor_series.name('روند');

        // configure the visual settings of the second series
        actor_series.normal().stroke("#007bff", 2);
        actor_series.hovered().stroke("#007bff", 4);
        actor_series.selected().stroke("#007bff", 6);

        // set the titles of the axes
        chart.xAxis().title("سال");
        chart.yAxis().title("تعداد وظایف");


        // x axix labels font setting
        var xAxisLabels = chart.xAxis().labels();
        xAxisLabels.fontFamily("vazir");

        var yAxisLabels = chart.yAxis().labels();
        yAxisLabels.fontFamily("vazir");

        // Not allow labels overlapping
        var xAxis = chart.xAxis();
        xAxis.overlapMode("noOverlap");
        xAxis.title().fontFamily('vazir');
xAxis.title().fontWeight("bold");

        // xAxis.staggerMode(false);

        var yAxis = chart.yAxis();
        yAxis.title().fontFamily('vazir');
yAxis.title().fontWeight("bold");
        yAxis.title().height(40);

        // chart.xScale().mode('continuous');
        chart.yScale().ticks().allowFractional(false)

        // set the container id
        chart.container(chart_container);


        // enable the legend
        chart.legend(true);

        var legend = chart.legend();
        legend.fontFamily('vazir')

        // set position mode
        legend.positionMode("inside");
        // set position and alignement
        legend.position("top");
        legend.align("center");
        legend.itemsLayout("horizontalExpandable");
        legend.drag(true);

        // initiate drawing the chart
        chart.draw();


    }



    async function showComparisonYearsLineChart(chart_container, chart_data, source_actor_name, other_actor_name, role_name, correlation_value) {



        document.getElementById(chart_container).innerHTML = ""

        // create a chart
        var chart = anychart.line();

        chart
            .animation(true)
            .padding([10, 60, 10, 0])


        // tooltip content font setting
        var tooltip = chart.tooltip();
        tooltip.fontFamily("vazir");

        // tooltip title font setting
        var title = chart.tooltip().title();
        title.fontFamily("vazir");

        // set the chart title
        chart_title = "نقش: " + role_name + '\n' + "میزان همبستگی: " + correlation_value + '\n'
        chart.title(chart_title);
        chart.title().fontFamily("vazir").textDirection('rtl');;

        // set the interactivity mode
        // chart.interactivity().hoverMode("single");


        var data = anychart.data.set(chart_data)


        var other_actor_series_data = data.mapAs({ x: 0, value: 2 });
        // create the second series, set the data and name  
        var other_actor_series = chart.line(other_actor_series_data);
        other_actor_series.name(other_actor_name);

        // configure the visual settings of the second series
        other_actor_series.normal().stroke("#ffc107", 2, "10 5", "round");
        other_actor_series.hovered().stroke("#ffc107", 4, "10 5", "round");
        other_actor_series.selected().stroke("#ffc107", 6, "10 5", "round");


        var source_actor_series_data = data.mapAs({ x: 0, value: 1 });
        // create the second series, set the data and name  
        var source_actor_series = chart.line(source_actor_series_data);
        source_actor_series.name(source_actor_name);

        // configure the visual settings of the second series
        source_actor_series.normal().stroke("#007bff", 2, "10 5", "round");
        source_actor_series.hovered().stroke("#007bff", 4, "10 5", "round");
        source_actor_series.selected().stroke("#007bff", 6, "10 5", "round");

        // set the titles of the axes
        chart.xAxis().title("سال");
        chart.yAxis().title("تعداد وظایف");


        // x axix labels font setting
        var xAxisLabels = chart.xAxis().labels();
        xAxisLabels.fontFamily("vazir");

        var yAxisLabels = chart.yAxis().labels();
        yAxisLabels.fontFamily("vazir");

        // Not allow labels overlapping
        var xAxis = chart.xAxis();
        xAxis.overlapMode("noOverlap");
        xAxis.title().fontFamily('vazir');
xAxis.title().fontWeight("bold");

        // xAxis.staggerMode(false);

        var yAxis = chart.yAxis();
        yAxis.title().fontFamily('vazir');
yAxis.title().fontWeight("bold");
        yAxis.title().height(40);

        // chart.xScale().mode('continuous');
        chart.yScale().ticks().allowFractional(false)

        // set the container id
        chart.container(chart_container);


        // enable the legend
        chart.legend(true);

        var legend = chart.legend();
        legend.fontFamily('vazir')

        // set position mode
        legend.positionMode("inside");
        // set position and alignement
        legend.position("top");
        legend.align("center");
        legend.itemsLayout("horizontalExpandable");

        // initiate drawing the chart
        chart.draw();


    }

    async function DetailFunction(actor) {
            startFullPageBlockUI();
            docs = details_list[actor]['document_id_list']
            
            document.getElementById("DetailText").innerHTML = ""
            document.getElementById("ModalHeader").innerHTML = 'اسناد دسته ' + details_list[actor]['list'][0]

            /*  Show detail Result */
            let filtered_result_tag = ""
            index = 1;
            for (let doc of docs) {
                const link = 'http://' + location.host + "/information/?id=" + doc[0];
                let title_tag = "<a href='" + link + "'>" + doc[1] + "</a>";
                paragraph_tag = "<li class='mt-3'>" + title_tag + "</li>";
                filtered_result_tag += paragraph_tag;
            }

            filtered_result_tag = "<ol start='1'>" + filtered_result_tag + "</ol>"
            document.getElementById("DetailText").innerHTML = filtered_result_tag

            stopFullPageBlockUI('جزئیات')
        }


    async function showDetailsModal(document_id, document_name, paragraphs_dict) {

        /* Title Text */
        const link = 'http://' + location.host + "/information/?id=" + document_id
        let title_tag = "<a target='blank' href='" + link + "'>" + document_name + "</a>"
        document.getElementById("ModalHeader").innerHTML = title_tag

        /* Body Text */
        let keywords_list = preprocessed_keywords_text.split(",")

        document.getElementById("DetailText").innerHTML = ""

        for (let [actor_role, paragraph_info] of Object.entries(paragraphs_dict)) {
            paragraph_dict = paragraph_info['paragraph_dict']

            paragraph_tag = ''
            actor_role_li = '<h6 class="bold">' + actor_role + ':' + '</h6>'
            document.getElementById("DetailText").innerHTML += actor_role_li;

            for (const [paragraph_id, paragraph_info] of Object.entries(paragraph_dict)) {
                paragraph_text = paragraph_info['text']
                actor_form = paragraph_info['actor_form']
                actor_name = paragraph_info['actor_name']

                is_ref_actor = paragraph_info['is_ref_actor']
                ref_paragraph_text = paragraph_info['ref_text']

                highlighted_paragraph = await highlightParagraphs(paragraph_text, actor_name, actor_role, actor_form, keywords_list, false, is_ref_actor, ref_paragraph_text)
                // highlighted_paragraph =paragraph_text
                paragraph_tag += "<li class='mb-3 lh-lg'>" + highlighted_paragraph + "</li>"
            }

            paragraphs_tag = '<ul>' + paragraph_tag + '</ul>'
            document.getElementById("DetailText").innerHTML += paragraphs_tag;
        }
        document.getElementById("DetailText").innerHTML = "<ul>" + document.getElementById("DetailText").innerHTML + "</ul>"
        popup_handler();
    }

    /************** Actors Chart tab ***************************************/

    async function getActorsChartData(country_id, area_id, multiselect_actor_value, multiselect_role_value, preprocessed_keywords_text) {
        startBlockUI('actors_chart_container');

        request_link = 'http://' + location.host + "/GetActorsDistChartData/"
            + country_id + "/" + multiselect_role_value + "/" + area_id + "/" + multiselect_actor_value + "/" + preprocessed_keywords_text + "/";
        response = await fetch(request_link).then(response => response.json());
        let actor_name = GetMultiSelectText('ActorSelect');

        actors_chart_data = response["actors_chart_data"];
        // let entropy_dict = response['entropy_dict'];
        // let parallelism_dict = response['parallelism_dict'];
        // document.getElementById('chart_entropy').innerHTML = '<span class="text-secondary">' + "آنتروپی: " + '</span>' +
        //                                         '<span  style="color: #1481c0">' + entropy_dict["sum_columns"] +
        //                                         '</span>';
        // document.getElementById('chart_parallelism').innerHTML = '<span class="text-secondary">' + 'احتمال موازی کاری: ' +  '</span>' +
        //                     '<span  style="color: #1481c0">' + parallelism_dict['sum_columns'] + '%</span>';
        showActorsChart('actors_chart_container', actors_chart_data, country_id, actor_name, preprocessed_keywords_text)
        stopBlockUI('actors_chart_container', 'داشبورد آماری');

    }

    async function showActorsChart(chart_container, chart_data, country_id, actor_name, preprocessed_keywords_text) {


        document.getElementById(chart_container).innerHTML = ""
        // create a data set
        var data = anychart.data.set(chart_data);

        // map the data e.g. ['Powder', 11861, 10919, 8034, 18012]
        var salahiat_series_data = data.mapAs({ x: 0, value: 3 }); // Powder : 8034
        var hamkaran_series_data = data.mapAs({ x: 0, value: 2 }); // Powder : 10919
        var motevalian_series_data = data.mapAs({ x: 0, value: 1 }); // Powder : 11861



        // create a chart
        var chart = anychart.column();

        chart
            .animation(true)
            .padding([10, 60, 10, 0])

        chart.background().fill('#ffffff');


        // x axix labels font setting
        var xAxisLabels = chart.xAxis().labels();
        xAxisLabels.fontFamily("vazir");

        var yAxisLabels = chart.yAxis().labels();
        yAxisLabels.fontFamily("vazir");

        // Not allow labels overlapping
        var xAxis = chart.xAxis();
        xAxis.overlapMode("noOverlap");

        var yAxis = chart.yAxis();
        yAxis.title("تعداد وظایف");
        yAxis.title().fontFamily('vazir');
yAxis.title().fontWeight("bold");
        yAxis.title().height(40);


        chart.yScale().minimum(0);
        chart.yScale().ticks().allowFractional(false);

        chart.title('کنشگر: ' + actor_name + '\n');
        chart.title().fontFamily("vazir");;

        // tooltip content font setting
        var tooltip = chart.tooltip();
        tooltip.fontFamily("vazir");

        // tooltip title font setting
        var title = chart.tooltip().title();
        title.fontFamily("vazir");


        // set the container id
        chart.container(chart_container);

        // create the second series, set the data and name
        var salahiat_series = chart.column(salahiat_series_data);
        salahiat_series.normal().stroke("#28a745", 0);
        salahiat_series.normal().fill("#ffc107");
        salahiat_series.name("دارای صلاحیت اختیاری");


        // create the second series, set the data and name
        var hamkaran_series = chart.column(hamkaran_series_data);
        hamkaran_series.normal().stroke("#28a745", 0);
        hamkaran_series.normal().fill("#28a745"); // green
        hamkaran_series.name("همکار");


        // create the first series, set the data and name
        var motevalian_series = chart.column(motevalian_series_data);
        // configure the visual settings of the first series
        motevalian_series.normal().fill("#007bff");
        motevalian_series.normal().stroke("#28a745", 0);
        motevalian_series.name("متولی اجرا");

        // enable the legend
        chart.legend(true);

        var legend = chart.legend();
        legend.fontFamily('vazir')

        // set position mode
        legend.positionMode("inside");
        // set position and alignement
        legend.position("top");
        legend.align("center");
        legend.itemsLayout("horizontalExpandable");
        // initiate drawing the chart
        chart.draw();

        // motevalian columns
        motevalian_series.listen('click', async function (e) {
            const click_tag = e.domTarget.tag;
            const column_index = click_tag["index"]
            const actor_name = chart_data[column_index][0];
            const actor_role_name = 'متولی اجرا';
            showColumnParagraphs_Modal(country_id, actor_name, actor_role_name, preprocessed_keywords_text)

        });

        // hamkaran columns
        hamkaran_series.listen('click', function (e) {
            const click_tag = e.domTarget.tag;
            const column_index = click_tag["index"]
            const actor_name = chart_data[column_index][0];
            const actor_role_name = 'همکار';
            showColumnParagraphs_Modal(country_id, actor_name, actor_role_name, preprocessed_keywords_text)
        });

        // salahiat columns
        salahiat_series.listen('click', function (e) {
            /* Modal Headers */
            const click_tag = e.domTarget.tag;
            const column_index = click_tag["index"]
            const actor_name = chart_data[column_index][0];
            const actor_role_name = 'دارای صلاحیت اختیاری';
            showColumnParagraphs_Modal(country_id, actor_name, actor_role_name, preprocessed_keywords_text)
        });

    }

    async function showColumnParagraphs_Modal(country_id, actor_name, actor_role_name, preprocessed_keywords_text) {
        startFullPageBlockUI();
        /* Title Body */
        const title_tag = actor_name + ' (' + actor_role_name + ')'
        $('#actor_modal_header').text(title_tag);

        /* Modal Body */
        document.getElementById('actor_modal_body').innerHTML = "";

        let request_link = 'http://' + location.host + "/GetColumnParagraphsByActorRoleName_Modal/" + country_id + "/" + actor_name + "/" + actor_role_name + "/" + preprocessed_keywords_text + "/"
        // http://127.0.0.1:8000/GetColumnParagraphsByActorRoleName_Modal/2/%D9%88%D8%B2%D8%A7%D8%B1%D8%AA%20%D9%81%D8%B1%D9%87%D9%86%DA%AF%20%D9%88%20%D8%A7%D8%B1%D8%B4%D8%A7%D8%AF%20%D8%A7%D8%B3%D9%84%D8%A7%D9%85%DB%8C/%D9%87%D9%85%DA%A9%D8%A7%D8%B1/empty/
        let response = await fetch(request_link).then(response => response.json());
        let actor_paragraphs_result = response["actor_paragraphs_result"]

        paragraph_tag = '';
        let keywords_list = preprocessed_keywords_text.split(",")

        for (const [paragraph_id, paragraph_info] of Object.entries(actor_paragraphs_result)) {
            document_id = paragraph_info['document_id']
            document_name = paragraph_info['document_name']

            document_link = 'http://' + location.host + "/information/?id=" + document_id
            doc_name = '<a class="bold text-secondary" target="to_blank" href="' + document_link + '">' + document_name + "</a>"

            paragraph_text = paragraph_info['text']
            actor_form = paragraph_info['actor_form']
            is_ref_actor = paragraph_info['is_ref_actor']
            ref_text = paragraph_info['ref_text']

            highlighted_paragraph = await highlightParagraphs(paragraph_text, actor_name, actor_role_name, actor_form, keywords_list, false, is_ref_actor, ref_text)

            paragraph_tag += "<li class='mb-3 lh-lg'>" + doc_name + highlighted_paragraph + "</li>";

        }


        document.getElementById('actor_modal_body').innerHTML = '<ol start="1">' + paragraph_tag + '</ol>'
        popup_handler();
        stopFullPageBlockUI('کلیک روی نمودار')
        $("#actors_modal_btn").click();
    }

    /************** Actors Effect Stack Chart tab ***************************************/
    async function getActorsEffectStackChartData(country_id, area_id, sub_area_id, preprocessed_keywords_text) {
        startBlockUI('actors_effect_stack_chart_container');
        // http://127.0.0.1:8000/GetMaxMinEffectActorsInAreaChartData/2/3/empty/
        // http://127.0.0.1:8000/GetMaxMinEffectActorsInAreaChartData/1/2/empty/ 
        // request_link = 'http://' + location.host + "/GetMaxMinEffectActorsInAreaChartData/"
        //     + country_id + "/"  + area_id + "/" + preprocessed_keywords_text + "/";

        request_link = 'http://' + location.host + "/GetMaxMinEffectActorsInAreaChartDataUsingCube/"
            + country_id + "/" + area_id + "/" + sub_area_id + "/";

        response = await fetch(request_link).then(response => response.json());
        let area_name = GetMultiSelectText('ActorAreaSelect');
        let actors_chart_data = response["actors_chart_data"]; // [1399,25,"سازمان برنامه و بودجه",1,"سازمان توسعه تجارت"]
        let actors_chart_data_dic = response["actors_chart_data_dic"];
        let actors_without_duty_years = response["actors_without_duty_years"]
        // "1399": [
        //     ["سازمان برنامه و بودجه",15,10,0,25,1399], max
        //     ["سازمان توسعه تجارت",0,1,0,1,1399] min
        // ]
        showActorsEffectStackChart('actors_effect_stack_chart_container', actors_chart_data, country_id, area_name, preprocessed_keywords_text, actors_chart_data_dic)
        let max_num = ComputeNumOfMaxActor(actors_chart_data_dic);
        let min_num = ComputeNumOfMinActor(actors_chart_data_dic);
        // startBlockUI('MaxMinActorTable');
        await LoadMaxMinActorTable(max_num, min_num);
        // stopBlockUI('MaxMinActorTable', 'اثرگذارب کنشگران');
        // startBlockUI('ActorsWithoutDutyTable');
        await LaodActorsWithoutDutyTable(actors_without_duty_years)
        // stopBlockUI('ActorsWithoutDutyTable', 'اثرگذارب کنشگران');
        stopBlockUI('actors_effect_stack_chart_container', 'اثر‌گذاری کنشگران');
    }

    async function showActorsEffectStackChart(chart_container, chart_data, country_id, actor_name, preprocessed_keywords_text, actors_dic) {
        // https://www.anychart.com/chartopedia/chart-type/stacked-column-chart/
        document.getElementById(chart_container).innerHTML = ""

        // create data set on our data
        var dataSet = anychart.data.set(chart_data); // line 22

        // map data for the max series, take x from the zero column and value from the first column of data set
        var seriesData_max = dataSet.mapAs({ 'x': 0, 'value': 1, 'actor': 2 });
        // map data for the min series, take x from the zero column and value from the second column of data set
        var seriesData_min = dataSet.mapAs({ 'x': 0, 'value': 3, 'actor': 4 });

        // create a bar chart
        var chart = anychart.column();

        // turn on chart animation
        chart
            .animation(true)
            .padding([10, 60, 10, 0])

        chart.background().fill('#ffffff');

        // x axix labels font setting
        var xAxisLabels = chart.xAxis().labels();
        xAxisLabels.fontFamily("vazir");

        var yAxisLabels = chart.yAxis().labels();
        yAxisLabels.fontFamily("vazir");

        // Not allow labels overlapping
        var xAxis = chart.xAxis();
        xAxis.overlapMode("noOverlap");

        // set titles for axises
        var yAxis = chart.yAxis();
        yAxis.title("تعداد وظایف کنشگر");
        yAxis.title().fontFamily('vazir');
yAxis.title().fontWeight("bold");
        yAxis.title().height(40);
        var xAxis = chart.xAxis();
        xAxis.title("سال تصویب");
        xAxis.title().fontFamily('vazir');
xAxis.title().fontWeight("bold");
        xAxis.title().height(40);

        // set scale minimum
        chart.yScale().minimum(0);
        chart.yScale().ticks().allowFractional(false);

        // force chart to stack values by Y scale.
        chart.yScale().stackMode('value');

        // chart.yAxis().labels().format(function () {
        //     return this.value.toLocaleString();
        // });

        chart.title('حوزه: ' + actor_name + '\n');
        chart.title().fontFamily("vazir");;

        // tooltip content font setting
        var tooltip = chart.tooltip();
        tooltip.fontFamily("vazir");

        // tooltip title font setting
        var title = chart.tooltip().title();
        title.fontFamily("vazir");

        // set the container id
        chart.container(chart_container);

        // helper function to setup label settings for all series
        var setupSeriesLabels = function (series, name) {
            series.name(name);
            // series.tooltip().valuePrefix('$');
            series.stroke('3 #fff 1');
            series.hovered().stroke('3 #fff 1');
        };

        // create first(max) series with mapped data
        let max_series = chart.column(seriesData_max);
        max_series.normal().fill('#28a745');
        // series.normal().stroke('#0099ff',0);
        setupSeriesLabels(max_series, 'بیشترین'); // max nabayad bashe bayad actor name bashe

        // first(max) series tooltip
        var max_series_tooltip = max_series.tooltip();
        max_series_tooltip.enabled(true);
        max_series_tooltip.title(true);
        max_series_tooltip.separator(true);
        max_series_tooltip.titleFormat("سال تصویب: {%x}");
        max_series_tooltip.format("کنشگر: {%actor}" + "\n" + "تعداد وظایف کنشگر: {%value}");

        // create second(min) series with mapped data
        let min_series = chart.column(seriesData_min);
        // min_series.normal().fill('#ec2131');
        min_series.normal().fill('#ffc107');
        // series.normal().stroke('#ff0000',0);
        // series.name("همکار");
        setupSeriesLabels(min_series, 'کمترین');

        // second(min) series tooltip
        var min_series_tooltip = min_series.tooltip();
        min_series_tooltip.enabled(true);
        min_series_tooltip.title(true);
        min_series_tooltip.separator(true);
        min_series_tooltip.titleFormat("سال تصویب: {%x}");
        min_series_tooltip.format("کنشگر: {%actor}" + "\n" + "تعداد وظایف کنشگر: {%value}");
        // min_series_tooltip.format( function(e){
        //     if (this.actor != "ندارد") {
        //             return "کنشگر: {%actor}" + "\n" + "تعداد وظایف کنشگر: {%value}";
        //         }
        //         else {
        //             "ندارد"
        //         }
        // })

        // enable the legend
        chart.legend(true);

        var legend = chart.legend();
        legend.fontFamily('vazir')

        // set position mode
        legend.positionMode("inside");
        // set position and alignement
        legend.position("top");
        legend.align("center");
        legend.itemsLayout("horizontalExpandable");

        var legendTooltip = chart.legend().tooltip();
        legendTooltip.enabled(true);
        legendTooltip.title(true);
        legendTooltip.title().fontFamily('vazir');
        // legendTooltip.separator(true);
        legendTooltip.titleFormat("کنشگر با {%value} اثرگذاری");
        legendTooltip.format("");

        // // turn on legend
        // chart.legend().enabled(true).fontSize(13).padding([0, 0, 20, 0]);
        // chart.interactivity().hoverMode('by-x');
        // chart.tooltip().displayMode('union');

        // initiate drawing the chart
        chart.draw();

        max_series.listen('click', async function (e) {
            const click_tag = e.domTarget.tag; // {X: $.kB, index: 1}
            const column_index = click_tag["index"] // 1
            const year = chart_data[column_index][0]; // 1400
            const max_actor_year = actors_dic[year][0]; // ["بنیاد ملی نخبگان",0,1,0,1,1400]
            // const actor_role_name = 'متولی اجرا';
            // showColumnParagraphs_Modal(country_id, actor_name, actor_role_name, preprocessed_keywords_text)
            showActorModal(country_id, "کنشگر با بیشترین اثرگذاری حوزه" + " " + actor_name, max_actor_year[0],
                max_actor_year[1], max_actor_year[2], max_actor_year[3], max_actor_year[4], max_actor_year[5],
                preprocessed_keywords_text, "green", max_actor_year[6], max_actor_year[7], max_actor_year[8])
        });

        min_series.listen('click', async function (e) {
            const click_tag = e.domTarget.tag; // {X: $.kB, index: 1}
            const column_index = click_tag["index"] // 1
            const year = chart_data[column_index][0]; // 1400
            const min_actor_year = actors_dic[year][1]; // ["شورای عالی علوم، تحقیقات و فناوری",1,0,0,1,1399]
            // const actor_role_name = 'متولی اجرا';
            // showColumnParagraphs_Modal(country_id, actor_name, actor_role_name, preprocessed_keywords_text)
            showActorModal(country_id, 'کنشگر با کمترین اثرگذاری حوزه' + ' ' + actor_name, min_actor_year[0],
                min_actor_year[1], min_actor_year[2], min_actor_year[3], min_actor_year[4], min_actor_year[5],
                preprocessed_keywords_text, "#ffc107", min_actor_year[6], min_actor_year[7], min_actor_year[8]) // red
        });

        // motevalian columns
        // motevalian_series.listen('click', async function (e) {
        //     const click_tag = e.domTarget.tag;
        //     const column_index = click_tag["index"]
        //     const actor_name = chart_data[column_index][0];
        //     const actor_role_name = 'متولی اجرا';
        //     showColumnParagraphs_Modal(country_id, actor_name, actor_role_name, preprocessed_keywords_text)
        // });
    }

    async function getActorsWordCloudChartData(country_id, area_id, multiselect_actor_value) {
        startBlockUI('Word_cloud_analysis_chart_container');
        request_link = 'http://' + location.host + "/getActorsWordCloudChartData/"
            + country_id + "/" + area_id + "/" + multiselect_actor_value + "/";
        response = await fetch(request_link).then(response => response.json());

        let text_approval_date_list = response["text_approval_date_list"];
        let top_items = response["top_items"];
        let actor_name = $('#ActorSelect option:selected').text()

        showTopKeyWordLineChart('Word_cloud_analysis_chart_container', actor_name, text_approval_date_list, country_id, top_items)

        stopBlockUI('Word_cloud_analysis_chart_container', 'روند ابر واژگان');
    }

    async function showTopKeyWordLineChart(chart_container, actor_name, chart_data, country_id, top_items) {


        document.getElementById(chart_container).innerHTML = ""

        // create a chart
        var chart = anychart.line();

        chart
            .animation(true)
            .padding([10, 60, 10, 0])


        // tooltip content font setting
        var tooltip = chart.tooltip();
        tooltip.fontFamily("vazir");

        // tooltip title font setting
        var title = chart.tooltip().title();
        title.fontFamily("vazir");

        // set the chart title
        chart_title = "کنشگر: " + actor_name + '\n'
        chart.title(chart_title);
        chart.title().fontFamily("vazir").textDirection('rtl');;


        var data = anychart.data.set(chart_data)

        var keyword1_series_data = data.mapAs({ x: 0, value: 1 });
        // create the second series, set the data and name
        var keyword1_series = chart.line(keyword1_series_data);
        keyword1_series.name(top_items[0]);

        // configure the visual settings of the second series
        keyword1_series.normal().stroke("#6a0dad", 2, "10 5", "round");
        keyword1_series.hovered().stroke("#6a0dad", 4, "10 5", "round");
        keyword1_series.selected().stroke("#6a0dad", 6, "10 5", "round");


        var keyword2_series_data = data.mapAs({ x: 0, value: 2 });
        // create the second series, set the data and name
        var keyword2_series = chart.line(keyword2_series_data);
        keyword2_series.name(top_items[1]);

        // configure the visual settings of the second series
        keyword2_series.normal().stroke("#28a745", 2, "10 5", "round");
        keyword2_series.hovered().stroke("#28a745", 4, "10 5", "round");
        keyword2_series.selected().stroke("#28a745", 6, "10 5", "round");


        // map the data
        var keyword3_series_data = data.mapAs({ x: 0, value: 3 });
        // create the first series, set the data and name
        var keyword3_series = chart.line(keyword3_series_data);
        keyword3_series.name(top_items[2]);

        // configure the visual settings of the first series
        keyword3_series.normal().stroke("#ffc107", 2, "10 5", "round");
        keyword3_series.hovered().stroke("#ffc107", 4, "10 5", "round");
        keyword3_series.selected().stroke("#ffc107", 6, "10 5", "round");


        var keyword4_series_data = data.mapAs({ x: 0, value: 4 });
        // create the first series, set the data and name
        var keyword4_series = chart.line(keyword4_series_data);
        keyword4_series.name(top_items[3]);

        // configure the visual settings of the first series
        keyword4_series.normal().stroke("#007bff", 2, "10 5", "round");
        keyword4_series.hovered().stroke("#007bff", 4, "10 5", "round");
        keyword4_series.selected().stroke("#007bff", 6, "10 5", "round");

        var keyword5_series_data = data.mapAs({ x: 0, value: 5 });
        // create the first series, set the data and name
        var keyword5_series = chart.line(keyword5_series_data);
        keyword5_series.name(top_items[4]);

        // configure the visual settings of the first series
        keyword5_series.normal().stroke("#f763df", 2, "10 5", "round");
        keyword5_series.hovered().stroke("#f763df", 4, "10 5", "round");
        keyword5_series.selected().stroke("#f763df", 6, "10 5", "round");

        // set the chart title

        // set the titles of the axes
        chart.xAxis().title("سال");
        chart.yAxis().title("تعداد تکرار");


        // x axix labels font setting
        var xAxisLabels = chart.xAxis().labels();
        xAxisLabels.fontFamily("vazir");

        var yAxisLabels = chart.yAxis().labels();
        yAxisLabels.fontFamily("vazir");

        // Not allow labels overlapping
        var xAxis = chart.xAxis();
        xAxis.overlapMode("noOverlap");
        xAxis.title().fontFamily('vazir');
xAxis.title().fontWeight("bold");

        // xAxis.staggerMode(false);

        var yAxis = chart.yAxis();
        yAxis.title().fontFamily('vazir');
yAxis.title().fontWeight("bold");
        yAxis.title().height(40);

        // chart.xScale().mode('continuous');
        chart.yScale().ticks().allowFractional(false)

        // set the container id
        chart.container(chart_container);


        // enable the legend
        chart.legend(true);

        var legend = chart.legend();
        legend.fontFamily('vazir')

        // set position mode
        legend.positionMode("inside");
        // set position and alignement
        legend.position("top");
        legend.align("center");
        legend.itemsLayout("horizontalExpandable");

        // initiate drawing the chart
        chart.draw();

        keyword1_series.listen('click', async function (event) {
            const click_tag_index = event.domTarget.tag;
            const doc_year = chart_data[click_tag_index][0];
            const actor_role_name = top_items[0];
            console.log(click_tag_index)
            console.log(doc_year)
            console.log(actor_role_name)

            await showKeyWordParagraphs_Modal(country_id, actor_name, actor_role_name, doc_year);

        });

        keyword2_series.listen('click', async function (event) {
            const click_tag_index = event.domTarget.tag;
            const doc_year = chart_data[click_tag_index][0];
            const actor_role_name = top_items[1];
            console.log(click_tag_index)
            console.log(doc_year)
            console.log(actor_role_name)

            await showKeyWordParagraphs_Modal(country_id, actor_name, actor_role_name, doc_year);

        });

        keyword3_series.listen('click', async function (event) {
            const click_tag_index = event.domTarget.tag;
            const doc_year = chart_data[click_tag_index][0];
            const actor_role_name = top_items[2];
            console.log(click_tag_index)
            console.log(doc_year)
            console.log(actor_role_name)

            await showKeyWordParagraphs_Modal(country_id, actor_name, actor_role_name, doc_year);

        });

        keyword4_series.listen('click', async function (event) {
            const click_tag_index = event.domTarget.tag;
            const doc_year = chart_data[click_tag_index][0];
            const actor_role_name = top_items[3];
            console.log(click_tag_index)
            console.log(doc_year)
            console.log(actor_role_name)

            await showKeyWordParagraphs_Modal(country_id, actor_name, actor_role_name, doc_year);

        });

        keyword5_series.listen('click', async function (event) {
            const click_tag_index = event.domTarget.tag;
            const doc_year = chart_data[click_tag_index][0];
            const actor_role_name = top_items[4];
            console.log(click_tag_index)
            console.log(doc_year)
            console.log(actor_role_name)

            await showKeyWordParagraphs_Modal(country_id, actor_name, actor_role_name, doc_year);

        });

    }

    async function showKeyWordParagraphs_Modal(country_id, actor_name, actor_role_name, doc_year) {


        startFullPageBlockUI()

        request_link = 'http://' + location.host + "/GetKeyWordActorParagraphs_Line_Modal/" + country_id + "/" + actor_name + "/" + actor_role_name + "/"
            + doc_year + "/";
        response = await fetch(request_link).then(response => response.json());
        const year_paragraphs_result = response["year_paragraphs"]

        document.getElementById('year_modal_body').innerHTML = ""
        console.log(year_paragraphs_result)

        /* Modal Title */
        const title_tag = actor_name + ' (' + actor_role_name + ')'
        $('#year_actor_modal_header').text(title_tag);

        const year_tag = doc_year
        $('#year_name_modal_header').text(year_tag);

        paragraph_tag = '';
        let keywords_list = []


        document_id = 1
        document_name = "فلسفه سیاسی"

        document_link = 'http://' + location.host + "/information/?id=" + document_id
        doc_name = '<a class="bold text-secondary" target="to_blank" href="' + document_link + '">' + document_name + "</a>"

        paragraph_tag += "<li class='mb-3 lh-lg'>" + doc_name + "</li>";

        // =======================================================================
        document_id = 1
        document_name = "اثر مرکب"

        document_link = 'http://' + location.host + "/information/?id=" + document_id
        doc_name = '<a class="bold text-secondary" target="to_blank" href="' + document_link + '">' + document_name + "</a>"

        paragraph_tag += "<li class='mb-3 lh-lg'>" + doc_name + "</li>";

        // =======================================================================
        document_id = 1
        document_name = "جویای سرنوشت"

        document_link = 'http://' + location.host + "/information/?id=" + document_id
        doc_name = '<a class="bold text-secondary" target="to_blank" href="' + document_link + '">' + document_name + "</a>"

        paragraph_tag += "<li class='mb-3 lh-lg'>" + doc_name + "</li>";

        // =======================================================================

        document.getElementById('year_modal_body').innerHTML = '<ol start="1">' + paragraph_tag + '</ol>'
        popup_handler();

        $("#year_modal_btn").click();


        stopFullPageBlockUI('کتب مرتبط با سال')


    }



    async function showActorModal(country_id, max_or_min, actor_name, motevali_count, hamkar_count, salahiat_count, frequency,
        year, preprocessed_keywords_text, color, motevali_paragraphs_ids, motevali_hamkar_ids, salahiat_paragraphs_ids) {
        startFullPageBlockUI();
        /* Title Body */
        const title_tag = actor_name + ' (' + max_or_min + " در سال " + year + ')'
        $('#actor_effect_modal_header').text(title_tag);
        $('#actor_effect_modal_header').css('color', color);

        /* Modal Body */
        document.getElementById('actor_effect_modal_body').innerHTML = "";

        // const request_link = 'http://' + location.host + "/GetGraphEdgesByDocumentsList/" + measure_id + "/"
        //         let form_data = new FormData();
        //         form_data.append('documents_id_list', documents_id_list)

        //         $.ajax({
        //             url: request_link,
        //             data: form_data,
        //             type: 'POST',
        //             contentType: false,
        //             processData: false,
        //             async: false,
        //         }).done(function (response) {
        //             graphEdgeList = response["graph_edge_list"];
        //             graphType = response["graph_type"];
        //         }).fail(function (response) {
        //             console.log(response);
        //         });
        // request.POST.get('documents_id_list').split(',')

        // let request_link = 'http://' + location.host + "/GetParagraphsByIds_Modal/" + preprocessed_keywords_text + "/"
        // let res;
        // $.ajax({
        //     type: 'GET',
        //     url: request_link,
        //     data: {'paragraphs_id[]': motevali_paragraphs_ids},
        //     success: function(response){
        //     res = response;
        //     console.log(response["test"])
        //     alert(response)
        // }
        // });
        // console.log("--------------------------------------------")
        // console.log(motevali_paragraphs_ids)
        // console.log(response["test"])
        // let response = await fetch(request_link , {
        //     type: "GET",
        //     data: {'paragraphs_id': JSON.stringify(motevali_paragraphs_ids)}
        //     data: {'paragraphs_id': motevali_paragraphs_ids}
        // }
        // ).then(response => response.json());
        // console.log(response["test"])
        // console.log(response)
        // console.log("--------------------------------")
        // let actor_paragraphs_result = response["actor_paragraphs_result"]
        paragraph_tag = '';
        // let keywords_list = preprocessed_keywords_text.split(",")
        // for (const [paragraph_id, paragraph_info] of Object.entries(actor_paragraphs_result)) {
        //     document_id = paragraph_info['document_id']
        //     document_name = paragraph_info['document_name']
        //     document_link = 'http://' + location.host + "/information/?id=" + document_id
        //     doc_name = '<a class="bold text-secondary" target="to_blank" href="' + document_link + '">' + document_name + "</a>"
        //     paragraph_text = paragraph_info['text']
        //     actor_form = paragraph_info['actor_form']
        //     is_ref_actor = paragraph_info['is_ref_actor']
        //     ref_text = paragraph_info['ref_text']
        //     highlighted_paragraph = await highlightParagraphs(paragraph_text, actor_name, actor_role_name, actor_form, keywords_list, false, is_ref_actor, ref_text)
        //     paragraph_tag += "<li class='mb-3 lh-lg'>" + doc_name + highlighted_paragraph + "</li>";
        // }
        // document.getElementById('actor_effect_modal_body').innerHTML = '<ol start="1">' + paragraph_tag + '</ol>'

        paragraph_tag += "<li class='mb-3 lh-lg'>" + "تعداد وظایف متولی اجرا :" + motevali_count + "</li>";
        paragraph_tag += "<li class='mb-3 lh-lg'>" + "تعداد وظایف همکار :" + hamkar_count + "</li>";
        paragraph_tag += "<li class='mb-3 lh-lg'>" + "تعداد وظایف دارای صلاحیت اختیاری :" + salahiat_count + "</li>";
        paragraph_tag += "<li class='mb-3 lh-lg'>" + "تعداد کل وظایف کنشگر :" + frequency + "</li>";

        document.getElementById('actor_effect_modal_body').innerHTML = '<ul >' + paragraph_tag + '</ul>'
        popup_handler();
        stopFullPageBlockUI('کلیک روی نمودار')
        $("#actors_effect_modal_btn").click();
    }

    async function LoadMaxMinActorTable(max_num, min_num) { // showDocumentInformation
        // document.getElementById("DocumentCount").innerText = (Object.keys(documents_information_dict).length).toString() + " سند یافت شد.";
        var keys = Object.keys(max_num).concat(Object.keys(min_num));
        var unique_keys = [...new Set(keys)];
        let index = 1;
        let document_result = []
        for (var key in unique_keys) {
            actor_n = unique_keys[key]
            tmp_max = max_num[actor_n]
            if (tmp_max === undefined) {
                tmp_max = 0;
            }
            tmp_min = min_num[actor_n]
            if (tmp_min === undefined) {
                tmp_min = 0;
            }
            const row = {
                "id": index,
                "actor_name": actor_n,
                'max_effect_num': tmp_max,
                'min_effect_num': tmp_min,
            }
            document_result.push(row)
            index += 1
        }

        $('#MaxMinActorTable').empty();
        $('.MaxMinActorTable').footable({
            "paging": {
                "enabled": true,
                strings: {
                        first: '»',
                        prev:'›',
                        next: '‹',
                        last: '«'
                    }
            },
            "filtering": {
                "enabled": false
            },
            "sorting": {
                "enabled": true
            },
            "empty": "کنشگری یافت نشد.",
            "columns": [{
                "name": "id",
                "title": "ردیف",
                "breakpoints": "xs sm",
                "type": "number",
                "style": {
                    "width": "7%"
                }
            }, {
                "name": "actor_name",
                "title": "نام کنشگر",
                "style": {
                    "width": "33%"
                }
            }, {
                "name": "max_effect_num",
                "title": "تعداد تکرار در بیشترین اثرگذاری",
                "style": {
                    "width": "30%"
                }
            }, {
                "name": "min_effect_num",
                "title": "تعداد تکرار در کمترین اثرگذاری",
                "style": {
                    "width": "30%"
                }
            }
            ],
            "rows": document_result
        });
    }

    async function LaodActorsWithoutDutyTable(actors_dic) {
        // document.getElementById("DocumentCount").innerText = (Object.keys(documents_information_dict).length).toString() + " سند یافت شد.";
        let index = 1;
        let document_result = []
        for (var key in actors_dic) {
            let actor_name = key
            let years_array = actors_dic[key]
            const row = {
                "id": index,
                "actor_name": actor_name,
                'years': years_array.join(', '),
                'years_num': years_array.length,
            }
            document_result.push(row)
            index += 1
        }

        $('#ActorsWithoutDutyTable').empty();
        $('.ActorsWithoutDutyTable').footable({
            "paging": {
                "enabled": true,
                strings: {
                        first: '»',
                        prev:'›',
                        next: '‹',
                        last: '«'
                    }
            },
            "filtering": {
                "enabled": false
            },
            "sorting": {
                "enabled": true
            },
            "empty": "کنشگری یافت نشد.",
            "columns": [{
                "name": "id",
                "title": "ردیف",
                "breakpoints": "xs sm",
                "type": "number",
                "style": {
                    "width": "7%"
                }
            }, {
                "name": "actor_name",
                "title": "نام کنشگر",
                "style": {
                    "width": "43%"
                }
            }, {
                "name": "years",
                "title": " سال های بدون اثرگذاری ",
                "style": {
                    "width": "40%"
                }
            }, {
                "name": "years_num",
                "title": "تعداد سال ها",
                "style": {
                    "width": "10%"
                }
            }
            ],
            "rows": document_result
        });
    }

    function ComputeNumOfMaxActor(actors_chart_data_dic) {
        var res = {}
        for (var key in actors_chart_data_dic) {
            max_obj = actors_chart_data_dic[key][0]
            max_name = max_obj[0]
            if (res[max_name] === undefined) {
                res[max_name] = 1
            }
            else {
                res[max_name] += 1
            }
        }
        return res;
    }

    function ComputeNumOfMinActor(actors_chart_data_dic) {
        var res = {}
        for (var key in actors_chart_data_dic) {
            min_obj = actors_chart_data_dic[key][1]
            min_name = min_obj[0]
            if (res[min_name] === undefined) {
                res[min_name] = 1
            }
            else {
                res[min_name] += 1
            }
        }
        return res;
    }

    /************** Actors-Keywords Graph tab ***************************************/

    async function showActorsKeywordsGraph(container, actors_graph_data, graph_type, country_id, multiselect_role_value, preprocessed_keywords_text) {

        document.getElementById(container).innerHTML = ''

        // create a chart and set the data
        var chart = anychart.graph(actors_graph_data);

        // set the container id
        chart.container(container);

        // configure labels of keywords
        let keywords = chart.group("keywords");
        let actors = chart.group("actors");
        let categories = chart.group("categories");
        let source_actors = chart.group("source_actors");
        let supervisors_actors = chart.group("supervisors_actors");



        if (keywords != undefined) {


            keywords.normal().shape("diamond");
            keywords.hovered().shape("diamond");
            keywords.selected().shape("diamond");

            keywords.normal().height(30);
            keywords.hovered().height(35);
            keywords.selected().height(35);
            // set the fill of nodes in groups
            keywords.normal().fill("#16b2f5");
            keywords.hovered().fill("white");
            keywords.selected().fill("#16b2f5")

            // set the stroke of nodes in groups
            keywords.normal().stroke(null);
            keywords.hovered().stroke("#16b2f5", 3);
            keywords.selected().stroke("#333333", 3);

            keywords.labels().enabled(true);
            keywords.labels().format("{%id}").fontFamily('vazir');
            keywords.labels().fontSize(14);
            keywords.labels().fontWeight(600);
            chart.edges().tooltip().format(" کنشگر:  {%from} \n کلیدواژه:  {%to}");
        }

        if (actors != undefined) {
            actors.normal().height(35);
            actors.hovered().height(40);
            actors.selected().height(40);
            actors.normal().stroke(null);

            actors.labels().enabled(true);
            actors.labels().format("{%id}").fontFamily('vazir');
            actors.labels().fontSize(14);
            actors.labels().fontWeight(600);
        }

        if (source_actors != undefined) {
            source_actors.normal().height(35);
            source_actors.hovered().height(40);
            source_actors.selected().height(40);
            source_actors.normal().stroke(null);

            source_actors.labels().enabled(true);
            source_actors.labels().format("{%id}").fontFamily('vazir');
            source_actors.labels().fontSize(14);
            source_actors.labels().fontWeight(600);
        }

        if (supervisors_actors != undefined) {
            supervisors_actors.normal().height(35);
            supervisors_actors.hovered().height(40);
            supervisors_actors.selected().height(40);
            supervisors_actors.normal().stroke(null);

            supervisors_actors.labels().enabled(true);
            supervisors_actors.labels().format("{%id}").fontFamily('vazir');
            supervisors_actors.labels().fontSize(14);
            supervisors_actors.labels().fontWeight(600);
        }

        chart.nodes().tooltip().format("{%id}");
        chart.nodes().tooltip().fontFamily('vazir');

        chart.edges().tooltip().fontFamily('vazir');

        if (container == 'actors_supervisors_graph_container')
            chart.edges().tooltip().format(" کنشگر:  {%from} \n ناظر:  {%to}");

        if (graph_type === "Directed") {
            chart.edges().arrows({
                enabled: true,
                size: 10,
                position: '50%'
            });
        }
        // initiate drawing the chart
        chart.draw();


        chart.listen('Click', async function (event) {
            // simulate live update
            // console.log(actors_graph_data)
            // actors_graph_data['nodes'].push({id:'sfajlsdjald'})

            // chart.data(actors_graph_data);

            const click_tag = event.domTarget.tag;
            // edge clicked
            if (click_tag["type"] === "edge") {

                edges = actors_graph_data['edges']
                edge_id = parseInt(click_tag['id'].split('_')[1])

                selected_edge = edges[edge_id]

                if (container == 'actors_supervisors_graph_container') {


                    source_actor_name = selected_edge['from']
                    supervisor_name = selected_edge['to']
                    source_id = selected_edge['source_id']
                    supervisor_id = selected_edge['supervisor_id']


                    let request_link = 'http://' + location.host + "/GetActorsSupervisorsEdge_Modal/" + country_id + "/" + source_id + "/" + supervisor_id + "/" + preprocessed_keywords_text + "/"
                    let response = await fetch(request_link).then(response => response.json());
                    let paragraphs_dict_result = response['paragraphs_dict_result'];

                    await showActorSupervisorEdgeModal(paragraphs_dict_result, source_actor_name, supervisor_name, preprocessed_keywords_text);

                }
                else {

                    actor_name = selected_edge['from']
                    keyword = selected_edge['to']
                    destination_node_type = selected_edge['destination_node_type']
                    actor_id = selected_edge['actor_id']


                    let request_link = 'http://' + location.host + "/GetActorsEdgeParagraphsByKeyword_Modal/" + country_id + "/" + actor_id + "/" + multiselect_role_value + "/" + keyword + "/"
                    let response = await fetch(request_link).then(response => response.json());
                    let actor_paragraphs_result = response['actor_paragraphs_result'];

                    await showActorKeywordEdgeModal(actor_paragraphs_result, actor_name, keyword);
                }

            }

        })




    }

    async function showActorKeywordEdgeModal(actor_paragraphs_result, actor_name, keyword) {

        let keywords_list = [keyword]

        /* Title Text */
        $('#edge_actor_modal_header').text(actor_name)
        $('#edge_keyword_modal_header').text(keyword)
        /* Body Text */

        document.getElementById("edge_actor_modal_body").innerHTML = ""

        for (let [actor_role, paragraph_dict] of Object.entries(actor_paragraphs_result)) {

            paragraph_tag = ''
            actor_role_li = '<h5 class="bold">' + actor_role + ':' + '</h5>'
            document.getElementById("edge_actor_modal_body").innerHTML += actor_role_li;

            for (const [paragraph_id, paragraph_info] of Object.entries(paragraph_dict)) {
                document_id = paragraph_info['document_id']
                document_name = paragraph_info['document_name']

                document_link = 'http://' + location.host + "/information/?id=" + document_id
                doc_name = '<a class="bold text-secondary" target="to_blank" href="' + document_link + '">' + document_name + "</a>"

                paragraph_text = paragraph_info['text']
                actor_form = paragraph_info['actor_form']
                is_ref_actor = paragraph_info['is_ref_actor']
                ref_text = paragraph_info['ref_text']


                highlighted_paragraph = await highlightParagraphs(paragraph_text, actor_name, actor_role, actor_form, keywords_list, false, is_ref_actor, ref_text)


                paragraph_tag += "<li class='mb-3 lh-lg'>" + doc_name + highlighted_paragraph + "</li>"
            }

            paragraphs_tag = '<ol start = "1">' + paragraph_tag + '</oll>'
            document.getElementById("edge_actor_modal_body").innerHTML += paragraphs_tag;
        }
        document.getElementById("edge_actor_modal_body").innerHTML = "<ul>" + document.getElementById("edge_actor_modal_body").innerHTML + "</ul>"
        popup_handler();
        $('#edge_modal_btn').click();

    }


    /****************** Highlight algorithms ********************************** */

    async function highlightParagraphs(paragraph, actor_name, actor_role, paragraph_actor_form, keywords_list, all_hamkar, is_ref_actor, ref_paragraph_text) {


        paragraph_text = paragraph;

        // Highlight keywords
        if (!keywords_list.includes('empty')) {
            for (keyword of keywords_list) {
                keyword_tag = "<span class= 'gray_dotted_border px-1 rounded'>" + keyword + "</span>"
                paragraph_text = paragraph_text.replaceAll(keyword, keyword_tag);

            }
        }


        // highlight other actors
        paragraph_text = await highlightOtherActors(paragraph_text, paragraph_actor_form, actor_name)



        if (actor_role.includes('متولی اجرا')) {

            paragraph_text = await highlightMotevalian(paragraph_text, paragraph_actor_form, motevali_keywords, 'bg-primary', is_ref_actor, ref_paragraph_text)
            paragraph_text = await highlightLegalDeadline(paragraph_text, motevali_keywords)

        } else if (actor_role.includes('همکار')) {
            paragraph_text = await highlightHamkaran(paragraph_text, paragraph_actor_form, hamkaran_keywords, 'bg-success');

        } else {
            paragraph_text = await highlightSalahiat(paragraph_text, paragraph_actor_form, salahiat_keywords, 'bg-warning', is_ref_actor, ref_paragraph_text)

        }






        /********************* Highlight optional keywords  **************************/
        for (pattern_keyword of optional_keywords) {

            if (optional_after_terms_count[pattern_keyword] > 0)
                paragraph_text = await highlightSomeTermsAfterKeyword(paragraph_text, optional_after_terms_count[pattern_keyword], pattern_keyword)

            pattern_keyword_tag = "<span class='border border-secondary border-2  px-1 rounded'>" + pattern_keyword + "</span>"
            paragraph_text = paragraph_text.replaceAll(pattern_keyword, pattern_keyword_tag)

        }

        return paragraph_text
    }




    async function highlightMotevalian(paragraph_text, actor_form, pattern_keywords, bg_color, is_ref_actor, ref_paragraph_text) {


        for (pattern_keyword of pattern_keywords) {

            /* Highlight with actors list */
            let pattern_keyword_tag = "<span class='bg-secondary text-white rounded px-1'>" + pattern_keyword + "</span>"

            actor_with_postfix_1 = actor_form + ' ' + 'جمهوری اسلامی ایران'
            actor_with_postfix_2 = actor_form + ' ' + 'ایران'
            actor_with_postfix_3 = actor_form + ' ' + 'کشور'

            paragraph_text = paragraph_text.split('.').map((sentence) => {


                if (sentence.includes(actor_form + ' ' + pattern_keyword)) {

                    if (is_ref_actor) {

                        popover_title = actor_form;
                        popover_content = ref_paragraph_text;
                        actor_tag = '<a dir="rtl" tabindex="0" class="d-inline-block ' + bg_color.replace('bg', 'text') + ' text-right bold"  data-bs-placement="bottom" role="button" data-bs-toggle="popover" data-bs-trigger="focus" title="' + popover_title + '" data-bs-content="' + popover_content + '">' + popover_title + '</a>'
                        sentence = sentence.replaceAll(actor_form + ' ' + pattern_keyword, actor_tag + ' ' + pattern_keyword_tag);

                    } else {

                        actor_tag = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + actor_form + "</span>"
                        sentence = sentence.replaceAll(actor_form + ' ' + pattern_keyword, actor_tag + ' ' + pattern_keyword_tag);

                    }

                }
                else if (sentence.includes(actor_with_postfix_1 + ' ' + pattern_keyword)) {
                    actor_tag = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + actor_with_postfix_1 + "</span>"
                    sentence = sentence.replaceAll(actor_with_postfix_1 + ' ' + pattern_keyword, actor_tag + ' ' + pattern_keyword_tag);
                }
                else if (sentence.includes(actor_with_postfix_2 + ' ' + pattern_keyword)) {
                    actor_tag = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + actor_with_postfix_2 + "</span>"
                    sentence = sentence.replaceAll(actor_with_postfix_2 + ' ' + pattern_keyword, actor_tag + ' ' + pattern_keyword_tag);
                }
                else if (sentence.includes(actor_with_postfix_3 + ' ' + pattern_keyword)) {
                    actor_tag = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + actor_with_postfix_3 + "</span>"
                    sentence = sentence.replaceAll(actor_with_postfix_3 + ' ' + pattern_keyword, actor_tag + ' ' + pattern_keyword_tag);
                }
                else if (sentence.includes('(' + actor_form + ')' + ' ' + pattern_keyword)) {
                    actor_tag = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + '(' + actor_form + ')' + "</span>"
                    sentence = sentence.replaceAll('(' + actor_form + ')' + ' ' + pattern_keyword, actor_tag + ' ' + pattern_keyword_tag);
                }
                else if (sentence.includes('(' + actor_with_postfix_1 + ')' + ' ' + pattern_keyword)) {
                    actor_tag = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + '(' + actor_with_postfix_1 + ')' + "</span>"
                    sentence = sentence.replaceAll('(' + actor_with_postfix_1 + ')' + ' ' + pattern_keyword, actor_tag + ' ' + pattern_keyword_tag);
                }
                else if (sentence.includes('(' + actor_with_postfix_2 + ')' + ' ' + pattern_keyword)) {
                    actor_tag = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + '(' + actor_with_postfix_2 + ')' + "</span>"
                    sentence = sentence.replaceAll('(' + actor_with_postfix_2 + ')' + ' ' + pattern_keyword, actor_tag + ' ' + pattern_keyword_tag);
                }
                else if (sentence.includes('(' + actor_with_postfix_3 + ')' + ' ' + pattern_keyword)) {
                    actor_tag = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + '(' + actor_with_postfix_3 + ')' + "</span>"
                    sentence = sentence.replaceAll('(' + actor_with_postfix_3 + ')' + ' ' + pattern_keyword, actor_tag + ' ' + pattern_keyword_tag);
                }

                return sentence
            }).join('.')

        }



        /* Highlight with actors list */
        eghdam_keywords = ['اقدام کند', 'اقدام‌کند', 'اقدام نماید', 'اقدام‌نماید']
        non_eghdam_keywords = pattern_keywords.filter(x => !eghdam_keywords.includes(x));

        paragraph_text = paragraph_text.split('.').map((sentence) => {

            for (e_kw of eghdam_keywords) {

                pattern_keyword_tag1 = "<span class='bg-secondary text-white rounded px-1'>" + e_kw + "</span>"

                if (sentence.includes(e_kw) && !check_non_eghdam_kw_exists(sentence, non_eghdam_keywords)) {

                    actor_tag1 = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + actor_form + "</span>"
                    sentence = sentence.replaceAll(actor_form + ' ', actor_tag1 + ' ');

                    sentence = sentence.replaceAll(e_kw, pattern_keyword_tag1);


                }

            }

            return sentence
        }).join('.')




        return paragraph_text;


    }


    function check_non_eghdam_kw_exists(sentence, pattern_keywords) {
        for (p_kw of pattern_keywords) {
            pattern = p_kw
            if (sentence.includes(pattern)) {
                return true;
            }
        }
        return false;

    }



    async function highlightHamkaran(paragraph_text, actor_form, pattern_keywords, bg_color) {
        const window_length = 100;

        let space_counter = 0;
        detected_hamkaran_list = []


        /* Highlight pattern keywords and references */
        for (pattern_keyword of pattern_keywords) {


            /* Highlight more with actors list */
            let regex = '', result, indices = [];

            if (pattern_keyword == 'با همکاری') {
                regex = /با همکاری/gi;
            } else {
                regex = /باهمکاری/gi;
            }

            while ((result = regex.exec(paragraph_text))) {
                indices.push(result.index);
            }

            for (const index of indices) {

                let start_index = (index + pattern_keyword.length);
                let substring = paragraph_text.substring(start_index, start_index + window_length);
                let current_substring = substring;


                actor_tag = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + actor_form + "</span>"
                // substring = substring.replaceAll(' ' + actor_form + ' ', ' ' + actor_tag + ' ');
                substring = substring.replaceAll(' ' + actor_form, ' ' + actor_tag);
                substring = substring.replaceAll('(' + actor_form + ')', '(' + actor_tag + ')');

                for (symbol of hamkaran_punctuations) {

                    actor_tag = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + actor_form + "</span>"
                    substring = substring.replaceAll(' ' + actor_form + symbol, ' ' + actor_tag + symbol);

                }

                actor_without_affix = actor_form.replaceAll('وزارت ', '').replaceAll('سازمان ', '').replaceAll(' جمهوری اسلامی ایران', '')

                if (actor_without_affix != 'اطلاعات' && actor_without_affix != 'کشور' && !substring.includes(actor_form)) {


                    actor_tag = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + actor_form + "</span>"
                    substring = substring.replaceAll(' ' + actor_without_affix + ' ', ' ' + actor_tag + ' ');
                    substring = substring.replaceAll('(' + actor_without_affix + ')', '(' + actor_tag + ')');

                    for (symbol of hamkaran_punctuations) {


                        actor_tag = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + actor_form + "</span>"
                        substring = substring.replaceAll(' ' + actor_without_affix + symbol, ' ' + actor_tag + symbol);

                    }

                }



                paragraph_text = paragraph_text.replaceAll(current_substring, substring);

            }
            /* Highlight with actors list */
            let pattern_keyword_tag = "<span class='bg-secondary text-white rounded px-1'>" + pattern_keyword + "</span>"

            paragraph_text = paragraph_text.replaceAll(pattern_keyword, pattern_keyword_tag);

        }




        return paragraph_text;



    }

    async function highlightSalahiat(paragraph_text, actor_form, pattern_keywords, bg_color, is_ref_actor, ref_paragraph_text) {


        for (pattern_keyword of pattern_keywords) {

            /* Highlight with actors list */
            let pattern_keyword_tag = "<span class='bg-secondary text-white rounded px-1'>" + pattern_keyword + "</span>"

            actor_with_postfix_1 = actor_form + ' ' + 'جمهوری اسلامی ایران'
            actor_with_postfix_2 = actor_form + ' ' + 'ایران'
            actor_with_postfix_3 = actor_form + ' ' + 'کشور'

            paragraph_text = paragraph_text.split('.').map((sentence) => {


                if (sentence.includes(actor_form + ' ' + pattern_keyword)) {

                    if (is_ref_actor) {

                        popover_title = actor_form;
                        popover_content = ref_paragraph_text;
                        actor_tag = '<a dir="rtl" tabindex="0" class="d-inline-block ' + bg_color.replace('bg', 'text') + ' text-right bold"  data-bs-placement="bottom" role="button" data-bs-toggle="popover" data-bs-trigger="focus" title="' + popover_title + '" data-bs-content="' + popover_content + '">' + popover_title + '</a>'
                        sentence = sentence.replaceAll(actor_form + ' ' + pattern_keyword, actor_tag + ' ' + pattern_keyword_tag);


                    } else {

                        actor_tag = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + actor_form + "</span>"
                        sentence = sentence.replaceAll(actor_form + ' ' + pattern_keyword, actor_tag + ' ' + pattern_keyword_tag);

                    }

                }
                else if (sentence.includes(actor_with_postfix_1 + ' ' + pattern_keyword)) {
                    actor_tag = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + actor_with_postfix_1 + "</span>"
                    sentence = sentence.replaceAll(actor_with_postfix_1 + ' ' + pattern_keyword, actor_tag + ' ' + pattern_keyword_tag);
                }
                else if (sentence.includes(actor_with_postfix_2 + ' ' + pattern_keyword)) {
                    actor_tag = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + actor_with_postfix_2 + "</span>"
                    sentence = sentence.replaceAll(actor_with_postfix_2 + ' ' + pattern_keyword, actor_tag + ' ' + pattern_keyword_tag);
                }
                else if (sentence.includes(actor_with_postfix_3 + ' ' + pattern_keyword)) {
                    actor_tag = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + actor_with_postfix_3 + "</span>"
                    sentence = sentence.replaceAll(actor_with_postfix_3 + ' ' + pattern_keyword, actor_tag + ' ' + pattern_keyword_tag);
                }
                else if (sentence.includes('(' + actor_form + ')' + ' ' + pattern_keyword)) {
                    actor_tag = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + '(' + actor_form + ')' + "</span>"
                    sentence = sentence.replaceAll('(' + actor_form + ')' + ' ' + pattern_keyword, actor_tag + ' ' + pattern_keyword_tag);
                }
                else if (sentence.includes('(' + actor_with_postfix_1 + ')' + ' ' + pattern_keyword)) {
                    actor_tag = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + '(' + actor_with_postfix_1 + ')' + "</span>"
                    sentence = sentence.replaceAll('(' + actor_with_postfix_1 + ')' + ' ' + pattern_keyword, actor_tag + ' ' + pattern_keyword_tag);
                }
                else if (sentence.includes('(' + actor_with_postfix_2 + ')' + ' ' + pattern_keyword)) {
                    actor_tag = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + '(' + actor_with_postfix_2 + ')' + "</span>"
                    sentence = sentence.replaceAll('(' + actor_with_postfix_2 + ')' + ' ' + pattern_keyword, actor_tag + ' ' + pattern_keyword_tag);
                }
                else if (sentence.includes('(' + actor_with_postfix_3 + ')' + ' ' + pattern_keyword)) {
                    actor_tag = "<span class='" + bg_color + " text-white rounded px-1 reference'>" + '(' + actor_with_postfix_3 + ')' + "</span>"
                    sentence = sentence.replaceAll('(' + actor_with_postfix_3 + ')' + ' ' + pattern_keyword, actor_tag + ' ' + pattern_keyword_tag);
                }

                return sentence
            }).join('.')

        }



        return paragraph_text;

    }





    /* Highlight N terms after one keyword */
    async function highlightSomeTermsAfterKeyword(paragraph_text, terms_count, keyword) {
        paragraph_selected_terms = '';
        selected_terms_list = []
        let indices = await getIndicesOf(keyword, paragraph_text);

        for (index of indices) {

            let pattern_keyword_index = index;
            let start_index = pattern_keyword_index + keyword.length + 1
            let end_index = paragraph_text.length;
            let selected_terms_size = 0

            if (pattern_keyword_index != -1) {
                sub_string = paragraph_text.substring(start_index, end_index)

                selected_terms = sub_string.split(' ').slice(0, terms_count)

                for (term of selected_terms) {
                    selected_terms_size += term.length
                }
                selected_terms_size += (terms_count - 1)

                selected_terms_text = paragraph_text.substring(start_index, start_index + selected_terms_size);

                if (!selected_terms_text.includes('span')) {
                    if (!selected_terms_list.includes(selected_terms_text)) {
                        selected_terms_list.push(selected_terms_text)
                    }

                }


            }


        }

        for (selected_terms_text of selected_terms_list) {
            if (selected_terms_text != "") {
                selected_terms_tag = "<span class='blue_dotted_border selected_terms px-1 mx-1'>" + selected_terms_text + "</span>"
                paragraph_text = paragraph_text.replaceAll(selected_terms_text, selected_terms_tag)
            }

        }

        return paragraph_text;
    }

    async function highlightLegalDeadline(paragraph_text, actor_pattern_keywords) {

        for (pattern_keyword of actor_pattern_keywords) {

            let pattern_keyword_tag = "<span class='bg-secondary text-white rounded px-1'>" + pattern_keyword + "</span>"


            let indices = await getIndicesOf(pattern_keyword_tag, paragraph_text);

            for (index of indices) {
                start_index = index + pattern_keyword_tag.length;

                sub_string = paragraph_text.substring(start_index, paragraph_text.length);

                for (deadline_keyword of deadline_pattern_keywords) {
                    for (const [nubmer_text, value] of Object.entries(numbers_dict)) {
                        for (time_category of time_categories) {

                            // ظرف شش ماه
                            pattern1 = deadline_keyword + ' ' + nubmer_text + ' ' + time_category;
                            pattern2 = deadline_keyword + ' ' + nubmer_text + ' ' + '(' + value + ')' + ' ' + time_category;

                            // ظرف شش‌ماه
                            pattern3 = deadline_keyword + ' ' + nubmer_text + '‌' + time_category;
                            pattern4 = deadline_keyword + ' ' + nubmer_text + ' ' + '(' + value + ')' + '‌' + time_category;

                            // ظرف یکسال
                            pattern5 = deadline_keyword + ' ' + nubmer_text + time_category;
                            pattern6 = deadline_keyword + ' ' + nubmer_text + ' ' + '(' + value + ')' + time_category;

                            patterns = [pattern1, pattern2, pattern3,
                                pattern4, pattern5, pattern6];

                            for (pattern of patterns) {
                                deadline_keyword_tag = "<span class='deadlines gray_dotted_border px-1 rounded'>" + deadline_keyword + "</span>"
                                pattern_without_deadline_keyword = pattern.replace(deadline_keyword + ' ', '');
                                pattern_without_keyword_tag = "<span class='deadlines border border-warning border-2 px-1 rounded'>" + pattern_without_deadline_keyword + "</span>"
                                new_sub_string = sub_string.replaceAll(pattern, deadline_keyword_tag + ' ' + pattern_without_keyword_tag)

                                // closest deadline..not all deadlines. => replace()
                                paragraph_text = paragraph_text.replace(sub_string, new_sub_string);

                            }

                            /* *********************************** */

                        }
                    }
                }


            }

        }
        return paragraph_text;

    }

    async function getIndicesOf(searchStr, str) {
        var searchStrLen = searchStr.length;
        if (searchStrLen == 0) {
            return [];
        }
        var startIndex = 0, index, indices = [];
        while ((index = str.indexOf(searchStr, startIndex)) > -1) {
            indices.push(index);
            startIndex = index + searchStrLen;
        }
        return indices;
    }

    async function highlightOtherActors(paragraph_text, paragraph_actor_form, paragraph_actor_name) {
        para_actor_forms = []
        for (const [actor_id, actor_info] of Object.entries(actors_dict)) {
            if (actor_info['name'] == paragraph_actor_name) {
                para_actor_forms = actor_info['forms'];
                break;
            }
        }

        for (actor_form of actors_list) {
            if (!para_actor_forms.includes(actor_form)) {
                actor_form_tag = "<span class='other_actors'>" + actor_form + "</span>"
                paragraph_text = paragraph_text.replaceAll(' ' + actor_form + ' ', ' ' + actor_form_tag + ' ');
                paragraph_text = paragraph_text.replaceAll(' ' + actor_form + '،', ' ' + actor_form_tag + '،');
                paragraph_text = paragraph_text.replaceAll('(' + actor_form + ')', '(' + actor_form_tag + ')');
            }

        }

        return paragraph_text;
    }

    async function showOtherActors() {
        if ($('.highlighted').length) {
            $('.highlighted').attr('class', 'other_actors')
        } else {
            $('.other_actors').attr('class', 'other_actors highlighted bold text-primary px-1 rounded')
        }

    }

    /* *********************************************************************** */


    async function ToggleActorsKeywordsGraphTabShow(preprocessed_keywords_text) {
        if (preprocessed_keywords_text == 'empty') {

            if ($('#actors_graph_tab').hasClass('active')) {
                $('#actor_result_tab').click();
            }

            $('#actors_graph_tab').hide();

        } else {
            $('#actors_graph_tab').show();
        }
    }



    async function ToggleActorsTimeSeriesChartTabShow(actors_id) {
        if (actors_id.split('__').length > 1
            || actors_id.split('__').includes("0")) {

            if ($('#time_series_analysis_tab').hasClass('active')) {
                $('#time_series_analysis_tab').click();
            }

            $('#time_series_analysis_tab').hide();

        } else {
            $('#time_series_analysis_tab').show();
        }
    }



    function GetMultiSelectText(container_id) {
        let e = document.getElementById(container_id);
        let selected = [...e.options]
            .filter(option => option.selected)
            .map(option => option.innerText)
        return selected.join("__")
    }

    async function GetMultiSelectValue(container_id) {
        let e = document.getElementById(container_id);
        let selected = [...e.options]
            .filter(option => option.selected)
            .map(option => option.value)
        return selected.join("__")
    }

    async function SpinnerModeFunction(mode) {
        if (mode === "Active") {
            $(".spinner-border").addClass("active");
        } else if (mode === "Disable") {
            $(".spinner-border").removeClass("active");
        }
    }
</script>

<!-- Export results -->

<script>

    async function downloadFiles(file_name_list, save_file_name) {
        startFullPageBlockUI()
        const country_id = document.getElementById("country").value

        let zip = new JSZip()

        const request_link = 'http://' + location.host + "/GetCountryById/" + country_id + "/";
        let response = await fetch(request_link).then(response => response.json());
        response = response["country_information"][0]
        const country_folder = response["folder"];
        const country_name = response["name"];

        save_file_name += " مجموعه سند {" + country_name + "}"


        let extension = ".txt"
        if (country_name.includes("فاوا")) {
            extension = '.docx';
        }


        for (const [doc_id, doc_info] of Object.entries(file_name_list)) {

            const document_name = doc_info['name'] + extension

            const path = 'http://' + location.host + '/media/data/' + country_folder + '\\' + document_name;

            await fetch(path)
                .then(res => res.arrayBuffer())
                .then(value => {
                    zip.file(document_name, value);
                })
        }
        zip.generateAsync({
            type: "blob"
        })
            .then(function (content) {
                // see FileSaver.js
                saveAs(content, save_file_name + ".zip");
            });
        stopFullPageBlockUI('دانلود اسناد');
    }

    async function DownloadSerachResultFunction() {
        const save_file_name = " کنشگران در"
        downloadFiles(SearchResultValue, save_file_name)
    }

    async function ExportExcelSerachResultFunction() {
        var csv = "";

        sep = ","


        let Csv = "نام سند" + sep + "موضوع سند" + sep + "مرجع تصویب" + sep + "تاریخ تصویب" + sep +
            "کنشگر (نقش کنشگر)" +
            "\n"
        for (const [doc_id, doc_info] of Object.entries(SearchResultValue)) {
            let document_actors = doc_info["actors"]
            document_actors = document_actors.toString().replaceAll(',', ' / ');

            Csv += doc_info['name'] + sep + doc_info['subject'] + sep +
                doc_info['approval_reference'] + sep +
                doc_info['approval_date'] + sep +
                document_actors + "\n"

        }

        let save_file_name = " کنشگران در"
        save_file_name += " مجموعه سند {" + $('#country option:selected').text() + "}"

        let csvContent = "data:text/csv;charset=utf-8,%EF%BB%BF" + encodeURI(Csv);
        var link = document.createElement("a");
        link.setAttribute("href", csvContent);
        link.setAttribute("download", save_file_name + ".csv");
        document.body.appendChild(link);
        link.click()
    }


    function showToastMessage(message_text) {
        document.getElementById('toast_message').innerText = message_text
        var toastElList = [].slice.call(document.querySelectorAll('.toast'))
        var toastList = toastElList.map(function (toastEl) {
            return new bootstrap.Toast(toastEl)
        });
        toastList.forEach(toast => toast.show())
    }

    /* Search after press Enter */
    $("#info_form").submit(function () { return false; });
    $("#KeywordsBox").keyup(function (event) {
        if (event.keyCode === 13) {
            ShowResult()
        }
    });

    function popup_handler() {
        var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'))
        var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
            return new bootstrap.Popover(popoverTriggerEl)
        });
    }

    function disableActorSelect() {
        var actor_select = document.getElementById("ActorSelect");
        actor_select.disabled = true;
    }

    function enableActorSelect() {
        var actor_select = document.getElementById("ActorSelect");
        actor_select.disabled = false;
    }
</script>


<script src="../../static/js/tooltip_handler.js"></script>

<script src="../../static/js/UserLogSave.js"></script>
<script src="../../static/js/signout_function.js"></script>
<script src="../../static/js/actors/actors_tour.js"></script>
<script src="../../static/js/tour.js"></script>



</html>